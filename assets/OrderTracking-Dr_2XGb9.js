import{B as F,e as L,r as l,o as S,j as s,C as Q,P as U}from"./index-B15Jacgc.js";import{R as Y,P as W,p as X,e as n}from"./printService-DN5DPOVT.js";import{f as a}from"./formatters-C_RfwIqz.js";import{f as G}from"./dateTime-BT6xQjkF.js";import{A as J,M as K}from"./map-pin-ChjTJwgu.js";import{M as V,P as Z}from"./phone-O8duDAfg.js";import{T as C}from"./truck-BlmPUeyj.js";import{C as D}from"./clock-BZbWU7wl.js";import{C as ss}from"./check-circle-CYoLxoFM.js";const d=t=>G(t,"en-US",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}),m=t=>{switch(t){case"delivered":case"confirmed":return s.jsx(ss,{size:20,className:"status-icon delivered"});case"shipped":return s.jsx(C,{size:20,className:"status-icon shipped"});case"processing":case"pending":return s.jsx(D,{size:20,className:"status-icon pending"});default:return s.jsx(U,{size:20,className:"status-icon default"})}},es=t=>{const i=["pending","confirmed","processing","shipped","delivered"].indexOf(t);return i>=0?i:0};function ps(){var N,f,y,b,_,k;const{orderId:t}=F(),p=L(),[i,w]=l.useState(null),[z,j]=l.useState(!0),[P,x]=l.useState(null),[o,g]=l.useState("");l.useEffect(()=>{t&&T()},[t]);const T=async()=>{j(!0),x(null);try{let e;t.match(/^ORD-/)?e=await S.getByOrderNumber(t):e=await S.getById(t),w(e)}catch(e){x(e.message||"Order not found")}finally{j(!1)}},v=e=>{e.preventDefault(),o.trim()&&p(`/order-tracking/${o.trim()}`)},R=e=>{switch(e){case"paid":return"status-paid";case"pending":return"status-pending";case"refunded":return"status-refunded";case"declined":return"status-declined";default:return""}},E=e=>{switch(e){case"fulfilled":return"status-fulfilled";case"shipped":return"status-shipped";case"label_created":return"status-label-created";case"processing":return"status-processing";default:return""}},A=e=>{const q=(Array.isArray(e==null?void 0:e.items)?e.items:[]).map(u=>{const $=Number(u.quantity||0),O=Number(u.price||0),M=Number(u.total||$*O);return`
        <tr>
          <td>${n(u.product_name||"-")}</td>
          <td>${$}</td>
          <td>${n(a(O))}</td>
          <td>${n(a(M))}</td>
        </tr>
      `}).join(""),r=(e==null?void 0:e.shipping_address)||{},H=Number((e==null?void 0:e.total_amount)||0)-Number((e==null?void 0:e.tax_amount)||0)-Number((e==null?void 0:e.shipping_amount)||0);return`
      <div class="order-receipt">
        <div class="receipt-header">
          <h1>Order Receipt</h1>
          <div><strong>Order #</strong> ${n((e==null?void 0:e.order_number)||"")}</div>
          <div><strong>Date</strong> ${n(d((e==null?void 0:e.created_at)||Date.now()))}</div>
        </div>
        <div class="receipt-customer">
          <div><strong>${n((e==null?void 0:e.customer_name)||"-")}</strong></div>
          <div>${n((e==null?void 0:e.customer_email)||"")}</div>
          <div>${n((e==null?void 0:e.customer_phone)||"")}</div>
          <div>${n((r==null?void 0:r.street)||"")}</div>
          <div>${n([r==null?void 0:r.city,r==null?void 0:r.state,r==null?void 0:r.zip].filter(Boolean).join(", "))}</div>
        </div>
        <table class="receipt-table">
          <thead>
            <tr>
              <th>Item</th>
              <th>Qty</th>
              <th>Price</th>
              <th>Total</th>
            </tr>
          </thead>
          <tbody>${q||'<tr><td colspan="4">No items</td></tr>'}</tbody>
        </table>
        <div class="receipt-summary">
          <div><span>Subtotal</span><strong>${n(a(H))}</strong></div>
          <div><span>Tax</span><strong>${n(a((e==null?void 0:e.tax_amount)||0))}</strong></div>
          <div><span>Shipping</span><strong>${n(a((e==null?void 0:e.shipping_amount)||0))}</strong></div>
          <div class="total"><span>Total</span><strong>${n(a((e==null?void 0:e.total_amount)||0))}</strong></div>
        </div>
      </div>
    `},I=()=>{i&&X({title:`Receipt ${i.order_number||""}`,bodyHtml:A(i),cssText:`
        .order-receipt { max-width: 760px; margin: 0 auto; }
        .receipt-header h1 { margin: 0 0 8px; font-size: 24px; }
        .receipt-header { margin-bottom: 12px; line-height: 1.6; font-size: 12px; }
        .receipt-customer { margin: 12px 0; font-size: 12px; line-height: 1.6; }
        .receipt-table { width: 100%; border-collapse: collapse; font-size: 12px; }
        .receipt-table th, .receipt-table td { border: 1px solid #d1d5db; padding: 7px; text-align: left; }
        .receipt-table thead th { background: #f3f4f6; }
        .receipt-summary { width: 320px; margin-top: 14px; margin-left: auto; }
        .receipt-summary div { display: flex; justify-content: space-between; padding: 6px 0; border-bottom: 1px solid #e5e7eb; font-size: 12px; }
        .receipt-summary .total { font-weight: 700; border-bottom: none; font-size: 14px; }
      `,onError:e=>x(e)})};if(t&&z)return s.jsx("div",{className:"order-tracking-page",children:s.jsxs("div",{className:"loading-container",children:[s.jsx(Y,{size:40,className:"spinning"}),s.jsx("p",{children:"Loading order details..."})]})});if(t&&P)return s.jsxs("div",{className:"order-tracking-page",children:[s.jsxs("div",{className:"search-section fade-in-up",children:[s.jsx("h1",{children:"Track Your Order"}),s.jsxs("form",{onSubmit:v,className:"search-form",children:[s.jsx("input",{type:"text",placeholder:"Enter Order Number (e.g., ORD-240209-ABC123)",value:o,onChange:e=>g(e.target.value)}),s.jsx("button",{type:"submit",children:"Track"})]})]}),s.jsxs("div",{className:"error-container fade-in-up",children:[s.jsx(J,{size:60}),s.jsx("h2",{children:"Order Not Found"}),s.jsx("p",{children:"We couldn't find an order with that number. Please check and try again."}),s.jsx("button",{onClick:()=>p("/products"),children:"Continue Shopping"})]})]});if(!t)return s.jsx("div",{className:"order-tracking-page",children:s.jsxs("div",{className:"search-section fade-in-up",children:[s.jsx("h1",{children:"Track Your Order"}),s.jsx("p",{children:"Enter your order number to track your shipment"}),s.jsxs("form",{onSubmit:v,className:"search-form",children:[s.jsx("input",{type:"text",placeholder:"Enter Order Number (e.g., ORD-240209-ABC123)",value:o,onChange:e=>g(e.target.value)}),s.jsx("button",{type:"submit",children:"Track Order"})]})]})});const c=es(i.status),B=c/4*100;return s.jsxs("div",{className:"order-tracking-page",children:[s.jsxs("div",{className:"tracking-header fade-in-up",children:[s.jsx("h1",{children:"Order Tracking"}),s.jsxs("p",{className:"order-number-display",children:["Order ",s.jsx("strong",{children:i.order_number})]})]}),s.jsxs("div",{className:"status-progress-section fade-in-up",children:[s.jsx("div",{className:"progress-bar",children:s.jsx("div",{className:"progress-fill",style:{width:`${B}%`}})}),s.jsxs("div",{className:"progress-steps",children:[s.jsxs("div",{className:`step ${c>=0?"active":""}`,children:[m("pending"),s.jsx("span",{children:"Order Placed"})]}),s.jsxs("div",{className:`step ${c>=1?"active":""}`,children:[m("confirmed"),s.jsx("span",{children:"Confirmed"})]}),s.jsxs("div",{className:`step ${c>=2?"active":""}`,children:[m("processing"),s.jsx("span",{children:"Processing"})]}),s.jsxs("div",{className:`step ${c>=3?"active":""}`,children:[m("shipped"),s.jsx("span",{children:"Shipped"})]}),s.jsxs("div",{className:`step ${c>=4?"active":""}`,children:[m("delivered"),s.jsx("span",{children:"Delivered"})]})]})]}),s.jsxs("div",{className:"tracking-content",children:[s.jsxs("div",{className:"tracking-main slide-in-left",children:[s.jsxs("div",{className:"tracking-card",children:[s.jsx("h2",{children:"Order Items"}),s.jsx("div",{className:"order-items-list",children:(N=i.items)==null?void 0:N.map((e,h)=>s.jsxs("div",{className:"tracking-item",style:{animationDelay:`${h*.1}s`},children:[s.jsx("div",{className:"item-image",children:e.product_image?s.jsx("img",{src:e.product_image,alt:e.product_name}):s.jsx("div",{className:"placeholder-image",children:"No Image"})}),s.jsxs("div",{className:"item-details",children:[s.jsx("h4",{children:e.product_name}),s.jsxs("p",{className:"item-quantity",children:["Quantity: ",e.quantity]}),s.jsxs("p",{className:"item-price",children:[a(e.price)," each"]})]}),s.jsx("div",{className:"item-total",children:a(e.total||e.price*e.quantity)})]},e.id))})]}),s.jsxs("div",{className:"tracking-card",children:[s.jsx("h2",{children:"Order Timeline"}),s.jsx("div",{className:"timeline",children:(f=i.status_history)==null?void 0:f.map((e,h)=>s.jsxs("div",{className:"timeline-item",style:{animationDelay:`${h*.1}s`},children:[s.jsx("div",{className:"timeline-marker"}),s.jsxs("div",{className:"timeline-content",children:[s.jsx("span",{className:"timeline-date",children:d(e.created_at)}),s.jsx("p",{className:"timeline-status",children:e.status}),e.description&&s.jsx("p",{className:"timeline-description",children:e.description})]})]},e.id))})]}),((y=i.notifications)==null?void 0:y.length)>0&&s.jsxs("div",{className:"tracking-card",children:[s.jsx("h2",{children:"Notifications Sent"}),s.jsx("div",{className:"notifications-list",children:(b=i.notifications)==null?void 0:b.map(e=>s.jsxs("div",{className:"notification-item",children:[s.jsx("span",{className:"notif-type",children:e.type.toUpperCase()}),s.jsx("span",{className:"notif-sent-to",children:e.recipient}),s.jsx("span",{className:`notif-status ${e.status}`,children:e.status}),s.jsx("span",{className:"notif-date",children:d(e.created_at)})]},e.id))})]})]}),s.jsxs("div",{className:"tracking-sidebar slide-in-right",children:[s.jsxs("div",{className:"summary-card",children:[s.jsx("h2",{children:"Order Summary"}),s.jsxs("div",{className:"summary-rows",children:[s.jsxs("div",{className:"summary-row",children:[s.jsx("span",{children:"Order Number"}),s.jsx("span",{className:"mono",children:i.order_number})]}),s.jsxs("div",{className:"summary-row",children:[s.jsx("span",{children:"Order Date"}),s.jsx("span",{children:d(i.created_at)})]}),s.jsxs("div",{className:"summary-row",children:[s.jsx("span",{children:"Status"}),s.jsx("span",{className:`status-badge ${i.status}`,children:i.status})]}),s.jsxs("div",{className:"summary-row",children:[s.jsx("span",{children:"Payment Status"}),s.jsx("span",{className:`payment-badge ${R(i.payment_status)}`,children:i.payment_status})]}),s.jsxs("div",{className:"summary-row",children:[s.jsx("span",{children:"Fulfillment"}),s.jsx("span",{className:`fulfillment-badge ${E(i.fulfillment_status)}`,children:i.fulfillment_status})]})]}),s.jsxs("div",{className:"summary-totals",children:[s.jsxs("div",{className:"summary-row",children:[s.jsx("span",{children:"Subtotal"}),s.jsx("span",{children:a(i.total_amount-(i.tax_amount||0)-(i.shipping_amount||0))})]}),s.jsxs("div",{className:"summary-row",children:[s.jsx("span",{children:"Tax"}),s.jsx("span",{children:a(i.tax_amount||0)})]}),s.jsxs("div",{className:"summary-row",children:[s.jsx("span",{children:"Shipping"}),s.jsx("span",{children:a(i.shipping_amount||0)})]}),s.jsx("div",{className:"summary-divider"}),s.jsxs("div",{className:"summary-total",children:[s.jsx("span",{children:"Total"}),s.jsx("span",{children:a(i.total_amount)})]})]})]}),i.shipping_address&&s.jsxs("div",{className:"address-card",children:[s.jsxs("h3",{children:[s.jsx(K,{size:18})," Shipping Address"]}),s.jsxs("div",{className:"address-content",children:[s.jsx("p",{className:"recipient-name",children:i.customer_name}),s.jsx("p",{children:i.shipping_address.street}),s.jsxs("p",{children:[i.shipping_address.city,", ",i.shipping_address.state," ",i.shipping_address.zip]}),i.shipping_address.country&&s.jsx("p",{children:i.shipping_address.country})]})]}),s.jsxs("div",{className:"contact-card",children:[s.jsx("h3",{children:"Contact Information"}),s.jsxs("div",{className:"contact-item",children:[s.jsx(V,{size:16}),s.jsx("span",{children:i.customer_email})]}),i.customer_phone&&s.jsxs("div",{className:"contact-item",children:[s.jsx(Z,{size:16}),s.jsx("span",{children:i.customer_phone})]})]}),((_=i.payments)==null?void 0:_.length)>0&&s.jsxs("div",{className:"payment-card",children:[s.jsxs("h3",{children:[s.jsx(Q,{size:18})," Payment Details"]}),s.jsx("div",{className:"payment-content",children:i.payments.map(e=>s.jsxs("div",{className:"payment-item",children:[s.jsx("p",{className:"payment-method",children:e.payment_method}),e.card_last4&&s.jsxs("p",{className:"card-info",children:["Card ending in ",e.card_last4]}),s.jsx("p",{className:"payment-amount",children:a(e.amount)}),s.jsx("p",{className:`payment-status ${e.status}`,children:e.status}),e.transaction_id&&s.jsxs("p",{className:"transaction-id",children:["TXN: ",e.transaction_id]})]},e.id))})]}),i.shipping_tracking_number&&s.jsxs("div",{className:"shipping-card",children:[s.jsxs("h3",{children:[s.jsx(C,{size:18})," Shipping Information"]}),s.jsxs("div",{className:"shipping-content",children:[s.jsx("p",{className:"carrier",children:i.shipping_carrier}),s.jsxs("p",{className:"tracking-number",children:["Tracking: ",s.jsx("strong",{children:i.shipping_tracking_number})]}),i.estimated_delivery&&s.jsxs("p",{className:"estimated-delivery",children:["Est. Delivery: ",d(i.estimated_delivery)]}),((k=i.shipping_records)==null?void 0:k.length)>0&&s.jsx("div",{className:"shipping-history",children:i.shipping_records.map(e=>s.jsxs("div",{className:"shipping-record",children:[s.jsx("span",{className:"record-status",children:e.status}),s.jsx("span",{className:"record-date",children:d(e.created_at)})]},e.id))})]}),s.jsxs("button",{className:"track-package-btn",children:["Track Package on ",i.shipping_carrier]})]}),s.jsxs("div",{className:"actions-card",children:[s.jsxs("button",{className:"print-receipt-btn",onClick:I,children:[s.jsx(W,{size:18})," Print Receipt"]}),s.jsx("button",{className:"continue-shopping-btn",onClick:()=>p("/products"),children:"Continue Shopping"})]})]})]})]})}export{ps as default};
