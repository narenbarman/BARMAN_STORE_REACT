import{r as o,e as U,j as e,L as V,g as x}from"./index-B15Jacgc.js";import{n as v,P as A,i as Z}from"./phone-CMmRihHV.js";/* empty css              */const F=c=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(c),$=c=>{const s=String(c||"");return s.length>=10&&/[a-z]/.test(s)&&/[A-Z]/.test(s)&&/[0-9]/.test(s)&&/[^A-Za-z0-9]/.test(s)},k=c=>{const s=String(c||"").trim();if(!s)return{error:"Enter your email or phone number"};if(s.includes("@")){const d=s.toLowerCase();return F(d)?{email:d,phone:null,type:"email"}:{error:"Please enter a valid email address"}}return Z(s)?{email:null,phone:v(s),type:"phone"}:{error:A}};function Y({setUser:c}){const[s,d]=o.useState(""),[u,L]=o.useState(""),[j,I]=o.useState(""),[i,O]=o.useState(!1),[S,T]=o.useState(""),[P,z]=o.useState(""),[f,D]=o.useState(""),[b,_]=o.useState(""),[E,l]=o.useState(!1),[N,n]=o.useState(""),[C,h]=o.useState(""),[w,B]=o.useState(""),y=U();o.useEffect(()=>{if(typeof window>"u")return;const r=new URLSearchParams(window.location.search),p=String(r.get("email")||"").trim().toLowerCase(),g=v(r.get("phone")||""),a=String(r.get("token")||"").trim(),t=String(r.get("phoneToken")||"").trim();p?d(p):g&&d(g),(a||t)&&h("Verification token detected. Sign in and complete verification from your Profile page.")},[]);const M=async r=>{var p,g;r.preventDefault(),l(!0),n(""),h("");try{let a;if(i){const t=String(P||"").trim().toLowerCase(),m=f?v(f):"";if(!t&&!m){n("Enter at least one contact: email or phone"),l(!1);return}if(t&&!F(t)){n("Please enter a valid email address"),l(!1);return}if(u!==j){n("Password and confirm password do not match"),l(!1);return}if(f&&!m){n(A),l(!1);return}if(!$(u)){n("Password must be at least 10 characters and include uppercase, lowercase, number, and special character"),l(!1);return}a=await x.register(t||null,u,j,S,m||null,b||null)}else{const t=k(s);if(t.error){n(t.error),l(!1);return}a=t.type==="email"?await x.login(t.email,u):await x.loginWithPhone(t.phone,u)}if(localStorage.setItem("user",JSON.stringify({...a.user,token:a.token})),c({...a.user,token:a.token}),a.user.must_change_password){const t=new URLSearchParams;t.set("force","1");const m=String(((p=a.user)==null?void 0:p.email)||"").trim().toLowerCase(),q=v(((g=a.user)==null?void 0:g.phone)||"");m?t.set("email",m):q&&t.set("phone",q),y(`/change-password?${t.toString()}`)}else a.user.role==="admin"?y("/admin"):y("/")}catch(a){n(a.message||"Authentication failed")}finally{l(!1)}},W=async()=>{try{if(n(""),h(""),String(w||"").trim().length<5){n("Please provide a short reason (min 5 characters) for admin review");return}const r=k(s);if(r.error){n("Enter your email or phone first to request reset");return}await x.requestPasswordReset(r.email,r.phone,w||null),h("Reset request sent to admin")}catch(r){n(r.message||"Failed to submit reset request")}},R=r=>{O(r),n(""),h("")};return e.jsx("div",{className:"login-page",children:e.jsxs("div",{className:"login-container",children:[e.jsx("h1",{children:i?"Create Account":"Welcome Back"}),e.jsx("p",{className:"login-subtitle",children:i?"Sign up for BARMAN STORE account":"Sign in with email or phone number"}),N&&e.jsx("div",{className:"error-message",children:N}),C&&e.jsx("div",{className:"success-message",children:C}),e.jsxs("form",{onSubmit:M,className:"login-form",children:[i&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"name",children:"Full Name"}),e.jsx("input",{type:"text",id:"name",value:S,onChange:r=>T(r.target.value),placeholder:"Enter your full name",required:i})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"registerEmail",children:"Email (Optional)"}),e.jsx("input",{type:"email",id:"registerEmail",value:P,onChange:r=>z(r.target.value),placeholder:"Enter your email (optional)"}),e.jsx("small",{style:{color:"var(--color-text)",opacity:.7},children:"Either email or phone is required"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"registerPhone",children:"Phone Number (Optional)"}),e.jsx("input",{type:"tel",id:"registerPhone",value:f,onChange:r=>D(r.target.value),placeholder:"Enter your phone number (optional)"}),e.jsx("small",{style:{color:"var(--color-text)",opacity:.7},children:"Either email or phone is required"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"address",children:"Address (Optional)"}),e.jsx("input",{type:"text",id:"address",value:b,onChange:r=>_(r.target.value),placeholder:"Enter your address (optional)"})]})]}),!i&&e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"identifier",children:"Email or Phone"}),e.jsx("input",{type:"text",id:"identifier",value:s,onChange:r=>d(r.target.value),placeholder:"Enter email or phone number",required:!0}),e.jsx("small",{style:{color:"var(--color-text)",opacity:.7},children:"System automatically detects email or India phone number"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"password",children:"Password"}),e.jsx("input",{type:"password",id:"password",value:u,onChange:r=>L(r.target.value),placeholder:"Enter your password",required:!0})]}),i&&e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"confirmPassword",children:"Confirm Password"}),e.jsx("input",{type:"password",id:"confirmPassword",value:j,onChange:r=>I(r.target.value),placeholder:"Re-enter your password",required:!0})]}),e.jsx("button",{type:"submit",className:"login-button",disabled:E,children:E?"Please wait...":i?"Create Account":"Sign In"})]}),e.jsx("div",{className:"login-footer",children:e.jsx("p",{children:i?e.jsxs(e.Fragment,{children:["Already have an account?"," ",e.jsx("a",{href:"#",onClick:r=>{r.preventDefault(),R(!1)},children:"Sign in"})]}):e.jsxs(e.Fragment,{children:["Don't have an account?"," ",e.jsx("a",{href:"#",onClick:r=>{r.preventDefault(),R(!0)},children:"Create one"}),e.jsx("br",{}),e.jsx("span",{style:{marginTop:"0.5rem",display:"block"},children:e.jsx(V,{to:"/change-password",style:{color:"var(--color-secondary)",fontWeight:700,textDecoration:"none"},children:"Change Password"})}),e.jsxs("span",{style:{marginTop:"0.5rem",display:"block"},children:[e.jsx("input",{type:"text",value:w,onChange:r=>B(r.target.value),placeholder:"Reset reason (required for admin review)",style:{width:"100%",marginBottom:"0.4rem"}}),e.jsx("button",{type:"button",className:"login-button",onClick:W,children:"Request Admin Password Reset"})]})]})})})]})})}export{Y as default};
