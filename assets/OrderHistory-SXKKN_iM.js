import{r as m,e as H,o as I,j as e,P as _}from"./index-B15Jacgc.js";import{f as B,a as q}from"./formatters-C_RfwIqz.js";import{R as D,X as V}from"./x-circle-uNhED-ap.js";import{S as X}from"./search-BblXmoKy.js";import{F as J}from"./filter-BDtCe5nF.js";import{E as Y,D as G}from"./eye-Da84VUM6.js";import{T as L}from"./truck-BlmPUeyj.js";import{C as $}from"./check-circle-CYoLxoFM.js";import{C as K}from"./clock-BZbWU7wl.js";const M=t=>q(t,"en-US",{year:"numeric",month:"short",day:"numeric"}),C=t=>({pending:{icon:K,color:"pending",label:"Pending"},confirmed:{icon:$,color:"confirmed",label:"Confirmed"},processing:{icon:_,color:"processing",label:"Processing"},shipped:{icon:L,color:"shipped",label:"Shipped"},delivered:{icon:$,color:"delivered",label:"Delivered"},cancelled:{icon:V,color:"cancelled",label:"Cancelled"},refunded:{icon:D,color:"refunded",label:"Refunded"}})[t]||{icon:_,color:"default",label:t},Q=["all","pending","confirmed","processing","shipped","delivered","cancelled","refunded"],W=[{value:"date_desc",label:"Newest First"},{value:"date_asc",label:"Oldest First"},{value:"amount_desc",label:"Highest Amount"},{value:"amount_asc",label:"Lowest Amount"}];function Z(){return e.jsxs("div",{className:"history-header fade-in-up",children:[e.jsx("h1",{children:"Order History"}),e.jsx("p",{children:"View and manage all your orders"})]})}function ee({searchTerm:t,setSearchTerm:c,statusFilter:o,setStatusFilter:i,sortBy:h,setSortBy:u,statusCounts:f}){return e.jsxs("div",{className:"filters-section fade-in-up",children:[e.jsxs("div",{className:"search-box",children:[e.jsx(X,{size:20}),e.jsx("input",{type:"text",placeholder:"Search by order number, name, or email...",value:t,onChange:n=>c(n.target.value)})]}),e.jsxs("div",{className:"filter-controls",children:[e.jsxs("div",{className:"filter-group",children:[e.jsx(J,{size:18}),e.jsx("select",{value:o,onChange:n=>i(n.target.value),children:Q.map(n=>e.jsx("option",{value:n,children:n==="all"?`All Orders (${f.all})`:`${C(n).label} (${f[n]||0})`},n))})]}),e.jsx("div",{className:"sort-group",children:e.jsx("select",{value:h,onChange:n=>u(n.target.value),children:W.map(n=>e.jsx("option",{value:n.value,children:n.label},n.value))})})]})]})}function te({statusCounts:t,statusFilter:c,setStatusFilter:o}){return e.jsx("div",{className:"status-tabs fade-in-up",children:Object.entries(t).map(([i,h])=>e.jsxs("button",{className:`status-tab ${c===i?"active":""}`,onClick:()=>o(i),children:[i==="all"?"All":C(i).label,e.jsx("span",{className:"tab-count",children:h})]},i))})}function se({hasActiveFilters:t,onStartShopping:c}){return e.jsxs("div",{className:"empty-state fade-in-up",children:[e.jsx(_,{size:80}),e.jsx("h2",{children:"No Orders Found"}),e.jsx("p",{children:t?"Try adjusting your filters":"You haven't placed any orders yet"}),e.jsx("button",{onClick:c,children:"Start Shopping"})]})}function ae({order:t,index:c,onViewOrder:o,onRetryPayment:i,onTrackOrder:h}){var n,d;const u=C(t.status),f=u.icon;return e.jsxs("div",{className:"order-card slide-in-up",style:{animationDelay:`${c*.05}s`},children:[e.jsxs("div",{className:"order-header",children:[e.jsxs("div",{className:"order-info",children:[e.jsx("button",{type:"button",className:"order-number",onClick:o,style:{background:"none",border:"none",padding:0,cursor:"pointer",textDecoration:"underline"},children:t.order_number||`#${t.id}`}),e.jsx("span",{className:"order-date",children:M(t.created_at)})]}),e.jsxs("div",{className:"order-status",children:[e.jsx(f,{size:18,className:`status-icon ${u.color}`}),e.jsx("span",{className:`status-text ${u.color}`,children:u.label})]})]}),e.jsxs("div",{className:"order-items-preview",children:[(n=t.items)==null?void 0:n.slice(0,3).map((x,p)=>e.jsxs("div",{className:"item-preview",children:[e.jsx("span",{className:"item-name",children:x.product_name||x.name}),e.jsxs("span",{className:"item-qty",children:["x",x.quantity]})]},x.id||p)),((d=t.items)==null?void 0:d.length)>3&&e.jsxs("span",{className:"more-items",children:["+",t.items.length-3," more"]})]}),e.jsxs("div",{className:"order-footer",children:[e.jsxs("div",{className:"order-total",children:[e.jsx("span",{className:"total-label",children:"Total"}),e.jsx("span",{className:"total-amount",children:B(t.total_amount)})]}),e.jsxs("div",{className:"order-actions",children:[e.jsxs("button",{className:"view-btn",onClick:o,children:[e.jsx(Y,{size:16}),"View Details"]}),t.status==="pending"&&e.jsx("button",{className:"retry-btn",onClick:i,children:"Retry Payment"}),t.fulfillment_status==="shipped"&&t.shipping_tracking_number&&e.jsxs("button",{className:"track-btn",onClick:h,children:[e.jsx(L,{size:16}),"Track"]})]})]}),t.payment_status!=="paid"&&e.jsxs("div",{className:`payment-warning ${t.payment_status}`,children:[t.payment_status==="pending"&&"Payment Pending",t.payment_status==="declined"&&"Payment Declined - Action Required",t.payment_status==="refunded"&&"Refund Processed"]})]})}function ne({onExport:t}){return e.jsx("div",{className:"export-section fade-in-up",children:e.jsxs("button",{className:"export-btn",onClick:t,children:[e.jsx(G,{size:18}),"Export Order History"]})})}function fe(){const[t,c]=m.useState([]),[o,i]=m.useState([]),[h,u]=m.useState(!0),[f,n]=m.useState(null),[d,x]=m.useState(""),[p,S]=m.useState("all"),[N,E]=m.useState("date_desc"),j=H(),F=()=>{try{const a=JSON.parse(localStorage.getItem("user")||"{}");return a&&typeof a=="object"?a:{}}catch{return localStorage.removeItem("user"),{}}};m.useEffect(()=>{w()},[]),m.useEffect(()=>{R()},[t,d,p,N]);const w=async()=>{u(!0),n(null);try{const a=F();if(!a.id){j("/login");return}const s=await I.getByUser(a.id);c(s||[])}catch{n("Failed to load orders. Please try again.")}finally{u(!1)}},R=()=>{let a=[...t];switch(d&&(a=a.filter(s=>{var l,b,v;return((l=s.order_number)==null?void 0:l.toLowerCase().includes(d.toLowerCase()))||((b=s.customer_name)==null?void 0:b.toLowerCase().includes(d.toLowerCase()))||((v=s.customer_email)==null?void 0:v.toLowerCase().includes(d.toLowerCase()))})),p!=="all"&&(a=a.filter(s=>s.status===p)),N){case"date_desc":a.sort((s,l)=>new Date(l.created_at)-new Date(s.created_at));break;case"date_asc":a.sort((s,l)=>new Date(s.created_at)-new Date(l.created_at));break;case"amount_desc":a.sort((s,l)=>(l.total_amount||0)-(s.total_amount||0));break;case"amount_asc":a.sort((s,l)=>(s.total_amount||0)-(l.total_amount||0));break}i(a)},k={all:t.length,pending:t.filter(s=>s.status==="pending").length,confirmed:t.filter(s=>s.status==="confirmed").length,processing:t.filter(s=>s.status==="processing").length,shipped:t.filter(s=>s.status==="shipped").length,delivered:t.filter(s=>s.status==="delivered").length,cancelled:t.filter(s=>s.status==="cancelled").length,refunded:t.filter(s=>s.status==="refunded").length},P=a=>{j(`/orders/${a}`)},A=a=>{j(`/checkout?retry=${a}`)},T=a=>{const s=a.order_number||a.id;j(`/order-tracking/${s}`)},z=()=>{const a=o.map(r=>({order_number:r.order_number||`#${r.id}`,date:r.created_at?new Date(r.created_at).toISOString():"",customer_name:r.customer_name||"",customer_email:r.customer_email||"",status:r.status||"",payment_status:r.payment_status||"",fulfillment_status:r.fulfillment_status||"",total_amount:Number(r.total_amount||0).toFixed(2),item_count:Array.isArray(r.items)?r.items.length:0})),s=["order_number","date","customer_name","customer_email","status","payment_status","fulfillment_status","total_amount","item_count"],l=r=>{const y=String(r??"");return/[",\n]/.test(y)?`"${y.replace(/"/g,'""')}"`:y},b=[s.join(","),...a.map(r=>s.map(y=>l(r[y])).join(","))],v=new Blob([b.join(`
`)],{type:"text/csv;charset=utf-8;"}),O=URL.createObjectURL(v),g=document.createElement("a"),U=new Date().toISOString().slice(0,10);g.href=O,g.download=`order-history-${U}.csv`,document.body.appendChild(g),g.click(),document.body.removeChild(g),URL.revokeObjectURL(O)};return h?e.jsx("div",{className:"order-history-page",children:e.jsxs("div",{className:"loading-container",children:[e.jsx(D,{size:40,className:"spinning"}),e.jsx("p",{children:"Loading your orders..."})]})}):f?e.jsx("div",{className:"order-history-page",children:e.jsxs("div",{className:"error-container",children:[e.jsx(_,{size:60}),e.jsx("h2",{children:"Unable to Load Orders"}),e.jsx("p",{children:f}),e.jsx("button",{onClick:w,children:"Try Again"})]})}):e.jsxs("div",{className:"order-history-page",children:[e.jsx(Z,{}),e.jsx(ee,{searchTerm:d,setSearchTerm:x,statusFilter:p,setStatusFilter:S,sortBy:N,setSortBy:E,statusCounts:k}),e.jsx(te,{statusCounts:k,statusFilter:p,setStatusFilter:S}),o.length===0?e.jsx(se,{hasActiveFilters:!!d||p!=="all",onStartShopping:()=>j("/products")}):e.jsx("div",{className:"orders-list",children:o.map((a,s)=>e.jsx(ae,{order:a,index:s,onViewOrder:()=>P(a.id),onRetryPayment:()=>A(a.id),onTrackOrder:()=>T(a)},a.id))}),t.length>0&&e.jsx(ne,{onExport:z})]})}export{fe as default};
