import{r,d as B,j as e,L as M,f as m}from"./index-DzGHLpa5.js";/* empty css              */const R=o=>{const t=o.replace(/\D/g,"");return t.length===12&&t.startsWith("91")?t.slice(2):t.length===11&&t.startsWith("1")?t.slice(1):t},T=o=>R(o).length===10,I=o=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(o);function V({setUser:o}){const[t,g]=r.useState("email"),[i,x]=r.useState(""),[c,w]=r.useState(""),[d,k]=r.useState(""),[a,j]=r.useState(!1),[v,q]=r.useState(""),[f,F]=r.useState(""),[y,A]=r.useState(""),[b,u]=r.useState(!1),[N,l]=r.useState(""),[S,p]=r.useState(""),[E,D]=r.useState(""),P=B(),O=async s=>{s.preventDefault(),u(!0),l(""),p("");try{let n;if(a){const h=f||null,W=y||null;n=await m.register(i,d,v,h,W)}else if(t==="email"){if(!I(i)){l("Please enter a valid email address"),u(!1);return}n=await m.login(i,d)}else{if(!T(c)){l("Please enter a valid phone number (10-11 digits)"),u(!1);return}n=await m.loginWithPhone(R(c),d)}localStorage.setItem("user",JSON.stringify({...n.user,token:n.token})),o({...n.user,token:n.token}),n.user.role==="admin"?P("/admin"):P("/")}catch(n){l(n.message)}finally{u(!1)}},C=(s,n)=>{const h=s.target.value;n?F(h):w(h)},L=async()=>{try{if(l(""),p(""),!i&&!c){l("Enter your email or phone first to request reset");return}await m.requestPasswordReset(i||null,c||null,E||null),p("Reset request sent to admin")}catch(s){l(s.message||"Failed to submit reset request")}};return e.jsx("div",{className:"login-page",children:e.jsxs("div",{className:"login-container",children:[e.jsx("h1",{children:a?"Create Account":"Welcome Back"}),e.jsx("p",{className:"login-subtitle",children:a?"Sign up for BARMAN STORE account":"Sign in to your BARMAN STORE account"}),N&&e.jsx("div",{className:"error-message",children:N}),S&&e.jsx("div",{className:"success-message",children:S}),e.jsxs("form",{onSubmit:O,className:"login-form",children:[a&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"name",children:"Full Name"}),e.jsx("input",{type:"text",id:"name",value:v,onChange:s=>q(s.target.value),placeholder:"Enter your full name",required:a})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"email",children:"Email (Optional)"}),e.jsx("input",{type:"email",id:"email",value:i,onChange:s=>x(s.target.value),placeholder:"Enter your email (optional)"}),e.jsx("small",{style:{color:"var(--color-text)",opacity:.7},children:"Either email or phone is required"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"registerPhone",children:"Phone Number (Optional)"}),e.jsx("input",{type:"tel",id:"registerPhone",value:f,onChange:s=>C(s,!0),placeholder:"Enter your phone number (optional)"}),e.jsx("small",{style:{color:"var(--color-text)",opacity:.7},children:"Either email or phone is required"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"address",children:"Address (Optional)"}),e.jsx("input",{type:"text",id:"address",value:y,onChange:s=>A(s.target.value),placeholder:"Enter your address (optional)"})]})]}),!a&&e.jsxs("div",{className:"login-method-toggle",children:[e.jsx("button",{type:"button",className:`toggle-btn ${t==="email"?"active":""}`,onClick:()=>g("email"),children:"Email"}),e.jsx("button",{type:"button",className:`toggle-btn ${t==="phone"?"active":""}`,onClick:()=>g("phone"),children:"Phone"})]}),!a&&t==="email"&&e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"email",children:"Email"}),e.jsx("input",{type:"email",id:"email",value:i,onChange:s=>x(s.target.value),placeholder:"Enter your email",required:!a&&t==="email"})]}),!a&&t==="phone"&&e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"phone",children:"Phone Number"}),e.jsx("input",{type:"tel",id:"phone",value:c,onChange:s=>C(s,!1),placeholder:"Enter your phone (e.g., 123-456-7890)",required:!a&&t==="phone"}),e.jsx("small",{style:{color:"var(--color-text)",opacity:.7},children:"Enter your registered phone number (10 digits, optional +91 prefix)"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"password",children:"Password"}),e.jsx("input",{type:"password",id:"password",value:d,onChange:s=>k(s.target.value),placeholder:"Enter your password",required:!0})]}),e.jsx("button",{type:"submit",className:"login-button",disabled:b,children:b?"Please wait...":a?"Create Account":"Sign In"})]}),e.jsx("div",{className:"login-footer",children:e.jsx("p",{children:a?e.jsxs(e.Fragment,{children:["Already have an account?"," ",e.jsx("a",{href:"#",onClick:s=>{s.preventDefault(),j(!1),l("")},children:"Sign in"})]}):e.jsxs(e.Fragment,{children:["Don't have an account?"," ",e.jsx("a",{href:"#",onClick:s=>{s.preventDefault(),j(!0),l("")},children:"Create one"}),e.jsx("br",{}),e.jsx("span",{style:{marginTop:"0.5rem",display:"block"},children:e.jsx(M,{to:"/change-password",style:{color:"var(--color-secondary)",fontWeight:700,textDecoration:"none"},children:"Change Password"})}),e.jsxs("span",{style:{marginTop:"0.5rem",display:"block"},children:[e.jsx("input",{type:"text",value:E,onChange:s=>D(s.target.value),placeholder:"Reset reason (optional)",style:{width:"100%",marginBottom:"0.4rem"}}),e.jsx("button",{type:"button",className:"login-button",onClick:L,children:"Request Password Reset"})]})]})})}),!a&&e.jsxs("div",{className:"demo-credentials",children:[e.jsx("p",{children:e.jsx("strong",{children:"Demo Credentials:"})}),e.jsx("p",{children:"Admin: admin@admin.com / admin123"})]})]})})}export{V as default};
