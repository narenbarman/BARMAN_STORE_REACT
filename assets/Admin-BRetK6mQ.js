import{c as Te,r as n,j as e,b as Ts,P as js,X as we,p as be,g as Fs,h as es,i as Ws,k as wt,s as ma,l as xs,m as He,e as ct,n as Ut,T as ha,O as Mt,q as ot,t as $s,d as pa,u as xa,L as Js,M as ja,v as kt,C as dt,w as ga,x as Dt,y as ut,o as Xs}from"./index-DzGHLpa5.js";import{g as ft,u as yt,M as Nt,a as ba}from"./MobileBottomSheet-b-SxHdIS.js";import{f as Q,a as mt,g as va}from"./formatters-C_RfwIqz.js";import{S as _t}from"./search-DON9pjVo.js";import{P as Pe}from"./plus-O5hZR1MK.js";import{T as ss}from"./trash-2-DnurnG26.js";import{P as fa}from"./phone-C54juCtE.js";import{M as ya}from"./map-pin-CczOKtuj.js";import{P as Na,p as Bt,e as Ce}from"./printService-BaZtc1Jp.js";import{f as _a,g as Ns,t as Ca}from"./dateTime-BT6xQjkF.js";import{R as At}from"./rotate-ccw-DTQ_WBV5.js";import{E as Qt,D as Gt}from"./eye-zEiioHd5.js";import{R as vt}from"./refresh-cw-CDEAC0yM.js";import{M as Pt}from"./minus-DJ1Rq7RF.js";import{A as Sa}from"./alert-circle-BCZKslQ1.js";import{C as Vt}from"./clock-RVr5wID1.js";import{C as wa}from"./check-circle-CQyckcTV.js";import{b as Ht,F as Tt}from"./whatsapp-Bk8hIOWH.js";import{c as ka,a as Da,b as Aa,s as Pa,d as Ta,U as Fa}from"./pdfService-D2MVC0JI.js";import{S as Ft}from"./shopping-bag-CouVmPl1.js";import{T as Ea}from"./truck-DUBAnJJj.js";const $a=Te("AlertTriangle",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z",key:"c3ski4"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]),Et=Te("ArrowDown",[["path",{d:"M12 5v14",key:"s699le"}],["path",{d:"m19 12-7 7-7-7",key:"1idqje"}]]),ht=Te("ArrowUp",[["path",{d:"m5 12 7-7 7 7",key:"hav0vg"}],["path",{d:"M12 19V5",key:"x0mq9r"}]]),Ra=Te("BarChart2",[["line",{x1:"18",x2:"18",y1:"20",y2:"10",key:"1xfpm4"}],["line",{x1:"12",x2:"12",y1:"20",y2:"4",key:"be30l9"}],["line",{x1:"6",x2:"6",y1:"20",y2:"14",key:"1r4le6"}]]),$t=Te("Calendar",[["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",ry:"2",key:"eu3xkr"}],["line",{x1:"16",x2:"16",y1:"2",y2:"6",key:"m3sa8f"}],["line",{x1:"8",x2:"8",y1:"2",y2:"6",key:"18kwsl"}],["line",{x1:"3",x2:"21",y1:"10",y2:"10",key:"xt86sb"}]]),La=Te("CheckCircle2",[["path",{d:"M12 22c5.523 0 10-4.477 10-10S17.523 2 12 2 2 6.477 2 12s4.477 10 10 10z",key:"14v8dr"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]),Ia=Te("Check",[["polyline",{points:"20 6 9 17 4 12",key:"10jjfj"}]]),pt=Te("FolderOpen",[["path",{d:"m6 14 1.45-2.9A2 2 0 0 1 9.24 10H20a2 2 0 0 1 1.94 2.5l-1.55 6a2 2 0 0 1-1.94 1.5H4a2 2 0 0 1-2-2V5c0-1.1.9-2 2-2h3.93a2 2 0 0 1 1.66.9l.82 1.2a2 2 0 0 0 1.66.9H18a2 2 0 0 1 2 2v2",key:"1nmvlm"}]]),Oa=Te("Gift",[["polyline",{points:"20 12 20 22 4 22 4 12",key:"nda8fc"}],["rect",{width:"20",height:"5",x:"2",y:"7",key:"wkgdzj"}],["line",{x1:"12",x2:"12",y1:"22",y2:"7",key:"1n8zgp"}],["path",{d:"M12 7H7.5a2.5 2.5 0 0 1 0-5C11 2 12 7 12 7z",key:"zighg4"}],["path",{d:"M12 7h4.5a2.5 2.5 0 0 0 0-5C13 2 12 7 12 7z",key:"1pa5tk"}]]),Rt=Te("History",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M12 7v5l4 2",key:"1fdv2h"}]]),za=Te("KeyRound",[["path",{d:"M2 18v3c0 .6.4 1 1 1h4v-3h3v-3h2l1.4-1.4a6.5 6.5 0 1 0-4-4Z",key:"167ctg"}],["circle",{cx:"16.5",cy:"7.5",r:".5",key:"1kog09"}]]),Rs=Te("PenSquare",[["path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1qinfi"}],["path",{d:"M18.5 2.5a2.12 2.12 0 0 1 3 3L12 15l-4 1 1-4Z",key:"w2jsv5"}]]),qa=Te("Pen",[["path",{d:"M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z",key:"5qss01"}]]),Ua=Te("QrCode",[["rect",{width:"5",height:"5",x:"3",y:"3",rx:"1",key:"1tu5fj"}],["rect",{width:"5",height:"5",x:"16",y:"3",rx:"1",key:"1v8r4q"}],["rect",{width:"5",height:"5",x:"3",y:"16",rx:"1",key:"1x03jg"}],["path",{d:"M21 16h-3a2 2 0 0 0-2 2v3",key:"177gqh"}],["path",{d:"M21 21v.01",key:"ents32"}],["path",{d:"M12 7v3a2 2 0 0 1-2 2H7",key:"8crl2c"}],["path",{d:"M3 12h.01",key:"nlz23k"}],["path",{d:"M12 3h.01",key:"n36tog"}],["path",{d:"M12 16v.01",key:"133mhm"}],["path",{d:"M16 12h1",key:"1slzba"}],["path",{d:"M21 12v.01",key:"1lwtk9"}],["path",{d:"M12 21v-1",key:"1880an"}]]),xt=Te("TrendingUp",[["polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17",key:"126l90"}],["polyline",{points:"16 7 22 7 22 13",key:"kwv8wd"}]]),jt=Te("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]]),ls=i=>String(i||"").trim(),Lt=ls(void 0),It=ls(void 0),Ot=ls(void 0),Ma="https://api.unsplash.com/search/photos",Ba=({name:i,brand:j,content:k,category:w,query:c})=>{const U=ls(c);return U||[ls(j),ls(i),ls(k),ls(w),"product packshot"].filter(Boolean).join(" ")},zt=(i,j)=>{const k=encodeURIComponent(i||"product-image"),w=[];for(let c=0;c<j;c+=1){const U=`${k}-${c+1}`;w.push({id:`fallback-${U}`,thumbUrl:`https://picsum.photos/seed/${U}/320/220`,fullUrl:`https://picsum.photos/seed/${U}/800/520`,source:"fallback",title:`Suggestion ${c+1}`})}return w},Qa=async(i,j)=>{if(!Lt||!It)return[];const k=new URLSearchParams({key:Lt,cx:It,q:i,searchType:"image",num:String(Math.max(1,Math.min(10,Number(j)||4))),safe:"active"}),w=await fetch(`https://www.googleapis.com/customsearch/v1?${k.toString()}`);if(!w.ok)throw new Error("Google image search request failed");const c=await w.json();return(Array.isArray(c==null?void 0:c.items)?c.items:[]).slice(0,j).map((u,R)=>{var N,G;return{id:`google-cse-${u.cacheId||R}`,thumbUrl:((N=u==null?void 0:u.image)==null?void 0:N.thumbnailLink)||(u==null?void 0:u.link)||"",fullUrl:(u==null?void 0:u.link)||((G=u==null?void 0:u.image)==null?void 0:G.contextLink)||"",source:"google-cse",title:(u==null?void 0:u.title)||(u==null?void 0:u.snippet)||`Suggestion ${R+1}`}}).filter(u=>u.fullUrl)},Ga=async(i,j)=>{if(!Ot)return[];const k=new URLSearchParams({query:i,per_page:String(j),orientation:"landscape"}),w=await fetch(`${Ma}?${k.toString()}`,{headers:{Authorization:`Client-ID ${Ot}`}});if(!w.ok)throw new Error("Unsplash request failed");const c=await w.json();return(Array.isArray(c==null?void 0:c.results)?c.results:[]).slice(0,j).map((u,R)=>{var N,G,Z,_,D,v;return{id:`unsplash-${u.id||R}`,thumbUrl:((N=u==null?void 0:u.urls)==null?void 0:N.small)||((G=u==null?void 0:u.urls)==null?void 0:G.thumb)||((Z=u==null?void 0:u.urls)==null?void 0:Z.regular)||"",fullUrl:((_=u==null?void 0:u.urls)==null?void 0:_.regular)||((D=u==null?void 0:u.urls)==null?void 0:D.full)||((v=u==null?void 0:u.urls)==null?void 0:v.small)||"",source:"unsplash",title:(u==null?void 0:u.alt_description)||(u==null?void 0:u.description)||`Suggestion ${R+1}`}}).filter(u=>u.fullUrl)},Va=async(i={})=>{const j=Math.max(1,Math.min(12,Number(i.limit||4))),k=Ba(i);if(!k)return{query:"",images:zt("product-image",j)};try{const w=await Qa(k,j);if(w.length)return{query:k,images:w}}catch{}try{const w=await Ga(k,j);if(w.length)return{query:k,images:w}}catch{}return{query:k,images:zt(k,j)}},gt=i=>{const j=String(i||"").trim();if(!j)return"";try{const k=new URL(j);return k.protocol==="http:"||k.protocol==="https:"?k.href:""}catch{return""}};function Ha({value:i,onChange:j,productMeta:k={},disabled:w=!1}){const[c,U]=n.useState(!1),[u,R]=n.useState(""),[N,G]=n.useState(""),[Z,_]=n.useState([]),D=String(i||"").trim(),v=n.useMemo(()=>[String((k==null?void 0:k.brand)||"").trim(),String((k==null?void 0:k.name)||"").trim(),String((k==null?void 0:k.content)||"").trim(),String((k==null?void 0:k.category)||"").trim(),"product packshot"].filter(Boolean).join(" "),[k]),J=E=>{const ae=String(E.target.value||"");j(ae),u&&R("")},M=async()=>{U(!0),R("");try{const E=await Va({...k,limit:4});G(E.query||""),_(Array.isArray(E.images)?E.images.slice(0,4):[])}catch(E){R((E==null?void 0:E.message)||"Image search failed"),_([])}finally{U(!1)}},C=E=>{const ae=gt((E==null?void 0:E.fullUrl)||(E==null?void 0:E.thumbUrl)||"");if(!ae){R("Selected image URL is invalid");return}j(ae),R("")};return e.jsxs("div",{className:"image-url-picker",children:[e.jsxs("div",{className:"image-url-picker-row",children:[e.jsx("input",{type:"url",id:"image",name:"image",value:D,onChange:J,placeholder:"https://example.com/image.jpg",className:"input-field",disabled:w}),e.jsxs("button",{type:"button",className:"image-search-btn",onClick:M,disabled:w||c,children:[e.jsx(_t,{size:16}),c?"Searching...":"Search"]})]}),e.jsx("small",{className:"field-help",children:N?`Search used: ${N}`:`Auto query preview: ${v||"product packshot"}`}),u&&e.jsx("span",{className:"field-error",children:u}),Z.length>0&&e.jsx("div",{className:"image-choice-grid",children:Z.map(E=>{const ae=gt(E.fullUrl)===gt(D);return e.jsxs("button",{type:"button",className:`image-choice-card${ae?" selected":""}`,onClick:()=>C(E),title:E.title||"Image option",children:[e.jsx("img",{src:ft(E.thumbUrl||E.fullUrl),alt:E.title||"Image option",loading:"lazy"}),e.jsx("span",{children:E.title||"Image option"})]},E.id)})})]})}function Ka({product:i,onClose:j,onSave:k}){const w=()=>({name:"",description:"",brand:"",content:"",color:"",price:"",mrp:"",uom:"pcs",base_unit:"pcs",uom_type:"selling",conversion_factor:"1",barcode:"",sku:"",image:"",stock:"",expiry_date:"",category:"",defaultDiscount:"",discountType:"fixed"}),[c,U]=n.useState(w()),[u,R]=n.useState([]),[N,G]=n.useState(!1),[Z,_]=n.useState(""),[D,v]=n.useState({}),[J,M]=n.useState([]),[C,E]=n.useState(!0),ae=[{value:"pcs",label:"Pieces (pcs)"},{value:"kg",label:"Kilogram (kg)"},{value:"g",label:"Gram (g)"},{value:"l",label:"Liter (l)"},{value:"ml",label:"Milliliter (ml)"},{value:"box",label:"Box"},{value:"pack",label:"Pack"},{value:"case",label:"Case (24 pcs)"},{value:"dozen",label:"Dozen (12 pcs)"}];n.useEffect(()=>{var f,$,m,S,F;se(),i?(U({name:i.name||"",description:i.description||"",brand:i.brand||"",content:i.content||"",color:i.color||"",price:((f=i.price)==null?void 0:f.toString())||"",mrp:(($=i.mrp)==null?void 0:$.toString())||"",uom:i.uom||"pcs",base_unit:i.base_unit||"pcs",uom_type:i.uom_type||"selling",conversion_factor:((m=i.conversion_factor)==null?void 0:m.toString())||"1",barcode:i.barcode||"",sku:i.sku||"",image:i.image||"",stock:((S=i.stock)==null?void 0:S.toString())||"",expiry_date:i.expiry_date||"",category:i.category||"",defaultDiscount:((F=i.defaultDiscount)==null?void 0:F.toString())||"",discountType:i.discountType||"fixed"}),E(!1)):(U(w()),M([]),E(!0))},[i]);const se=async()=>{try{const f=await Ts.getAll();R(f)}catch(f){console.error("Error fetching categories:",f)}},d=(f=c)=>{const $=X=>String(X||"").replace(/[^a-zA-Z0-9]/g,"").toUpperCase(),m=$(f.name).slice(0,4).padEnd(4,"X"),S=$(f.brand).slice(0,4).padEnd(4,"X"),F=$(f.content).slice(0,2).padEnd(2,"X"),re=Math.round(parseFloat(f.mrp)||parseFloat(f.price)||0),g=String(re).replace(/\D/g,"").slice(-4).padStart(4,"0");return`${m}${S}${F}${g}`},A=(f=c)=>{const $=(f.name||"").trim();if(!$)return"";const m=(f.brand||"").trim(),S=(f.content||"").trim(),F=(f.category||"").trim(),re=(f.color||"").trim(),g=[$];m&&g.push(`by ${m}`),S&&g.push(`(${S})`);let X=g.join(" ");return F&&(X+=` in ${F} category`),re&&(X+=`, ${re} variant`),X+=". Quality product for daily use.",X},W=()=>{const f=A(c);f&&(U($=>({...$,description:f})),E(!0))},V=f=>{const $={};return f.name.trim()||($.name="Product name is required"),f.description.trim()||($.description="Description is required"),(!f.price||parseFloat(f.price)<=0)&&($.price="Price must be a positive number"),f.category||($.category="Category is required"),(!f.stock||parseInt(f.stock)<0)&&($.stock="Stock must be a non-negative number"),$},K=()=>{const f=V(c);return v(f),Object.keys(f).length===0},y=f=>({name:f.name.trim(),description:f.description.trim(),brand:f.brand.trim(),content:f.content.trim(),color:f.color.trim(),price:parseFloat(f.price),mrp:parseFloat(f.mrp)||parseFloat(f.price),uom:f.uom,base_unit:f.base_unit,uom_type:f.uom_type,barcode:f.barcode.trim(),sku:f.sku,image:f.image.trim(),stock:parseInt(f.stock),conversion_factor:parseFloat(f.conversion_factor)||1,expiry_date:f.expiry_date||null,category:f.category,defaultDiscount:parseFloat(f.defaultDiscount)||0,discountType:f.discountType}),ne=(f=c)=>["name","description","brand","content","color","price","mrp","barcode","sku","image","stock","expiry_date","category","defaultDiscount"].some($=>String(f[$]||"").trim()!==""),te=()=>{if(_(""),!K())return;const f=y(c);M($=>[...$,f]),U($=>({...w(),category:$.category||"",uom:$.uom||"pcs",base_unit:$.base_unit||"pcs",uom_type:$.uom_type||"selling"})),v({}),E(!0)},Ne=f=>{M($=>$.filter((m,S)=>S!==f))},p=f=>{const{name:$,value:m}=f.target,S={...c,[$]:m};if(D[$]&&v(F=>({...F,[$]:""})),["name","brand","content","price","mrp"].includes($)&&(S.sku=d(S)),$==="description"&&E(!1),["name","brand","content","category","color"].includes($)&&(!S.description.trim()||C)){const F=A(S);F&&(S.description=F,E(!0))}U(S)},P=async f=>{f.preventDefault(),_(""),G(!0);try{const $=async({mode:m,payload:S,id:F})=>{var g;const re=(X=!1)=>{const ue=X?{...S,allow_identical:!0}:S;return m==="update"?be.update(F,ue):be.create(ue)};try{return await re(!1)}catch(X){const ue=String(((g=X==null?void 0:X.payload)==null?void 0:g.conflict_type)||"");if(Number(X==null?void 0:X.status)===409&&ue==="identical"){if(!window.confirm(`${X.message}

Do you want to continue anyway?`))throw X;return re(!0)}throw X}};if(i){if(!K())return;const m=y(c);await $({mode:"update",id:i.id,payload:m}),await k({mode:"edit",createdCount:0})}else{const m=[...J];if(ne(c)){if(!K())return;m.push(y(c))}if(!m.length){_("Add at least one product to submit");return}let S=0;for(let F=0;F<m.length;F+=1)try{await $({mode:"create",payload:m[F]}),S+=1}catch(re){S>0&&await k(),_(`Failed at product ${F+1} (${m[F].name}): ${re.message||"Create failed"}. Created ${S} product(s).`);return}await k({mode:"create",createdCount:m.length})}j()}catch($){_($.message||"Failed to save product")}finally{G(!1)}},z=!!i,_e=yt(),Ie=e.jsxs(e.Fragment,{children:[Z&&e.jsx("div",{className:"error-message",children:Z}),e.jsxs("form",{onSubmit:P,className:"product-form",children:[!z&&e.jsxs("div",{className:"form-section batch-section",children:[e.jsx("h3",{className:"section-title",children:"Batch Add Products"}),e.jsxs("p",{className:"batch-help",children:["Fill product details and click ",e.jsx("strong",{children:"Add To Batch"}),". You can submit all queued products at once."]}),e.jsx("div",{className:"batch-actions",children:e.jsxs("button",{type:"button",className:"submit-btn batch-add-btn",onClick:te,disabled:N,children:[e.jsx(Pe,{size:16})," Add To Batch"]})}),J.length>0&&e.jsx("div",{className:"batch-list",children:J.map((f,$)=>e.jsxs("div",{className:"batch-item",children:[e.jsxs("div",{className:"batch-item-info",children:[e.jsx("strong",{children:f.name}),e.jsxs("span",{children:[f.category," | Rs ",Number(f.price||0).toFixed(2)," | Stock: ",f.stock]})]}),e.jsx("button",{type:"button",className:"batch-item-remove",onClick:()=>Ne($),title:"Remove",children:e.jsx(ss,{size:14})})]},`${f.name}-${$}`))})]}),e.jsxs("div",{className:"form-section",children:[e.jsx("h3",{className:"section-title",children:"Basic Information"}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"name",children:"Product Name *"}),e.jsx("input",{type:"text",id:"name",name:"name",value:c.name,onChange:p,placeholder:"Enter product name",className:`input-field ${D.name?"error":""}`}),D.name&&e.jsx("span",{className:"field-error",children:D.name})]}),e.jsxs("div",{className:"form-group",children:[e.jsxs("div",{className:"description-header",children:[e.jsx("label",{htmlFor:"description",children:"Description *"}),e.jsx("button",{type:"button",className:"suggest-description-btn",onClick:W,children:"Suggest"})]}),e.jsx("textarea",{id:"description",name:"description",value:c.description,onChange:p,placeholder:"Enter product description",rows:"3",className:`input-field ${D.description?"error":""}`}),e.jsx("small",{className:"field-help",children:"Description is auto-suggested from product name. You can edit it anytime."}),D.description&&e.jsx("span",{className:"field-error",children:D.description})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"brand",children:"Brand"}),e.jsx("input",{type:"text",id:"brand",name:"brand",value:c.brand,onChange:p,placeholder:"e.g., Nescafe, Parle",className:"input-field"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"content",children:"Content/Size"}),e.jsx("input",{type:"text",id:"content",name:"content",value:c.content,onChange:p,placeholder:"e.g., 250g, 1L, 500ml",className:"input-field"})]})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"color",children:"Color"}),e.jsx("input",{type:"text",id:"color",name:"color",value:c.color,onChange:p,placeholder:"e.g., Brown, White, Red",className:"input-field"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"category",children:"Category *"}),e.jsxs("select",{id:"category",name:"category",value:c.category,onChange:p,className:`input-field ${D.category?"error":""}`,children:[e.jsx("option",{value:"",children:"Select a category"}),u.map(f=>e.jsx("option",{value:f.name,children:f.name},f.id))]}),D.category&&e.jsx("span",{className:"field-error",children:D.category})]})]})]}),e.jsxs("div",{className:"form-section",children:[e.jsx("h3",{className:"section-title",children:"Pricing"}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"price",children:"Selling Price (₹) *"}),e.jsx("input",{type:"number",id:"price",name:"price",value:c.price,onChange:p,placeholder:"0.00",step:"0.01",min:"0",className:`input-field ${D.price?"error":""}`}),D.price&&e.jsx("span",{className:"field-error",children:D.price})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"mrp",children:"MRP (₹)"}),e.jsx("input",{type:"number",id:"mrp",name:"mrp",value:c.mrp,onChange:p,placeholder:"0.00",step:"0.01",min:"0",className:"input-field"})]})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"defaultDiscount",children:"Discount"}),e.jsx("input",{type:"number",id:"defaultDiscount",name:"defaultDiscount",value:c.defaultDiscount,onChange:p,placeholder:"0",step:"0.01",min:"0",className:"input-field"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"discountType",children:"Discount Type"}),e.jsxs("select",{id:"discountType",name:"discountType",value:c.discountType,onChange:p,className:"input-field",children:[e.jsx("option",{value:"fixed",children:"Fixed (₹)"}),e.jsx("option",{value:"percentage",children:"Percentage (%)"})]})]})]})]}),e.jsxs("div",{className:"form-section",children:[e.jsx("h3",{className:"section-title",children:"Inventory"}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"stock",children:"Stock Quantity *"}),e.jsx("input",{type:"number",id:"stock",name:"stock",value:c.stock,onChange:p,placeholder:"0",min:"0",className:`input-field ${D.stock?"error":""}`}),D.stock&&e.jsx("span",{className:"field-error",children:D.stock})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"base_unit",children:"Base Unit"}),e.jsx("select",{id:"base_unit",name:"base_unit",value:c.base_unit,onChange:p,className:"input-field",children:ae.map(f=>e.jsx("option",{value:f.value,children:f.label},f.value))}),e.jsx("small",{className:"field-help",children:"Primary unit for inventory"})]})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"uom",children:"Selling UOM"}),e.jsx("select",{id:"uom",name:"uom",value:c.uom,onChange:p,className:"input-field",children:ae.map(f=>e.jsx("option",{value:f.value,children:f.label},f.value))})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"uom_type",children:"UOM Type"}),e.jsxs("select",{id:"uom_type",name:"uom_type",value:c.uom_type,onChange:p,className:"input-field",children:[e.jsx("option",{value:"selling",children:"Selling Only"}),e.jsx("option",{value:"purchasing",children:"Purchasing Only"}),e.jsx("option",{value:"both",children:"Both Selling & Purchasing"})]})]})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"conversion_factor",children:"Conversion Factor"}),e.jsx("input",{type:"number",id:"conversion_factor",name:"conversion_factor",value:c.conversion_factor,onChange:p,placeholder:"1",step:"0.0001",min:"0",className:"input-field"}),e.jsx("small",{className:"field-help",children:"Selling units per base unit (e.g., 12 for Dozen)"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"expiry_date",children:"Expiry Date"}),e.jsx("input",{type:"date",id:"expiry_date",name:"expiry_date",value:c.expiry_date,onChange:p,className:"input-field"})]})]})]}),e.jsxs("div",{className:"form-section",children:[e.jsx("h3",{className:"section-title",children:"SKU & Barcode"}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{htmlFor:"sku",children:[e.jsx(js,{size:16})," SKU (Auto-generated)"]}),e.jsx("input",{type:"text",id:"sku",name:"sku",value:c.sku,onChange:p,placeholder:"Auto-generated SKU",className:"input-field",readOnly:!z}),e.jsx("small",{className:"field-help",children:"Format: Name[:4] + Brand[:4] + Content[:2] + MRP[:4]"})]}),e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{htmlFor:"barcode",children:[e.jsx(Ua,{size:16})," Barcode"]}),e.jsx("input",{type:"text",id:"barcode",name:"barcode",value:c.barcode,onChange:p,placeholder:"Enter barcode (numeric)",className:"input-field"})]})]})]}),e.jsxs("div",{className:"form-section",children:[e.jsx("h3",{className:"section-title",children:"Product Image"}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"image",children:"Image URL"}),e.jsx(Ha,{value:c.image,disabled:N,productMeta:{name:c.name,brand:c.brand,content:c.content,category:c.category},onChange:f=>{U($=>({...$,image:f}))}})]}),c.image&&e.jsx("div",{className:"image-preview",children:e.jsx("img",{src:ft(c.image),alt:"Product preview",onError:f=>f.target.style.display="none"})})]}),e.jsxs("div",{className:"form-actions",children:[e.jsx("button",{type:"button",className:"cancel-btn",onClick:j,children:"Cancel"}),e.jsx("button",{type:"submit",className:"submit-btn",disabled:N,children:N?"Saving...":z?"Update Product":`Add Product${J.length?` (${J.length} queued)`:""}`})]})]})]});return _e?e.jsx(Nt,{open:!0,title:z?"Edit Product":"Add New Product",onClose:j,className:"product-form-sheet",children:Ie}):e.jsx("div",{className:"product-form-overlay",children:e.jsxs("div",{className:"product-form-container fade-in-up",children:[e.jsxs("div",{className:"product-form-header",children:[e.jsx("h2",{children:z?"Edit Product":"Add New Product"}),e.jsx("button",{className:"close-btn",onClick:j,children:e.jsx(we,{size:24})})]}),Ie]})})}function Wa({onClose:i}){const[j,k]=n.useState([]),[w,c]=n.useState(!0),[U,u]=n.useState(""),[R,N]=n.useState(""),[G,Z]=n.useState(!1),[_,D]=n.useState(null),[v,J]=n.useState({name:"",description:""}),[M,C]=n.useState({});n.useEffect(()=>{E()},[]);const E=async()=>{try{const K=await Ts.getAll();k(K),u("")}catch(K){u("Failed to fetch categories: "+(K.message||"Unknown error"))}finally{c(!1)}},ae=()=>{const K={};return v.name.trim()?v.name.length<2&&(K.name="Category name must be at least 2 characters"):K.name="Category name is required",C(K),Object.keys(K).length===0},se=K=>{const{name:y,value:ne}=K.target;J(te=>({...te,[y]:ne})),M[y]&&C(te=>({...te,[y]:""}))},d=async K=>{if(K.preventDefault(),!!ae()){c(!0),u(""),N("");try{G?(await Ts.update(_,v),N("Category updated successfully")):(await Ts.create(v),N("Category created successfully")),J({name:"",description:""}),Z(!1),D(null),E(),setTimeout(()=>N(""),3e3)}catch(y){u(y.message||"Failed to save category")}finally{c(!1)}}},A=K=>{Z(!0),D(K.id),J({name:K.name,description:K.description||""}),C({})},W=async K=>{if(window.confirm("Are you sure you want to delete this category? Products using this category will not be affected.")){c(!0),u(""),N("");try{await Ts.delete(K),N("Category deleted successfully"),E(),setTimeout(()=>N(""),3e3)}catch(y){u(y.message||"Failed to delete category")}finally{c(!1)}}},V=()=>{Z(!1),D(null),J({name:"",description:""}),C({})};return e.jsx("div",{className:"category-management-overlay",children:e.jsxs("div",{className:"category-management-container fade-in-up",children:[e.jsxs("div",{className:"category-management-header",children:[e.jsx("h2",{children:"Category Management"}),e.jsx("button",{className:"close-btn",onClick:i,children:e.jsx(we,{size:24})})]}),U&&e.jsx("div",{className:"error-message",children:U}),R&&e.jsx("div",{className:"success-message",children:R}),e.jsxs("div",{className:"category-management-content",children:[e.jsxs("div",{className:"category-form-section",children:[e.jsx("h3",{children:G?"Edit Category":"Add New Category"}),e.jsxs("form",{onSubmit:d,className:"category-form",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"name",children:"Category Name *"}),e.jsx("input",{type:"text",id:"name",name:"name",value:v.name,onChange:se,placeholder:"Enter category name",className:M.name?"error":""}),M.name&&e.jsx("span",{className:"field-error",children:M.name})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"description",children:"Description"}),e.jsx("textarea",{id:"description",name:"description",value:v.description,onChange:se,placeholder:"Enter category description",rows:"2"})]}),e.jsxs("div",{className:"form-actions",children:[e.jsx("button",{type:"button",className:"cancel-btn",onClick:V,disabled:w,children:"Cancel"}),e.jsx("button",{type:"submit",className:"submit-btn",disabled:w,children:w?"Saving...":G?"Update Category":"Add Category"})]})]})]}),e.jsxs("div",{className:"categories-list-section",children:[e.jsxs("h3",{children:["Existing Categories (",j.length,")"]}),w&&!j.length?e.jsx("div",{className:"loading-message",children:"Loading categories..."}):j.length===0?e.jsx("div",{className:"empty-message",children:"No categories found. Create your first category above."}):e.jsx("div",{className:"categories-grid",children:j.map(K=>e.jsxs("div",{className:"category-card",children:[e.jsxs("div",{className:"category-info",children:[e.jsx("h4",{children:K.name}),K.description&&e.jsx("p",{className:"category-description",children:K.description})]}),e.jsxs("div",{className:"category-actions",children:[e.jsx("button",{className:"edit-btn",onClick:()=>A(K),title:"Edit category",children:e.jsx(qa,{size:16})}),e.jsx("button",{className:"delete-btn",onClick:()=>W(K.id),title:"Delete category",children:e.jsx(ss,{size:16})})]})]},K.id))})]})]})]})})}function Ja({user:i}){const[j,k]=n.useState([]),[w,c]=n.useState(!0),[U,u]=n.useState(""),[R,N]=n.useState(!1),[G,Z]=n.useState(null),[_,D]=n.useState(""),[v,J]=n.useState({name:"",salesman_name:"",phone:"",email:"",address:"",products_supplied:"",order_day:"",delivery_day:"",payment_terms:"Net 30",status:"active"});n.useEffect(()=>{C()},[]);const M=y=>{if(!y)return{};if(typeof y=="object")return y;try{return JSON.parse(y)}catch{return{}}},C=async()=>{try{c(!0);const y=await Fs.getAll();k(y||[])}catch{u("Failed to load distributors")}finally{c(!1)}},E=y=>{const{name:ne,value:te}=y.target;J(Ne=>({...Ne,[ne]:te}))},ae=async y=>{y.preventDefault(),u("");try{const ne={name:v.name.trim(),salesman_name:v.salesman_name.trim(),contacts:JSON.stringify({phone:v.phone,email:v.email}),address:v.address.trim(),products_supplied:v.products_supplied.trim(),order_day:v.order_day,delivery_day:v.delivery_day,payment_terms:v.payment_terms,status:v.status};G?await Fs.update(G.id,ne):await Fs.create(ne),N(!1),Z(null),A(),C()}catch(ne){u(ne.message||"Failed to save distributor")}},se=y=>{const ne=M(y.contacts);J({name:y.name||"",salesman_name:y.salesman_name||"",phone:ne.phone||"",email:ne.email||"",address:y.address||"",products_supplied:y.products_supplied||"",order_day:y.order_day||"",delivery_day:y.delivery_day||"",payment_terms:y.payment_terms||"Net 30",status:y.status||"active"}),Z(y),N(!0)},d=async y=>{if(window.confirm("Are you sure you want to delete this distributor?"))try{await Fs.delete(y),k(j.filter(ne=>ne.id!==y))}catch{u("Failed to delete distributor")}},A=()=>{J({name:"",salesman_name:"",phone:"",email:"",address:"",products_supplied:"",order_day:"",delivery_day:"",payment_terms:"Net 30",status:"active"})},W=()=>{N(!1),Z(null),A()},V=j.filter(y=>{var ne,te;return y.name.toLowerCase().includes(_.toLowerCase())||((ne=y.salesman_name)==null?void 0:ne.toLowerCase().includes(_.toLowerCase()))||((te=y.products_supplied)==null?void 0:te.toLowerCase().includes(_.toLowerCase()))}),K=y=>y==="active"?e.jsx("span",{className:"status-badge active",children:"Active"}):e.jsx("span",{className:"status-badge inactive",children:"Inactive"});return w?e.jsx("div",{className:"distributor-management",children:e.jsx("div",{className:"loading",children:"Loading distributors..."})}):e.jsxs("div",{className:"distributor-management",children:[e.jsxs("div",{className:"page-header",children:[e.jsx("h1",{children:"Distributor Management"}),e.jsxs("button",{className:"admin-btn primary",onClick:()=>N(!0),children:[e.jsx(Pe,{size:20})," Add Distributor"]})]}),U&&e.jsx("div",{className:"error-message",children:U}),e.jsxs("div",{className:"search-bar",children:[e.jsx(_t,{size:20}),e.jsx("input",{type:"text",placeholder:"Search distributors by name, salesman, or products...",value:_,onChange:y=>D(y.target.value)})]}),e.jsx("div",{className:"distributors-grid",children:V.length===0?e.jsxs("div",{className:"empty-state",children:[e.jsx("p",{children:"No distributors found."}),e.jsx("p",{children:'Click "Add Distributor" to create one.'})]}):V.map(y=>{const ne=M(y.contacts);return e.jsxs("div",{className:"distributor-card fade-in-up",children:[e.jsxs("div",{className:"card-header",children:[e.jsxs("div",{className:"distributor-name",children:[e.jsx("h3",{children:y.name}),K(y.status)]}),e.jsxs("div",{className:"card-actions",children:[e.jsx("button",{className:"action-btn edit",onClick:()=>se(y),children:e.jsx(Rs,{size:16})}),e.jsx("button",{className:"action-btn delete",onClick:()=>d(y.id),children:e.jsx(ss,{size:16})})]})]}),e.jsxs("div",{className:"card-body",children:[y.salesman_name&&e.jsxs("div",{className:"info-row",children:[e.jsx("span",{className:"label",children:"Salesman:"}),e.jsx("span",{className:"value",children:y.salesman_name})]}),e.jsxs("div",{className:"info-row",children:[e.jsx(fa,{size:14}),e.jsx("span",{children:ne.phone||"-"})]}),e.jsxs("div",{className:"info-row",children:[e.jsx("span",{className:"label",children:"Email:"}),e.jsx("span",{children:ne.email||"-"})]}),y.address&&e.jsxs("div",{className:"info-row address",children:[e.jsx(ya,{size:14}),e.jsx("span",{children:y.address})]}),y.products_supplied&&e.jsxs("div",{className:"info-row",children:[e.jsx(js,{size:14}),e.jsx("span",{children:y.products_supplied})]}),e.jsxs("div",{className:"info-row schedule",children:[e.jsxs("div",{className:"schedule-item",children:[e.jsx($t,{size:14}),e.jsxs("span",{children:["Order: ",y.order_day||"-"]})]}),e.jsxs("div",{className:"schedule-item",children:[e.jsx($t,{size:14}),e.jsxs("span",{children:["Delivery: ",y.delivery_day||"-"]})]})]}),e.jsxs("div",{className:"info-row",children:[e.jsx("span",{className:"label",children:"Payment Terms:"}),e.jsx("span",{children:y.payment_terms||"Net 30"})]})]})]},y.id)})}),R&&e.jsx("div",{className:"modal-overlay",onClick:W,children:e.jsxs("div",{className:"modal-content fade-in-up",onClick:y=>y.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h2",{children:G?"Edit Distributor":"Add New Distributor"}),e.jsx("button",{className:"close-btn",onClick:W,children:e.jsx(we,{size:24})})]}),e.jsxs("form",{onSubmit:ae,children:[e.jsxs("div",{className:"form-section",children:[e.jsx("h3",{className:"section-title",children:"Basic Information"}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Distributor Name *"}),e.jsx("input",{type:"text",name:"name",value:v.name,onChange:E,placeholder:"Enter distributor name",required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Salesman Name"}),e.jsx("input",{type:"text",name:"salesman_name",value:v.salesman_name,onChange:E,placeholder:"Enter salesman name"})]})]}),e.jsxs("div",{className:"form-section",children:[e.jsx("h3",{className:"section-title",children:"Contact Information"}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Phone"}),e.jsx("input",{type:"tel",name:"phone",value:v.phone,onChange:E,placeholder:"Enter phone number"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Email"}),e.jsx("input",{type:"email",name:"email",value:v.email,onChange:E,placeholder:"Enter email address"})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Address"}),e.jsx("textarea",{name:"address",value:v.address,onChange:E,placeholder:"Enter full address",rows:"2"})]})]}),e.jsxs("div",{className:"form-section",children:[e.jsx("h3",{className:"section-title",children:"Business Details"}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Products Supplied"}),e.jsx("input",{type:"text",name:"products_supplied",value:v.products_supplied,onChange:E,placeholder:"e.g., Coffee, Tea, Sugar, Biscuits"})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Order Day"}),e.jsxs("select",{name:"order_day",value:v.order_day,onChange:E,children:[e.jsx("option",{value:"",children:"Select day"}),e.jsx("option",{value:"Monday",children:"Monday"}),e.jsx("option",{value:"Tuesday",children:"Tuesday"}),e.jsx("option",{value:"Wednesday",children:"Wednesday"}),e.jsx("option",{value:"Thursday",children:"Thursday"}),e.jsx("option",{value:"Friday",children:"Friday"}),e.jsx("option",{value:"Saturday",children:"Saturday"}),e.jsx("option",{value:"Sunday",children:"Sunday"})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Delivery Day"}),e.jsxs("select",{name:"delivery_day",value:v.delivery_day,onChange:E,children:[e.jsx("option",{value:"",children:"Select day"}),e.jsx("option",{value:"Monday",children:"Monday"}),e.jsx("option",{value:"Tuesday",children:"Tuesday"}),e.jsx("option",{value:"Wednesday",children:"Wednesday"}),e.jsx("option",{value:"Thursday",children:"Thursday"}),e.jsx("option",{value:"Friday",children:"Friday"}),e.jsx("option",{value:"Saturday",children:"Saturday"}),e.jsx("option",{value:"Sunday",children:"Sunday"})]})]})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Payment Terms"}),e.jsxs("select",{name:"payment_terms",value:v.payment_terms,onChange:E,children:[e.jsx("option",{value:"Cash on Delivery",children:"Cash on Delivery"}),e.jsx("option",{value:"Net 15",children:"Net 15"}),e.jsx("option",{value:"Net 30",children:"Net 30"}),e.jsx("option",{value:"Net 45",children:"Net 45"}),e.jsx("option",{value:"Net 60",children:"Net 60"})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Status"}),e.jsxs("select",{name:"status",value:v.status,onChange:E,children:[e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"inactive",children:"Inactive"})]})]})]})]}),e.jsxs("div",{className:"modal-actions",children:[e.jsx("button",{type:"button",className:"cancel-btn",onClick:W,children:"Cancel"}),e.jsx("button",{type:"submit",className:"submit-btn",children:G?"Update Distributor":"Add Distributor"})]})]})]})})]})}const L=i=>{const j=Number(i);return Number.isFinite(j)?j:0},Kt=i=>String((i==null?void 0:i.type)||(i==null?void 0:i.transaction_type)||"").toLowerCase(),Wt=(i,j=["payment"])=>{const k=Math.abs(L(i==null?void 0:i.amount));return j.includes(Kt(i))?-k:k},Jt=i=>{const j=Kt(i);return j==="payment"?"Payment":j==="given"||j==="credit"?"Credit":j?j.charAt(0).toUpperCase()+j.slice(1):"-"},Xt=(i,j=["transaction_date","created_at","date"])=>{for(const k of j){const w=i==null?void 0:i[k];if(!w)continue;const c=new Date(w).getTime();if(Number.isFinite(c))return c}return Date.now()};function Xa({user:i}){const j=yt(),k="purchase_distributor_ledger_local_entries",w=()=>({distributor_id:"",distributor_name:"",order_date:Ns(),notes:"",items:[]}),c=()=>({distributor_id:"",type:"payment",amount:"",payment_mode:"cash",transaction_date:Ns(),reference:"",description:""}),U=s=>Xt(s,["transaction_date","created_at","date"]),u=s=>(s==null?void 0:s.distributor_id)!==void 0&&(s==null?void 0:s.distributor_id)!==null?String(s.distributor_id):s!=null&&s.distributor_name?`name:${String(s.distributor_name).toLowerCase()}`:"unknown",R=s=>{const a=L((s==null?void 0:s.total_amount)??(s==null?void 0:s.grand_total)??(s==null?void 0:s.line_total));if(a>0)return a;const o=(Array.isArray(s==null?void 0:s.items)?s.items:[]).reduce((B,I)=>{const q=L((I==null?void 0:I.line_total)??(I==null?void 0:I.total_amount)??(I==null?void 0:I.total));if(q>0)return B+q;const ee=L(I==null?void 0:I.taxable_value),ge=L(I==null?void 0:I.tax_amount);if(ee>0||ge>0)return B+ee+ge;const ve=L(I==null?void 0:I.quantity),qe=L((I==null?void 0:I.rate)??(I==null?void 0:I.unit_price));return B+ve*qe},0);if(o>0)return o;const x=L(s==null?void 0:s.taxable_value),T=L(s==null?void 0:s.tax_amount);return x>0||T>0?x+T:L(s==null?void 0:s.total)},N=s=>R(s),G=()=>{try{const s=localStorage.getItem(k),a=s?JSON.parse(s):[];return Array.isArray(a)?a:[]}catch{return[]}},Z=s=>{try{localStorage.setItem(k,JSON.stringify(s))}catch{}},_=s=>{const a=G();Z([s,...a])},D=(s,a)=>{const r=new Set(["confirmed","shipped","received"]),o=(s||[]).filter(x=>r.has(String(x.status||"").toLowerCase())).map(x=>({id:`po-${x.id}`,distributor_id:x.distributor_id,distributor_name:x.distributor_name,type:"credit",transaction_type:"credit",amount:R(x),payment_mode:"credit",reference:x.po_number,bill_number:x.bill_number||x.invoice_number||null,description:`Purchase Order ${x.po_number||""}`.trim(),transaction_date:x.created_at||x.order_date||x.expected_delivery||Ns(),mode:"automatic"}));return a?o.filter(x=>String(x.distributor_id)===String(a)):o},v=(s,a,r)=>{const o=Array.isArray(s)?s:[],x=o.length>0?[...o,...a]:[...a,...r],T=[],B=new Set;for(const ge of x){const ve=ge.id||`${ge.distributor_id||""}-${ge.reference||""}-${ge.amount||""}-${U(ge)}`;B.has(ve)||(B.add(ve),T.push(ge))}const I={};return[...T].sort((ge,ve)=>U(ge)-U(ve)).map(ge=>{const ve=u(ge),Ze=(I[ve]||0)+Wt(ge);return I[ve]=Ze,{...ge,computed_balance:Ze}}).sort((ge,ve)=>U(ve)-U(ge))},J=(s,a)=>{const r={};for(const x of s||[]){const T=u(x);r[T]===void 0&&(r[T]=L(x.computed_balance??x.balance))}if(a){const x=String(a);let T=0;for(const[B,I]of Object.entries(r))if(B===x){T=I;break}return{label:"Distributor Balance",value:T}}return{label:"Total Balance (All Distributors)",value:Object.values(r).reduce((x,T)=>x+L(T),0)}},M=s=>{const a=L(s.quantity),r=L(s.rate??s.unit_price),o=a*r,x=s.discount_type==="fixed"?"fixed":"percent",T=L(s.discount_value),B=x==="percent"?o*T/100:T,I=Math.max(0,Math.min(B,o)),q=Math.max(0,o-I),ee=Math.max(0,L(s.gst_rate)),ge=q*ee/100,ve=q+ge;return{quantity:a,rate:r,grossAmount:o,discountType:x,discountValue:T,discountAmount:I,taxableValue:q,gstRate:ee,taxAmount:ge,totalAmount:ve}},C=(s=[])=>s.reduce((a,r)=>{const o=M(r);return a.grossAmount+=o.grossAmount,a.discountAmount+=o.discountAmount,a.taxableValue+=o.taxableValue,a.taxAmount+=o.taxAmount,a.totalAmount+=o.totalAmount,a},{grossAmount:0,discountAmount:0,taxableValue:0,taxAmount:0,totalAmount:0}),[E,ae]=n.useState("orders"),[se,d]=n.useState([]),[A,W]=n.useState([]),[V,K]=n.useState([]),[y,ne]=n.useState([]),[te,Ne]=n.useState(!0),[p,P]=n.useState(""),[z,_e]=n.useState({distributor_id:"",status:"",start_date:"",end_date:""}),[Ie,f]=n.useState(!1),[$,m]=n.useState(!1),[S,F]=n.useState(!1),[re,g]=n.useState(!1),[X,ue]=n.useState(!1),[H,xe]=n.useState(null),[Me,he]=n.useState(null),[Fe,fe]=n.useState([]),[ts,as]=n.useState(!1),[O,ie]=n.useState(c()),[me,le]=n.useState(!1),[oe,ns]=n.useState(null),[Be,$e]=n.useState(!1),[Re,gs]=n.useState(null),[Se,ke]=n.useState({distributor_id:"",distributor_name:"",expected_delivery:"",notes:"",items:[]}),[De,Oe]=n.useState(w()),[Qe,Ke]=n.useState({invoice_number:"",items:[]}),[Le,Ee]=n.useState({distributor_id:"",reference_po:"",return_type:"return",reason:"",items:[]});n.useEffect(()=>{Zs()},[]),n.useEffect(()=>{We()},[z]),n.useEffect(()=>{E==="orders"&&os()},[E,z.distributor_id,se]);const Zs=async()=>{try{Ne(!0);const[s,a]=await Promise.all([Fs.getAll(),be.getAll()]);K(s||[]),ne(a||[])}catch{P("Failed to load data")}finally{Ne(!1)}},We=async()=>{try{const s=await es.getAll(z);d(s||[])}catch{P("Failed to load purchase orders")}},Ls=async()=>{try{const s=await wt.getAll(z);W(s||[])}catch{P("Failed to load purchase returns")}},cs=s=>{const{name:a,value:r}=s.target;_e(o=>({...o,[a]:r}))},_s=s=>{const a=String(s||"").trim().toLowerCase();return a&&V.find(r=>r.status==="active"&&(String(r.id)===a||String(r.name||"").trim().toLowerCase()===a))||null},bs=s=>{const a=String(s||"").trim();if(!a)return{prioritized:[],all:y};const r=new Map(y.map(q=>[String(q.id),q])),o=new Map;(se||[]).forEach(q=>{if(String((q==null?void 0:q.distributor_id)||"")!==a)return;const ee=new Date((q==null?void 0:q.created_at)||(q==null?void 0:q.order_date)||(q==null?void 0:q.expected_delivery)||0).getTime();(Array.isArray(q==null?void 0:q.items)?q.items:[]).forEach(ve=>{const qe=String((ve==null?void 0:ve.product_id)||"").trim();if(!qe)return;const Ze=o.get(qe)||{count:0,latest:0};o.set(qe,{count:Ze.count+1,latest:Math.max(Ze.latest,Number.isFinite(ee)?ee:0)})})});const T=[...o.entries()].sort((q,ee)=>ee[1].latest!==q[1].latest?ee[1].latest-q[1].latest:ee[1].count-q[1].count).map(([q])=>q).map(q=>r.get(q)).filter(Boolean),B=new Set(T.map(q=>String(q.id))),I=y.filter(q=>!B.has(String(q.id)));return{prioritized:T,all:I}},Cs=s=>{const a=_s(s);ke(r=>({...r,distributor_name:s,distributor_id:a?String(a.id):""}))},ce=s=>{const a=_s(s);Oe(r=>({...r,distributor_name:s,distributor_id:a?String(a.id):""}))},Is=s=>{if(!s)return"";const a=String(s);if(/^\d{4}-\d{2}-\d{2}/.test(a))return a.slice(0,10);const r=new Date(s);return Number.isNaN(r.getTime())?"":Ca(r)},Ss=()=>{ke(s=>({...s,items:[...s.items,{product_id:"",product_query:"",product_name:"",quantity:1,uom:"pcs",unit_price:0,rate:0,gst_rate:5,discount_type:"percent",discount_value:0}]}))},os=async()=>{try{as(!0);const s=G().filter(x=>!z.distributor_id||String(x.distributor_id)===String(z.distributor_id)),a=D(se,z.distributor_id),r=z.distributor_id?await Ws.getByDistributor(z.distributor_id,{limit:100}):await Ws.getAll({limit:100}),o=Array.isArray(r)?r:(r==null?void 0:r.rows)||(r==null?void 0:r.data)||(r==null?void 0:r.transactions)||[];fe(v(o,s,a))}catch{const a=G().filter(o=>!z.distributor_id||String(o.distributor_id)===String(z.distributor_id)),r=D(se,z.distributor_id);fe(v([],a,r))}finally{as(!1)}},et=async({distributorId:s,amount:a,poNumber:r,orderId:o,billNumber:x})=>{!s||a<=0||await Ws.addTransaction(s,{type:"credit",transaction_type:"credit",amount:Number(a.toFixed(2)),payment_mode:"credit",reference:r||(o?`PO-${o}`:""),bill_number:x||null,description:`Purchase Order ${r||""}${x?` (Bill: ${x})`:""}`.trim(),transactionDate:Ns(),source:"purchase_order",source_id:o,mode:"automatic",created_by:i==null?void 0:i.id})},Je=async(s,a,r)=>{const o=[...Se.items];if(o[s][a]=r,a==="product_id"){const x=String(r||""),T=y.find(B=>String(B.id)===x);if(T){const B=L(T.price);o[s].product_name=T.name,o[s].product_query=T.name,o[s].unit_price=B,o[s].rate=B,o[s].uom=T.uom||"pcs",o[s].last_purchase_hint=""}else o[s].product_query="",o[s].product_name="",o[s].last_purchase_hint="";if(ke(B=>({...B,items:o})),!x)return;try{const B=await be.getLastPurchase(x);if(!(B!=null&&B.found))return;ke(I=>{const q=[...I.items],ee=q[s];if(!ee||String(ee.product_id)!==x)return I;const ge=L(B.rate??B.unit_price??ee.rate??ee.unit_price),ve=L(B.gst_rate??ee.gst_rate??5),qe=B.created_at?new Date(B.created_at).toLocaleDateString():"",Ze=B.po_number||"last PO";return q[s]={...ee,unit_price:ge,rate:ge,gst_rate:ve,uom:B.uom||ee.uom||"pcs",last_purchase_hint:`Suggested from ${Ze}${qe?` (${qe})`:""}`},{...I,items:q}})}catch{}return}a==="rate"&&(o[s].unit_price=L(r)),a==="unit_price"&&(o[s].rate=L(r)),ke(x=>({...x,items:o}))},ws=s=>{ke(a=>({...a,items:a.items.filter((r,o)=>o!==s)}))},ks=()=>{ke({distributor_id:"",distributor_name:"",expected_delivery:"",notes:"",items:[]}),gs(null)},pe=()=>{P(""),ks(),f(!0)},rs=()=>{f(!1),ks()},Os=async s=>{s.preventDefault(),P("");try{if(!V.find(I=>String(I.id)===String(Se.distributor_id)&&I.status==="active")){P("Please select a valid distributor");return}if(Se.items.filter(I=>String(I.product_query||"").trim()&&!I.product_id).length>0){P("Please select valid products from suggestions for all typed product names");return}const o=Se.items.filter(I=>I.product_id&&I.quantity>0);if(o.length===0){P("Please add at least one item");return}const x=o.map(I=>{const q=M(I);return{...I,quantity:q.quantity,unit_price:q.rate,rate:q.rate,gst_rate:q.gstRate,discount_type:q.discountType,discount_value:q.discountValue,taxable_value:q.taxableValue,tax_amount:q.taxAmount,line_total:q.totalAmount}}),T=C(x),B={distributor_id:Se.distributor_id,expected_delivery:Se.expected_delivery,notes:Se.notes,subtotal:T.taxableValue,taxable_value:T.taxableValue,tax_amount:T.taxAmount,total_amount:T.totalAmount,grand_total:T.totalAmount,total:T.totalAmount,items:x,created_by:i==null?void 0:i.id};Re?await es.update(Re,B):await es.create(B),rs(),await We()}catch(a){P(a.message||(Re?"Failed to update purchase order":"Failed to create purchase order"))}},Ds=async s=>{var a;try{P("");const r=await es.getById(s);if(!r||String(r.status||"").toLowerCase()!=="pending"){P("Only pending orders can be edited");return}const o=(r.items||[]).map(x=>({product_id:x.product_id?String(x.product_id):"",product_query:x.product_name||"",product_name:x.product_name||"",quantity:L(x.quantity),uom:x.uom||"pcs",unit_price:L(x.unit_price??x.rate),rate:L(x.rate??x.unit_price),gst_rate:L(x.gst_rate),discount_type:x.discount_type==="fixed"?"fixed":"percent",discount_value:L(x.discount_value),last_purchase_hint:""}));ke({distributor_id:r.distributor_id?String(r.distributor_id):"",distributor_name:r.distributor_name||((a=V.find(x=>String(x.id)===String(r.distributor_id)))==null?void 0:a.name)||"",expected_delivery:Is(r.expected_delivery),notes:r.notes||"",items:o}),gs(r.id),f(!0)}catch(r){P(r.message||"Failed to load order for edit")}},Ge=()=>{Oe(s=>({...s,items:[...s.items,{product_id:"",product_query:"",product_name:"",quantity:1,uom:"pcs"}]}))},vs=s=>{Oe(a=>({...a,items:a.items.filter((r,o)=>o!==s)}))},ds=(s,a,r)=>{const o=[...De.items];if(o[s][a]=r,a==="product_id"){const x=String(r||""),T=y.find(B=>String(B.id)===x);T?(o[s].product_name=T.name,o[s].product_query=T.name,o[s].uom=T.uom||"pcs"):(o[s].product_query="",o[s].product_name="")}Oe(x=>({...x,items:o}))},us=()=>{m(!1),Oe(w())},ze=async s=>{s.preventDefault(),P("");try{if(!V.find(T=>String(T.id)===String(De.distributor_id)&&T.status==="active")){P("Please select a valid distributor");return}if(De.items.filter(T=>String(T.product_query||"").trim()&&!T.product_id).length>0){P("Please select valid products from suggestions for all typed product names");return}const o=De.items.filter(T=>T.product_id&&L(T.quantity)>0);if(o.length===0){P("Please add at least one item");return}const x=o.map(T=>({product_id:Number(T.product_id),product_name:T.product_name,quantity:L(T.quantity),uom:T.uom||"pcs",unit_price:0,rate:0,gst_rate:0,discount_type:"percent",discount_value:0,taxable_value:0,tax_amount:0,line_total:0}));await es.create({distributor_id:Number(De.distributor_id),expected_delivery:De.order_date,notes:De.notes||"Quick entry draft",subtotal:0,taxable_value:0,tax_amount:0,total_amount:0,grand_total:0,total:0,items:x,created_by:i==null?void 0:i.id}),us(),await We()}catch(a){P(a.message||"Failed to create quick purchase order")}},zs=s=>{var a;xe(s),Ke({invoice_number:"",items:((a=s.items)==null?void 0:a.map(r=>({item_id:r.id,product_id:r.product_id,product_name:r.product_name,ordered_quantity:r.quantity,received_quantity:r.quantity-(r.received_quantity||0),unit_price:r.unit_price})))||[]}),F(!0)},Xe=(s,a,r)=>{const o=[...Qe.items];o[s][a]=r,Ke(x=>({...x,items:o}))},qs=(s,a)=>{const r=Qe.items[s];if(!r)return;const o=L(r.received_quantity),x=Math.max(0,Math.min(L(r.ordered_quantity),o+a));Xe(s,"received_quantity",x)},Us=async s=>{s.preventDefault(),P("");try{const a=Qe.items.filter(r=>r.received_quantity>0);if(a.length===0){P("Please receive at least one item");return}await es.receive(H.id,{invoice_number:Qe.invoice_number,items:a,received_by:i==null?void 0:i.id}),F(!1),xe(null),Ke({invoice_number:"",items:[]}),We()}catch(a){P(a.message||"Failed to receive inventory")}},st=async(s,a)=>{try{P("");let r=se.find(x=>String(x.id)===String(s)),o="";if(a==="confirmed"){const x=String((r==null?void 0:r.bill_number)||(r==null?void 0:r.invoice_number)||"").trim(),T=window.prompt("Enter Bill No (optional). Leave blank to continue.",x);if(T===null)return;o=String(T).trim()}if(await es.updateStatus(s,a,o?{bill_number:o}:{}),a==="confirmed"){try{const x=await es.getById(s);x&&(r=x)}catch{}if(r)try{await et({distributorId:r.distributor_id,amount:R(r),poNumber:r.po_number,orderId:r.id,billNumber:o||r.bill_number||r.invoice_number||""})}catch(x){console.warn("Auto distributor credit entry failed on confirmation:",x)}}We(),os()}catch{P("Failed to update status")}},ms=async s=>{if(window.confirm("Are you sure you want to delete this purchase order?"))try{await es.delete(s),We()}catch{P("Failed to delete order")}},je=async s=>{try{le(!0),ns(null),$e(!0);const a=await es.getById(s);ns(a)}catch{P("Failed to load order details"),le(!1)}finally{$e(!1)}},tt=()=>{Ee({distributor_id:"",reference_po:"",return_type:"return",reason:"",items:[]}),g(!0)},Ms=()=>{Ee(s=>({...s,items:[...s.items,{product_id:"",product_name:"",quantity:1,uom:"pcs",unit_price:0,reason:""}]}))},fs=(s,a,r)=>{const o=[...Le.items];if(o[s][a]=r,a==="product_id"){const x=y.find(T=>T.id===parseInt(r));x&&(o[s].product_name=x.name,o[s].unit_price=x.price,o[s].uom=x.uom||"pcs")}Ee(x=>({...x,items:o}))},ys=s=>{Ee(a=>({...a,items:a.items.filter((r,o)=>o!==s)}))},at=async s=>{s.preventDefault(),P("");try{const a=Le.items.filter(r=>r.product_id&&r.quantity>0);if(a.length===0){P("Please add at least one item");return}await wt.create({distributor_id:Le.distributor_id,reference_po:Le.reference_po,return_type:Le.return_type,reason:Le.reason,items:a,created_by:i==null?void 0:i.id}),g(!1),Ee({distributor_id:"",reference_po:"",return_type:"return",reason:"",items:[]}),Ls()}catch(a){P(a.message||"Failed to create return")}},nt=s=>{const r={pending:{label:"Pending",class:"pending"},confirmed:{label:"Confirmed",class:"confirmed"},shipped:{label:"Shipped",class:"shipped"},received:{label:"Received",class:"received"},cancelled:{label:"Cancelled",class:"cancelled"}}[s]||{label:s,class:""};return e.jsx("span",{className:`status-badge ${r.class}`,children:r.label})},Bs=s=>{if(!s)return"";if(typeof s=="object"&&s.phone)return String(s.phone);const a=String(s).trim();if(!a)return"";try{const r=JSON.parse(a);return String((r==null?void 0:r.phone)||"")}catch{return""}},Qs=s=>{if(!s)return{name:"-",phone:"-",address:"-",contacts:""};const a=V.find(x=>String(x.id)===String(s.distributor_id)),r=s.distributor_contacts||(a==null?void 0:a.contacts)||"",o=Bs(r);return{name:s.distributor_name||(a==null?void 0:a.name)||"-",phone:s.distributor_phone||(a==null?void 0:a.phone)||o||"-",address:s.distributor_address||(a==null?void 0:a.address)||"-",contacts:r}},Gs=s=>{const a=L(s==null?void 0:s.quantity),r=L((s==null?void 0:s.rate)??(s==null?void 0:s.unit_price)),o=a*r,x=L(s==null?void 0:s.taxable_value),T=L(s==null?void 0:s.tax_amount),B=L((s==null?void 0:s.line_total)??(s==null?void 0:s.total)??x+T??o),I=x>0?x:T>0?Math.max(0,B-T):B,q=L(s==null?void 0:s.gst_rate);return{quantity:a,rate:r,taxableValue:I,taxAmount:T,lineTotal:B>0?B:o,gstRate:q}},Vs=s=>{const a=Array.isArray(s==null?void 0:s.items)?s.items:[],r=Qs(s),o=a.map((I,q)=>{const ee=Gs(I);return`
        <tr>
          <td>${q+1}</td>
          <td>${Ce((I==null?void 0:I.product_name)||"-")}</td>
          <td>${ee.quantity}</td>
          <td>${Ce((I==null?void 0:I.uom)||"-")}</td>
          <td>${Q(ee.rate)}</td>
          <td>${ee.gstRate.toFixed(2)}%</td>
          <td>${Q(ee.taxableValue)}</td>
          <td>${Q(ee.taxAmount)}</td>
          <td>${Q(ee.lineTotal)}</td>
        </tr>
      `}).join(""),x=L(s==null?void 0:s.taxable_value),T=L(s==null?void 0:s.tax_amount),B=L((s==null?void 0:s.total_amount)||N(s));return`
      <div class="po-print">
        <div class="po-print-header">
          <div>
            <h1>Purchase Order</h1>
            <div class="muted">PO #${(s==null?void 0:s.po_number)||"-"}</div>
          </div>
          <div class="meta">
            <div><strong>Status:</strong> ${String((s==null?void 0:s.status)||"-").toUpperCase()}</div>
            <div><strong>Date:</strong> ${mt((s==null?void 0:s.created_at)||(s==null?void 0:s.order_date))}</div>
            <div><strong>Expected:</strong> ${mt(s==null?void 0:s.expected_delivery)}</div>
            <div><strong>Bill No:</strong> ${(s==null?void 0:s.bill_number)||(s==null?void 0:s.invoice_number)||"-"}</div>
          </div>
        </div>

        <div class="po-print-party">
          <div>
            <h3>Supplier</h3>
            <div>${Ce(r.name)}</div>
            <div>${Ce(r.phone)}</div>
            <div>${Ce(r.address)}</div>
          </div>
          <div>
            <h3>Order Notes</h3>
            <div>${Ce((s==null?void 0:s.notes)||"-")}</div>
          </div>
        </div>

        <table class="po-print-table">
          <thead>
            <tr>
              <th>#</th>
              <th>Product</th>
              <th>Qty</th>
              <th>UOM</th>
              <th>Rate</th>
              <th>GST %</th>
              <th>Taxable</th>
              <th>Tax</th>
              <th>Total</th>
            </tr>
          </thead>
          <tbody>${o||'<tr><td colspan="9">No items</td></tr>'}</tbody>
        </table>

        <div class="po-print-summary">
          <div><span>Taxable Value</span><strong>${Q(x)}</strong></div>
          <div><span>GST</span><strong>${Q(T)}</strong></div>
          <div class="grand"><span>Grand Total</span><strong>${Q(B)}</strong></div>
        </div>
      </div>
    `},rt=s=>{if(!s)return;const a=Vs(s);Bt({title:`PO ${(s==null?void 0:s.po_number)||""}`,bodyHtml:a,cssText:`
        .po-print { max-width: 980px; margin: 0 auto; }
        .po-print-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 16px; }
        .po-print-header h1 { margin: 0 0 6px; font-size: 26px; }
        .muted { color: #555; font-size: 13px; }
        .meta { font-size: 13px; line-height: 1.6; text-align: right; }
        .po-print-party { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin: 16px 0; }
        .po-print-party h3 { margin: 0 0 8px; font-size: 13px; text-transform: uppercase; color: #444; }
        .po-print-table { width: 100%; border-collapse: collapse; font-size: 12px; }
        .po-print-table th, .po-print-table td { border: 1px solid #d1d5db; padding: 7px; text-align: left; }
        .po-print-table thead th { background: #f3f4f6; font-weight: 700; }
        .po-print-summary { margin-top: 14px; margin-left: auto; width: 320px; }
        .po-print-summary div { display: flex; justify-content: space-between; padding: 6px 0; border-bottom: 1px solid #e5e7eb; font-size: 13px; }
        .po-print-summary .grand { font-size: 15px; font-weight: 700; border-bottom: none; }
        @media print {
          body { margin: 0; padding: 10mm; }
          .po-print-table tr { page-break-inside: avoid; }
        }
      `,onError:r=>P(r)})},hs=s=>{if(s!=null&&s.distributor_name)return s.distributor_name;const a=s==null?void 0:s.distributor_id;if(!a)return"-";const r=V.find(o=>String(o.id)===String(a));return(r==null?void 0:r.name)||"-"},Y=s=>(s==null?void 0:s.bill_number)||(s==null?void 0:s.linked_bill_number)||(s==null?void 0:s.po_bill_number)||(s==null?void 0:s.invoice_number)||(s==null?void 0:s.po_invoice_number)||"-",it=()=>{ie({...c(),distributor_id:z.distributor_id||""}),ue(!0)},Hs=async s=>{s.preventDefault(),P("");const a=L(O.amount);if(!O.distributor_id){P("Please select a distributor for ledger entry");return}if(a<=0){P("Please enter a valid amount");return}try{await Ws.addTransaction(O.distributor_id,{type:O.type,transaction_type:O.type,amount:Number(a.toFixed(2)),payment_mode:O.payment_mode,reference:O.reference,description:O.description||`Manual ${O.type} entry`,transactionDate:O.transaction_date,mode:"manual",created_by:i==null?void 0:i.id}),ue(!1),ie(c()),os()}catch{const o={id:`local-${Date.now()}`,distributor_id:O.distributor_id,type:O.type,transaction_type:O.type,amount:Number(a.toFixed(2)),payment_mode:O.payment_mode,reference:O.reference,description:O.description||`Manual ${O.type} entry`,transaction_date:O.transaction_date,created_at:new Date().toISOString(),mode:"manual"};_(o),ue(!1),ie(c()),os()}},is=C(Se.items),As=J(Fe,z.distributor_id),Ye=n.useMemo(()=>bs(Se.distributor_id),[Se.distributor_id,se,y]),ps=n.useMemo(()=>bs(De.distributor_id),[De.distributor_id,se,y]);return te?e.jsx("div",{className:"purchase-management",children:e.jsx("div",{className:"loading",children:"Loading purchase data..."})}):e.jsxs("div",{className:"purchase-management",children:[p&&e.jsx("div",{className:"error-message",children:p}),e.jsxs("div",{className:"sub-nav",children:[e.jsxs("button",{className:E==="orders"?"active":"",onClick:()=>ae("orders"),children:[e.jsx(js,{size:18})," Purchase Orders"]}),e.jsxs("button",{className:E==="returns"?"active":"",onClick:()=>{ae("returns"),Ls()},children:[e.jsx(At,{size:18})," Purchase Returns"]})]}),E==="orders"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"filters-bar",children:[e.jsxs("div",{className:"filter-group",children:[e.jsx("label",{children:"Distributor:"}),e.jsxs("select",{name:"distributor_id",value:z.distributor_id,onChange:cs,children:[e.jsx("option",{value:"",children:"All Distributors"}),V.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]})]}),e.jsxs("div",{className:"filter-group",children:[e.jsx("label",{children:"Status:"}),e.jsxs("select",{name:"status",value:z.status,onChange:cs,children:[e.jsx("option",{value:"",children:"All Status"}),e.jsx("option",{value:"pending",children:"Pending"}),e.jsx("option",{value:"confirmed",children:"Confirmed"}),e.jsx("option",{value:"shipped",children:"Shipped"}),e.jsx("option",{value:"received",children:"Received"}),e.jsx("option",{value:"cancelled",children:"Cancelled"})]})]}),e.jsxs("div",{className:"filter-group",children:[e.jsx("label",{children:"From:"}),e.jsx("input",{type:"date",name:"start_date",value:z.start_date,onChange:cs})]}),e.jsxs("div",{className:"filter-group",children:[e.jsx("label",{children:"To:"}),e.jsx("input",{type:"date",name:"end_date",value:z.end_date,onChange:cs})]})]}),e.jsxs("div",{className:"actions-bar",children:[e.jsx("h2",{children:"Purchase Orders"}),e.jsxs("div",{className:"action-buttons",children:[e.jsxs("button",{className:"admin-btn secondary",onClick:it,children:[e.jsx(Pe,{size:18})," Payment / Credit Entry"]}),e.jsxs("button",{className:"admin-btn secondary",onClick:tt,children:[e.jsx(At,{size:18})," Return / Exchange"]}),e.jsxs("button",{className:"admin-btn secondary",onClick:()=>m(!0),children:[e.jsx(Pe,{size:18})," Quick Entry"]}),e.jsxs("button",{className:"admin-btn primary",onClick:pe,children:[e.jsx(Pe,{size:18})," New Order"]})]})]}),e.jsx("div",{className:"data-table",children:e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"PO Number"}),e.jsx("th",{children:"Distributor"}),e.jsx("th",{children:"Items"}),e.jsx("th",{children:"Total"}),e.jsx("th",{children:"Status"}),e.jsx("th",{children:"Expected"}),e.jsx("th",{children:"Actions"})]})}),e.jsx("tbody",{children:se.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:"7",className:"empty-state",children:"No purchase orders found"})}):se.map(s=>{var a;return e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("strong",{children:s.po_number})}),e.jsx("td",{children:s.distributor_name}),e.jsx("td",{children:((a=s.items)==null?void 0:a.length)||0}),e.jsx("td",{children:Q(N(s))}),e.jsx("td",{children:nt(s.status)}),e.jsx("td",{children:s.expected_delivery?new Date(s.expected_delivery).toLocaleDateString():"-"}),e.jsxs("td",{className:"actions-cell",children:[e.jsx("button",{className:"action-btn view",title:"View Details",onClick:()=>je(s.id),children:e.jsx(Qt,{size:16})}),s.status==="pending"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"action-btn edit",title:"Edit",onClick:()=>Ds(s.id),children:e.jsx(Rs,{size:16})}),e.jsx("button",{className:"action-btn",title:"Confirm",onClick:()=>st(s.id,"confirmed"),children:e.jsx(Ia,{size:16})})]}),s.status==="shipped"&&e.jsx("button",{className:"action-btn receive",title:"Receive",onClick:()=>zs(s),children:e.jsx(js,{size:16})}),s.status==="pending"&&e.jsx("button",{className:"action-btn delete",title:"Delete",onClick:()=>ms(s.id),children:e.jsx(ss,{size:16})})]})]},s.id)})})]})}),e.jsx("div",{className:"actions-bar ledger-header",children:e.jsx("h2",{children:"Distributor Credit / Payment Ledger"})}),e.jsxs("div",{className:"ledger-balance-summary",children:[e.jsx("span",{className:"ledger-balance-label",children:As.label}),e.jsx("strong",{className:`ledger-balance-value ${As.value>=0?"positive":"negative"}`,children:Q(As.value)})]}),e.jsx("div",{className:"data-table",children:e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Date"}),e.jsx("th",{children:"Distributor"}),e.jsx("th",{children:"Type"}),e.jsx("th",{children:"Amount"}),e.jsx("th",{children:"Balance"}),e.jsx("th",{children:"Mode"}),e.jsx("th",{children:"Reference"}),e.jsx("th",{children:"Bill No"}),e.jsx("th",{children:"Description"})]})}),e.jsx("tbody",{children:ts?e.jsx("tr",{children:e.jsx("td",{colSpan:"9",className:"empty-state",children:"Loading ledger records..."})}):Fe.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:"9",className:"empty-state",children:"No distributor payment/credit records found"})}):Fe.map((s,a)=>e.jsxs("tr",{children:[e.jsx("td",{children:new Date(s.created_at||s.transaction_date||Date.now()).toLocaleDateString()}),e.jsx("td",{children:hs(s)}),e.jsx("td",{children:Jt(s)}),e.jsx("td",{children:Q(L(s.amount))}),e.jsx("td",{children:Q(L(s.computed_balance??s.balance))}),e.jsx("td",{children:s.payment_mode||s.method||"-"}),e.jsx("td",{children:s.reference||s.po_number||"-"}),e.jsx("td",{children:Y(s)}),e.jsx("td",{children:s.description||"-"})]},s.id||a))})]})})]}),E==="returns"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"filters-bar",children:e.jsxs("div",{className:"filter-group",children:[e.jsx("label",{children:"Distributor:"}),e.jsxs("select",{name:"distributor_id",value:z.distributor_id,onChange:cs,children:[e.jsx("option",{value:"",children:"All Distributors"}),V.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]})]})}),e.jsx("div",{className:"data-table",children:e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Return Number"}),e.jsx("th",{children:"Distributor"}),e.jsx("th",{children:"Type"}),e.jsx("th",{children:"Items"}),e.jsx("th",{children:"Total"}),e.jsx("th",{children:"Reason"}),e.jsx("th",{children:"Date"})]})}),e.jsx("tbody",{children:A.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:"7",className:"empty-state",children:"No purchase returns found"})}):A.map(s=>{var a;return e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("strong",{children:s.return_number})}),e.jsx("td",{children:s.distributor_name}),e.jsx("td",{children:e.jsx("span",{className:`type-badge ${s.return_type}`,children:s.return_type==="exchange"?"Exchange":"Return"})}),e.jsx("td",{children:((a=s.items)==null?void 0:a.length)||0}),e.jsx("td",{children:Q(s.total)}),e.jsx("td",{children:s.reason||"-"}),e.jsx("td",{children:new Date(s.created_at).toLocaleDateString()})]},s.id)})})]})})]}),$&&e.jsx("div",{className:"modal-overlay",onClick:us,children:e.jsxs("div",{className:"modal-content large",onClick:s=>s.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h2",{children:"Quick Purchase Entry"}),e.jsx("button",{className:"close-btn",onClick:us,children:e.jsx(we,{size:24})})]}),e.jsxs("form",{onSubmit:ze,children:[e.jsxs("div",{className:"form-section",children:[e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Distributor *"}),e.jsx("input",{type:"text",list:"po-distributor-list-quick",value:De.distributor_name||"",onChange:s=>ce(s.target.value),placeholder:"Type distributor name",required:!0}),e.jsx("datalist",{id:"po-distributor-list-quick",children:V.filter(s=>s.status==="active").map(s=>e.jsx("option",{value:s.name},s.id))})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Date"}),e.jsx("input",{type:"date",value:De.order_date,onChange:s=>Oe(a=>({...a,order_date:s.target.value}))})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Notes"}),e.jsx("textarea",{value:De.notes,onChange:s=>Oe(a=>({...a,notes:s.target.value})),rows:"2",placeholder:"Optional short note"})]})]}),e.jsxs("div",{className:"form-section",children:[e.jsxs("div",{className:"section-header",children:[e.jsx("h3",{children:"Items (Product + Qty)"}),e.jsxs("button",{type:"button",className:"add-item-btn",onClick:Ge,children:[e.jsx(Pe,{size:16})," Add Row"]})]}),e.jsx("div",{className:"quick-entry-table",children:e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Product"}),e.jsx("th",{children:"Qty"}),e.jsx("th",{children:"UOM"}),e.jsx("th",{})]})}),e.jsx("tbody",{children:De.items.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:"4",className:"empty-state",children:"No rows added"})}):De.items.map((s,a)=>e.jsxs("tr",{children:[e.jsx("td",{children:e.jsxs("select",{value:s.product_id||"",onChange:r=>ds(a,"product_id",r.target.value),children:[e.jsx("option",{value:"",children:"Select product"}),ps.prioritized.length>0&&e.jsx("optgroup",{label:"Previously ordered from this distributor",children:ps.prioritized.map(r=>e.jsxs("option",{value:String(r.id),children:[r.name,r.sku?` (${r.sku})`:""]},`quick-priority-${r.id}`))}),e.jsx("optgroup",{label:"All products",children:ps.all.map(r=>e.jsxs("option",{value:String(r.id),children:[r.name,r.sku?` (${r.sku})`:""]},`quick-all-${r.id}`))})]})}),e.jsx("td",{children:e.jsx("input",{type:"number",min:"1",value:s.quantity,onChange:r=>ds(a,"quantity",L(r.target.value))})}),e.jsx("td",{children:e.jsx("input",{type:"text",value:s.uom||"pcs",readOnly:!0})}),e.jsx("td",{children:e.jsx("button",{type:"button",className:"remove-item-btn",onClick:()=>vs(a),children:e.jsx(we,{size:16})})})]},a))})]})})]}),e.jsxs("div",{className:"modal-actions",children:[e.jsx("button",{type:"button",className:"cancel-btn",onClick:us,children:"Cancel"}),e.jsx("button",{type:"submit",className:"submit-btn",children:"Save Quick Draft"})]})]})]})}),Ie&&e.jsx("div",{className:"modal-overlay",onClick:rs,children:e.jsxs("div",{className:"modal-content large",onClick:s=>s.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h2",{children:Re?"Edit Purchase Order":"Create Purchase Order"}),e.jsx("button",{className:"close-btn",onClick:rs,children:e.jsx(we,{size:24})})]}),e.jsxs("form",{onSubmit:Os,children:[e.jsxs("div",{className:"form-section",children:[e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Distributor *"}),e.jsx("input",{type:"text",list:"po-distributor-list",value:Se.distributor_name||"",onChange:s=>Cs(s.target.value),placeholder:"Type distributor name",required:!0}),e.jsx("datalist",{id:"po-distributor-list",children:V.filter(s=>s.status==="active").map(s=>e.jsx("option",{value:s.name},s.id))})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Expected Delivery"}),e.jsx("input",{type:"date",value:Se.expected_delivery,onChange:s=>ke(a=>({...a,expected_delivery:s.target.value}))})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Notes"}),e.jsx("textarea",{value:Se.notes,onChange:s=>ke(a=>({...a,notes:s.target.value})),rows:"2"})]})]}),e.jsxs("div",{className:"form-section",children:[e.jsxs("div",{className:"section-header",children:[e.jsx("h3",{children:"Order Items"}),e.jsxs("button",{type:"button",className:"add-item-btn",onClick:Ss,children:[e.jsx(Pe,{size:16})," Add Item"]})]}),e.jsx("small",{className:"field-help",children:"Product dropdown is grouped as previously ordered items for selected distributor, then all products."}),e.jsxs("div",{className:"items-list",children:[Se.items.map((s,a)=>{const r=M(s);return e.jsxs("div",{className:"item-row order-item-row",children:[e.jsxs("div",{className:"item-field product",children:[e.jsx("label",{children:"Product"}),e.jsxs("select",{value:s.product_id||"",onChange:o=>Je(a,"product_id",o.target.value),children:[e.jsx("option",{value:"",children:"Select product"}),Ye.prioritized.length>0&&e.jsx("optgroup",{label:"Previously ordered from this distributor",children:Ye.prioritized.map(o=>e.jsxs("option",{value:String(o.id),children:[o.name,o.sku?` (${o.sku})`:""]},`order-priority-${o.id}`))}),e.jsx("optgroup",{label:"All products",children:Ye.all.map(o=>e.jsxs("option",{value:String(o.id),children:[o.name,o.sku?` (${o.sku})`:""]},`order-all-${o.id}`))})]}),s.last_purchase_hint&&e.jsx("small",{style:{display:"block",marginTop:4,color:"#666"},children:s.last_purchase_hint})]}),e.jsxs("div",{className:"item-field qty",children:[e.jsx("label",{children:"Qty"}),e.jsx("input",{type:"number",min:"1",value:s.quantity,onChange:o=>Je(a,"quantity",L(o.target.value))})]}),e.jsxs("div",{className:"item-field uom",children:[e.jsx("label",{children:"UOM"}),e.jsx("input",{type:"text",value:s.uom,readOnly:!0})]}),e.jsxs("div",{className:"item-field price",children:[e.jsx("label",{children:"Rate"}),e.jsx("input",{type:"number",step:"0.01",min:"0",value:s.rate??s.unit_price,onChange:o=>Je(a,"rate",L(o.target.value))})]}),e.jsxs("div",{className:"item-field gst",children:[e.jsx("label",{children:"GST %"}),e.jsx("input",{type:"number",step:"0.01",min:"0",value:s.gst_rate??0,onChange:o=>Je(a,"gst_rate",L(o.target.value))})]}),e.jsxs("div",{className:"item-field discount-type",children:[e.jsx("label",{children:"Discount Type"}),e.jsxs("select",{value:s.discount_type||"percent",onChange:o=>Je(a,"discount_type",o.target.value),children:[e.jsx("option",{value:"percent",children:"%"}),e.jsx("option",{value:"fixed",children:"Fixed"})]})]}),e.jsxs("div",{className:"item-field discount-value",children:[e.jsx("label",{children:"Discount"}),e.jsx("input",{type:"number",step:"0.01",min:"0",value:s.discount_value??0,onChange:o=>Je(a,"discount_value",L(o.target.value))})]}),e.jsxs("div",{className:"item-field taxable",children:[e.jsx("label",{children:"Taxable Value"}),e.jsx("span",{children:Q(r.taxableValue)})]}),e.jsxs("div",{className:"item-field tax",children:[e.jsx("label",{children:"Tax"}),e.jsx("span",{children:Q(r.taxAmount)})]}),e.jsxs("div",{className:"item-field total",children:[e.jsx("label",{children:"Total Amount"}),e.jsx("span",{children:Q(r.totalAmount)})]}),e.jsx("button",{type:"button",className:"remove-item-btn",onClick:()=>ws(a),children:e.jsx(we,{size:16})})]},a)}),Se.items.length===0&&e.jsx("p",{className:"no-items",children:'No items added. Click "Add Item" to add products.'})]}),Se.items.length>0&&e.jsxs("div",{className:"order-summary",children:[e.jsxs("div",{className:"summary-row",children:[e.jsx("span",{children:"Gross Amount"}),e.jsx("strong",{children:Q(is.grossAmount)})]}),e.jsxs("div",{className:"summary-row",children:[e.jsx("span",{children:"Discount"}),e.jsx("strong",{children:Q(is.discountAmount)})]}),e.jsxs("div",{className:"summary-row",children:[e.jsx("span",{children:"Taxable Value"}),e.jsx("strong",{children:Q(is.taxableValue)})]}),e.jsxs("div",{className:"summary-row",children:[e.jsx("span",{children:"Tax"}),e.jsx("strong",{children:Q(is.taxAmount)})]}),e.jsxs("div",{className:"summary-row grand-total",children:[e.jsx("span",{children:"Total Amount"}),e.jsx("strong",{children:Q(is.totalAmount)})]})]})]}),e.jsxs("div",{className:"modal-actions",children:[e.jsx("button",{type:"button",className:"cancel-btn",onClick:rs,children:"Cancel"}),e.jsx("button",{type:"submit",className:"submit-btn",children:Re?"Update Order":"Create Order"})]})]})]})}),S&&H&&(j?e.jsx(Nt,{open:!0,onClose:()=>F(!1),title:`Receive Inventory - ${H.po_number}`,className:"purchase-receive-sheet",actions:e.jsxs(e.Fragment,{children:[e.jsx("button",{type:"button",className:"cancel-btn",onClick:()=>F(!1),children:"Cancel"}),e.jsx("button",{type:"submit",form:"receive-inventory-form",className:"submit-btn",children:"Confirm Receipt"})]}),children:e.jsxs("form",{id:"receive-inventory-form",onSubmit:Us,className:"mobile-receive-form",children:[e.jsx("div",{className:"form-section",children:e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Invoice Number"}),e.jsx("input",{type:"text",value:Qe.invoice_number,onChange:s=>Ke(a=>({...a,invoice_number:s.target.value})),placeholder:"Enter invoice number"})]})}),e.jsxs("div",{className:"form-section",children:[e.jsx("h3",{children:"Received Items"}),e.jsx("div",{className:"mobile-receive-list",children:Qe.items.map((s,a)=>e.jsxs("div",{className:"mobile-receive-item",children:[e.jsxs("div",{className:"mobile-receive-row",children:[e.jsx("strong",{children:s.product_name}),e.jsxs("span",{children:["Ordered: ",s.ordered_quantity]})]}),e.jsxs("div",{className:"mobile-receive-stepper",children:[e.jsx("button",{type:"button",className:"mobile-stepper-btn",onClick:()=>qs(a,-1),"aria-label":"Decrease received quantity",children:"-"}),e.jsx("input",{type:"number",min:"0",max:s.ordered_quantity,value:s.received_quantity,onChange:r=>Xe(a,"received_quantity",Math.max(0,Math.min(L(s.ordered_quantity),L(r.target.value))))}),e.jsx("button",{type:"button",className:"mobile-stepper-btn",onClick:()=>qs(a,1),"aria-label":"Increase received quantity",children:"+"})]}),e.jsxs("div",{className:"mobile-receive-row",children:[e.jsx("label",{children:"Unit Cost"}),e.jsx("input",{type:"number",step:"0.01",value:s.unit_price,onChange:r=>Xe(a,"unit_price",L(r.target.value))})]}),e.jsxs("div",{className:"mobile-receive-row value",children:[e.jsx("span",{children:"Value"}),e.jsx("strong",{children:Q(L(s.received_quantity)*L(s.unit_price))})]})]},a))})]})]})}):e.jsx("div",{className:"modal-overlay",onClick:()=>F(!1),children:e.jsxs("div",{className:"modal-content large",onClick:s=>s.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsxs("h2",{children:["Receive Inventory - ",H.po_number]}),e.jsx("button",{className:"close-btn",onClick:()=>F(!1),children:e.jsx(we,{size:24})})]}),e.jsxs("form",{id:"receive-inventory-form",onSubmit:Us,children:[e.jsx("div",{className:"form-section",children:e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Invoice Number"}),e.jsx("input",{type:"text",value:Qe.invoice_number,onChange:s=>Ke(a=>({...a,invoice_number:s.target.value})),placeholder:"Enter invoice number"})]})}),e.jsxs("div",{className:"form-section",children:[e.jsx("h3",{children:"Received Items"}),e.jsx("div",{className:"items-list",children:Qe.items.map((s,a)=>e.jsxs("div",{className:"item-row",children:[e.jsxs("div",{className:"item-field product",children:[e.jsx("label",{children:"Product"}),e.jsx("span",{children:s.product_name})]}),e.jsxs("div",{className:"item-field qty",children:[e.jsx("label",{children:"Ordered"}),e.jsx("span",{children:s.ordered_quantity})]}),e.jsxs("div",{className:"item-field qty",children:[e.jsx("label",{children:"Received"}),e.jsx("input",{type:"number",min:"0",max:s.ordered_quantity,value:s.received_quantity,onChange:r=>Xe(a,"received_quantity",L(r.target.value))})]}),e.jsxs("div",{className:"item-field price",children:[e.jsx("label",{children:"Unit Cost"}),e.jsx("input",{type:"number",step:"0.01",value:s.unit_price,onChange:r=>Xe(a,"unit_price",L(r.target.value))})]}),e.jsxs("div",{className:"item-field total",children:[e.jsx("label",{children:"Value"}),e.jsx("span",{children:Q(L(s.received_quantity)*L(s.unit_price))})]})]},a))})]}),e.jsxs("div",{className:"modal-actions",children:[e.jsx("button",{type:"button",className:"cancel-btn",onClick:()=>F(!1),children:"Cancel"}),e.jsx("button",{type:"submit",className:"submit-btn",children:"Confirm Receipt"})]})]})]})})),me&&e.jsx("div",{className:"modal-overlay",onClick:()=>le(!1),children:e.jsxs("div",{className:"modal-content large po-detail-modal",onClick:s=>s.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsxs("h2",{children:["Purchase Order: ",(oe==null?void 0:oe.po_number)||"-"]}),e.jsx("button",{className:"close-btn",onClick:()=>le(!1),children:e.jsx(we,{size:24})})]}),Be||!oe?e.jsx("div",{className:"order-detail-body",children:e.jsx("div",{className:"loading",children:"Loading purchase order details..."})}):e.jsx("div",{className:"order-detail-body",children:e.jsx("div",{className:"po-invoice-preview",children:(()=>{const s=Qs(oe);return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"po-invoice-header",children:[e.jsxs("div",{children:[e.jsx("h3",{children:"Purchase Order"}),e.jsxs("p",{children:["PO #",oe.po_number]})]}),e.jsxs("div",{className:"po-invoice-meta",children:[e.jsxs("div",{children:[e.jsx("span",{children:"Status"}),e.jsx("strong",{children:String(oe.status||"-").toUpperCase()})]}),e.jsxs("div",{children:[e.jsx("span",{children:"Created"}),e.jsx("strong",{children:_a(oe.created_at||oe.order_date)})]}),e.jsxs("div",{children:[e.jsx("span",{children:"Expected"}),e.jsx("strong",{children:mt(oe.expected_delivery)})]}),e.jsxs("div",{children:[e.jsx("span",{children:"Bill No"}),e.jsx("strong",{children:oe.bill_number||oe.invoice_number||"-"})]})]})]}),e.jsxs("div",{className:"po-party-grid",children:[e.jsxs("div",{className:"po-party-card",children:[e.jsx("h4",{children:"Supplier"}),e.jsx("p",{children:s.name}),e.jsx("p",{children:s.phone}),e.jsx("p",{children:s.address})]}),e.jsxs("div",{className:"po-party-card",children:[e.jsx("h4",{children:"Notes"}),e.jsx("p",{children:oe.notes||"-"})]})]}),e.jsxs("table",{className:"po-invoice-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"#"}),e.jsx("th",{children:"Product"}),e.jsx("th",{children:"Qty"}),e.jsx("th",{children:"UOM"}),e.jsx("th",{children:"Rate"}),e.jsx("th",{children:"GST %"}),e.jsx("th",{children:"Taxable"}),e.jsx("th",{children:"Tax"}),e.jsx("th",{children:"Total"})]})}),e.jsx("tbody",{children:(oe.items||[]).map((a,r)=>{const o=Gs(a);return e.jsxs("tr",{children:[e.jsx("td",{children:r+1}),e.jsx("td",{children:a.product_name}),e.jsx("td",{children:o.quantity}),e.jsx("td",{children:a.uom||"-"}),e.jsx("td",{children:Q(o.rate)}),e.jsxs("td",{children:[o.gstRate.toFixed(2),"%"]}),e.jsx("td",{children:Q(o.taxableValue)}),e.jsx("td",{children:Q(o.taxAmount)}),e.jsx("td",{children:Q(o.lineTotal)})]},r)})})]}),e.jsxs("div",{className:"po-invoice-summary",children:[e.jsxs("div",{className:"po-summary-row",children:[e.jsx("span",{children:"Taxable Value"}),e.jsx("strong",{children:Q(oe.taxable_value||0)})]}),e.jsxs("div",{className:"po-summary-row",children:[e.jsx("span",{children:"GST"}),e.jsx("strong",{children:Q(oe.tax_amount||0)})]}),e.jsxs("div",{className:"po-summary-row grand",children:[e.jsx("span",{children:"Grand Total"}),e.jsx("strong",{children:Q(oe.total_amount||N(oe))})]})]})]})})()})}),e.jsxs("div",{className:"modal-actions",children:[e.jsxs("button",{type:"button",className:"submit-btn print-po-btn",onClick:()=>rt(oe),disabled:!oe,children:[e.jsx(Na,{size:16})," Print"]}),e.jsx("button",{type:"button",className:"cancel-btn",onClick:()=>le(!1),children:"Close"})]})]})}),X&&e.jsx("div",{className:"modal-overlay",onClick:()=>ue(!1),children:e.jsxs("div",{className:"modal-content",onClick:s=>s.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h2",{children:"Add Distributor Payment / Credit"}),e.jsx("button",{className:"close-btn",onClick:()=>ue(!1),children:e.jsx(we,{size:24})})]}),e.jsxs("form",{onSubmit:Hs,children:[e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Distributor *"}),e.jsxs("select",{value:O.distributor_id,onChange:s=>ie(a=>({...a,distributor_id:s.target.value})),required:!0,children:[e.jsx("option",{value:"",children:"Select distributor"}),V.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Type *"}),e.jsxs("select",{value:O.type,onChange:s=>ie(a=>({...a,type:s.target.value})),children:[e.jsx("option",{value:"payment",children:"Payment (Reduce due)"}),e.jsx("option",{value:"credit",children:"Credit (Increase due)"})]})]})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Amount *"}),e.jsx("input",{type:"number",step:"0.01",min:"0.01",value:O.amount,onChange:s=>ie(a=>({...a,amount:s.target.value})),placeholder:"Enter amount",required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Payment Mode"}),e.jsxs("select",{value:O.payment_mode,onChange:s=>ie(a=>({...a,payment_mode:s.target.value})),children:[e.jsx("option",{value:"cash",children:"Cash"}),e.jsx("option",{value:"bank",children:"Bank Transfer"}),e.jsx("option",{value:"upi",children:"UPI"}),e.jsx("option",{value:"cheque",children:"Cheque"}),e.jsx("option",{value:"credit",children:"Credit"})]})]})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Transaction Date"}),e.jsx("input",{type:"date",value:O.transaction_date,onChange:s=>ie(a=>({...a,transaction_date:s.target.value}))})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Reference"}),e.jsx("input",{type:"text",value:O.reference,onChange:s=>ie(a=>({...a,reference:s.target.value})),placeholder:"Invoice / PO / Bank ref"})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Description"}),e.jsx("textarea",{rows:"2",value:O.description,onChange:s=>ie(a=>({...a,description:s.target.value})),placeholder:"Optional notes"})]}),e.jsxs("div",{className:"modal-actions",children:[e.jsx("button",{type:"button",className:"cancel-btn",onClick:()=>ue(!1),children:"Cancel"}),e.jsx("button",{type:"submit",className:"submit-btn",children:"Save Entry"})]})]})]})}),re&&e.jsx("div",{className:"modal-overlay",onClick:()=>g(!1),children:e.jsxs("div",{className:"modal-content large",onClick:s=>s.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h2",{children:"Create Purchase Return / Exchange"}),e.jsx("button",{className:"close-btn",onClick:()=>g(!1),children:e.jsx(we,{size:24})})]}),e.jsxs("form",{onSubmit:at,children:[e.jsxs("div",{className:"form-section",children:[e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Distributor *"}),e.jsxs("select",{value:Le.distributor_id,onChange:s=>Ee(a=>({...a,distributor_id:s.target.value})),required:!0,children:[e.jsx("option",{value:"",children:"Select distributor"}),V.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Reference PO"}),e.jsx("input",{type:"text",value:Le.reference_po,onChange:s=>Ee(a=>({...a,reference_po:s.target.value})),placeholder:"Original PO number"})]})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Return Type"}),e.jsxs("select",{value:Le.return_type,onChange:s=>Ee(a=>({...a,return_type:s.target.value})),children:[e.jsx("option",{value:"return",children:"Return"}),e.jsx("option",{value:"exchange",children:"Exchange"})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Reason"}),e.jsx("input",{type:"text",value:Le.reason,onChange:s=>Ee(a=>({...a,reason:s.target.value})),placeholder:"Reason for return/exchange"})]})]})]}),e.jsxs("div",{className:"form-section",children:[e.jsxs("div",{className:"section-header",children:[e.jsx("h3",{children:"Return Items"}),e.jsxs("button",{type:"button",className:"add-item-btn",onClick:Ms,children:[e.jsx(Pe,{size:16})," Add Item"]})]}),e.jsx("div",{className:"items-list",children:Le.items.map((s,a)=>e.jsxs("div",{className:"item-row",children:[e.jsxs("div",{className:"item-field product",children:[e.jsx("label",{children:"Product"}),e.jsxs("select",{value:s.product_id,onChange:r=>fs(a,"product_id",r.target.value),children:[e.jsx("option",{value:"",children:"Select product"}),y.map(r=>e.jsxs("option",{value:r.id,children:[r.name," (",r.sku,")"]},r.id))]})]}),e.jsxs("div",{className:"item-field qty",children:[e.jsx("label",{children:"Qty"}),e.jsx("input",{type:"number",min:"1",value:s.quantity,onChange:r=>fs(a,"quantity",parseFloat(r.target.value))})]}),e.jsxs("div",{className:"item-field uom",children:[e.jsx("label",{children:"UOM"}),e.jsx("input",{type:"text",value:s.uom,readOnly:!0})]}),e.jsxs("div",{className:"item-field price",children:[e.jsx("label",{children:"Unit Price"}),e.jsx("input",{type:"number",step:"0.01",value:s.unit_price,onChange:r=>fs(a,"unit_price",parseFloat(r.target.value))})]}),e.jsxs("div",{className:"item-field total",children:[e.jsx("label",{children:"Total"}),e.jsx("span",{children:Q(s.quantity*s.unit_price)})]}),e.jsx("button",{type:"button",className:"remove-item-btn",onClick:()=>ys(a),children:e.jsx(we,{size:16})})]},a))})]}),e.jsxs("div",{className:"modal-actions",children:[e.jsx("button",{type:"button",className:"cancel-btn",onClick:()=>g(!1),children:"Cancel"}),e.jsx("button",{type:"submit",className:"submit-btn",children:"Create Return"})]})]})]})})]})}function Ya({user:i}){const[j,k]=n.useState([]),[w,c]=n.useState([]),[U,u]=n.useState(!0),[R,N]=n.useState({product_id:"",transaction_type:"",start_date:"",end_date:""});n.useEffect(()=>{G()},[]),n.useEffect(()=>{Z()},[R]);const G=async()=>{try{const C=await be.getAll();c(C||[])}catch(C){console.error("Error fetching products:",C)}},Z=async()=>{try{u(!0);const C=await ma.getAll(R);k(C||[])}catch(C){console.error("Error fetching stock ledger:",C)}finally{u(!1)}},_=C=>{const{name:E,value:ae}=C.target;N(se=>({...se,[E]:ae}))},D=()=>{N({product_id:"",transaction_type:"",start_date:"",end_date:""})},v=C=>{switch(C){case"PURCHASE":return e.jsx(Et,{size:16,className:"icon purchase"});case"SALE":return e.jsx(ht,{size:16,className:"icon sale"});case"RETURN":return e.jsx(vt,{size:16,className:"icon return"});case"PURCHASE_RETURN":return e.jsx(ht,{size:16,className:"icon purchase-return"});case"ADJUSTMENT":return e.jsx(Pt,{size:16,className:"icon adjustment"});case"EXCHANGE_IN":return e.jsx(Et,{size:16,className:"icon exchange-in"});case"EXCHANGE_OUT":return e.jsx(ht,{size:16,className:"icon exchange-out"});default:return e.jsx(Pt,{size:16,className:"icon default"})}},J=C=>{const ae={PURCHASE:{label:"Purchase",class:"purchase"},SALE:{label:"Sale",class:"sale"},RETURN:{label:"Return",class:"return"},PURCHASE_RETURN:{label:"Purchase Return",class:"purchase-return"},ADJUSTMENT:{label:"Adjustment",class:"adjustment"},EXCHANGE_IN:{label:"Exchange In",class:"exchange-in"},EXCHANGE_OUT:{label:"Exchange Out",class:"exchange-out"}}[C]||{label:C,class:""};return e.jsx("span",{className:`type-badge ${ae.class}`,children:ae.label})},M=[{value:"",label:"All Types"},{value:"PURCHASE",label:"Purchase"},{value:"SALE",label:"Sale"},{value:"RETURN",label:"Return"},{value:"PURCHASE_RETURN",label:"Purchase Return"},{value:"ADJUSTMENT",label:"Adjustment"},{value:"EXCHANGE_IN",label:"Exchange In"},{value:"EXCHANGE_OUT",label:"Exchange Out"}];return e.jsxs("div",{className:"stock-ledger-history",children:[e.jsxs("div",{className:"page-header",children:[e.jsx("h1",{children:"Stock Ledger History"}),e.jsxs("button",{className:"admin-btn",onClick:Z,children:[e.jsx(vt,{size:18})," Refresh"]})]}),e.jsx("div",{className:"filters-section",children:e.jsxs("div",{className:"filters-row",children:[e.jsxs("div",{className:"filter-group",children:[e.jsx("label",{children:"Product:"}),e.jsxs("select",{name:"product_id",value:R.product_id,onChange:_,children:[e.jsx("option",{value:"",children:"All Products"}),w.map(C=>e.jsxs("option",{value:C.id,children:[C.name," (",C.sku,")"]},C.id))]})]}),e.jsxs("div",{className:"filter-group",children:[e.jsx("label",{children:"Transaction Type:"}),e.jsx("select",{name:"transaction_type",value:R.transaction_type,onChange:_,children:M.map(C=>e.jsx("option",{value:C.value,children:C.label},C.value))})]}),e.jsxs("div",{className:"filter-group",children:[e.jsx("label",{children:"From:"}),e.jsx("input",{type:"date",name:"start_date",value:R.start_date,onChange:_})]}),e.jsxs("div",{className:"filter-group",children:[e.jsx("label",{children:"To:"}),e.jsx("input",{type:"date",name:"end_date",value:R.end_date,onChange:_})]}),e.jsx("button",{className:"reset-btn",onClick:D,children:"Reset Filters"})]})}),e.jsxs("div",{className:"summary-stats",children:[e.jsxs("div",{className:"stat-card",children:[e.jsx("span",{className:"stat-value",children:j.length}),e.jsx("span",{className:"stat-label",children:"Total Transactions"})]}),e.jsxs("div",{className:"stat-card purchase",children:[e.jsx("span",{className:"stat-value",children:j.filter(C=>C.transaction_type==="PURCHASE").length}),e.jsx("span",{className:"stat-label",children:"Purchases"})]}),e.jsxs("div",{className:"stat-card sale",children:[e.jsx("span",{className:"stat-value",children:j.filter(C=>C.transaction_type==="SALE").length}),e.jsx("span",{className:"stat-label",children:"Sales"})]}),e.jsxs("div",{className:"stat-card return",children:[e.jsx("span",{className:"stat-value",children:j.filter(C=>C.transaction_type==="RETURN").length}),e.jsx("span",{className:"stat-label",children:"Returns"})]})]}),e.jsx("div",{className:"ledger-table-container",children:U?e.jsx("div",{className:"loading",children:"Loading stock ledger..."}):j.length===0?e.jsxs("div",{className:"empty-state",children:[e.jsx("p",{children:"No stock transactions found."}),e.jsx("p",{children:"Transactions will appear here when inventory changes occur."})]}):e.jsxs("table",{className:"ledger-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Date & Time"}),e.jsx("th",{children:"Product"}),e.jsx("th",{children:"Type"}),e.jsx("th",{children:"Quantity"}),e.jsx("th",{children:"Previous"}),e.jsx("th",{children:"New Balance"}),e.jsx("th",{children:"Reference"}),e.jsx("th",{children:"By"}),e.jsx("th",{children:"Notes"})]})}),e.jsx("tbody",{children:j.map(C=>e.jsxs("tr",{children:[e.jsxs("td",{className:"date-cell",children:[new Date(C.created_at).toLocaleDateString(),e.jsx("span",{className:"time",children:new Date(C.created_at).toLocaleTimeString()})]}),e.jsxs("td",{className:"product-cell",children:[e.jsx("span",{className:"product-name",children:C.product_name}),e.jsx("span",{className:"product-sku",children:C.sku})]}),e.jsxs("td",{children:[v(C.transaction_type),J(C.transaction_type)]}),e.jsx("td",{className:"qty-cell",children:e.jsxs("span",{className:C.quantity_change>=0?"positive":"negative",children:[C.quantity_change>=0?"+":"",C.quantity_change]})}),e.jsx("td",{children:C.previous_balance}),e.jsx("td",{children:e.jsx("strong",{children:C.new_balance})}),e.jsx("td",{className:"ref-cell",children:C.reference_id&&e.jsxs("span",{className:"reference",children:[C.reference_type,": ",C.reference_id]})}),e.jsx("td",{children:C.user_name||"-"}),e.jsx("td",{className:"notes-cell",children:C.notes||"-"})]},C.id))})]})})]})}function Za({user:i}){const[j,k]=n.useState([]),[w,c]=n.useState({}),[U,u]=n.useState(!0),[R,N]=n.useState("");n.useEffect(()=>{G()},[]);const G=async()=>{try{u(!0);const _=await xs.getAgingReport();k(_.report||[]),c(_.summary||{})}catch{N("Failed to load credit aging report")}finally{u(!1)}},Z=_=>{const D=_.credit_limit||0,v=_.current_balance||0,J=D>0?v/D*100:0;return v>D?{status:"over_limit",label:"Over Limit",icon:$a,class:"over-limit"}:J>=80?{status:"high",label:"High Risk",icon:Sa,class:"high-risk"}:J>=50?{status:"medium",label:"Medium",icon:Vt,class:"medium"}:{status:"low",label:"Good",icon:wa,class:"good"}};return U?e.jsx("div",{className:"credit-aging-report",children:e.jsx("div",{className:"loading",children:"Loading credit aging report..."})}):e.jsxs("div",{className:"credit-aging-report",children:[e.jsxs("div",{className:"page-header",children:[e.jsx("h1",{children:"Credit Aging Report"}),e.jsxs("button",{className:"refresh-btn",onClick:G,children:[e.jsx(vt,{size:18})," Refresh"]})]}),R&&e.jsx("div",{className:"error-message",children:R}),e.jsxs("div",{className:"summary-cards",children:[e.jsxs("div",{className:"summary-card total",children:[e.jsx("span",{className:"card-value",children:Q(w.total_outstanding||0)}),e.jsx("span",{className:"card-label",children:"Total Outstanding"})]}),e.jsxs("div",{className:"summary-card overdue",children:[e.jsx("span",{className:"card-value",children:w.customers_overdue||0}),e.jsx("span",{className:"card-label",children:"Customers Overdue"})]}),e.jsxs("div",{className:"summary-card aging-0-30",children:[e.jsx("span",{className:"card-value",children:Q(w.aging_0_30||0)}),e.jsx("span",{className:"card-label",children:"0-30 Days"})]}),e.jsxs("div",{className:"summary-card aging-31-60",children:[e.jsx("span",{className:"card-value",children:Q(w.aging_31_60||0)}),e.jsx("span",{className:"card-label",children:"31-60 Days"})]}),e.jsxs("div",{className:"summary-card aging-61-90",children:[e.jsx("span",{className:"card-value",children:Q(w.aging_61_90||0)}),e.jsx("span",{className:"card-label",children:"61-90 Days"})]}),e.jsxs("div",{className:"summary-card aging-over-90",children:[e.jsx("span",{className:"card-value",children:Q(w.aging_over_90||0)}),e.jsx("span",{className:"card-label",children:"Over 90 Days"})]})]}),e.jsxs("div",{className:"aging-chart",children:[e.jsx("h3",{children:"Outstanding by Aging Period"}),e.jsxs("div",{className:"chart-bars",children:[e.jsxs("div",{className:"chart-bar",style:{width:"40%"},children:[e.jsx("div",{className:"bar-fill days-0-30",style:{width:"100%"}}),e.jsx("span",{className:"bar-label",children:"0-30 Days"}),e.jsx("span",{className:"bar-value",children:Q(w.aging_0_30||0)})]}),e.jsxs("div",{className:"chart-bar",style:{width:"30%"},children:[e.jsx("div",{className:"bar-fill days-31-60",style:{width:"100%"}}),e.jsx("span",{className:"bar-label",children:"31-60 Days"}),e.jsx("span",{className:"bar-value",children:Q(w.aging_31_60||0)})]}),e.jsxs("div",{className:"chart-bar",style:{width:"20%"},children:[e.jsx("div",{className:"bar-fill days-61-90",style:{width:"100%"}}),e.jsx("span",{className:"bar-label",children:"61-90 Days"}),e.jsx("span",{className:"bar-value",children:Q(w.aging_61_90||0)})]}),e.jsxs("div",{className:"chart-bar",style:{width:"10%"},children:[e.jsx("div",{className:"bar-fill days-over-90",style:{width:"100%"}}),e.jsx("span",{className:"bar-label",children:"90+ Days"}),e.jsx("span",{className:"bar-value",children:Q(w.aging_over_90||0)})]})]})]}),e.jsxs("div",{className:"report-table-container",children:[e.jsx("h3",{children:"Customer Credit Details"}),j.length===0?e.jsx("div",{className:"empty-state",children:e.jsx("p",{children:"No customers with outstanding credit balance."})}):e.jsxs("table",{className:"report-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Customer"}),e.jsx("th",{children:"Contact"}),e.jsx("th",{children:"Credit Limit"}),e.jsx("th",{children:"Current Balance"}),e.jsx("th",{children:"Utilization"}),e.jsx("th",{children:"0-30 Days"}),e.jsx("th",{children:"31-60 Days"}),e.jsx("th",{children:"61-90 Days"}),e.jsx("th",{children:"90+ Days"}),e.jsx("th",{children:"Status"})]})}),e.jsx("tbody",{children:j.map(_=>{const D=Z(_),v=_.credit_limit||0,J=_.current_balance||0,M=v>0?Math.min(J/v*100,100):0;return e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("span",{className:"customer-name",children:_.customer_name})}),e.jsx("td",{children:e.jsxs("div",{className:"contact-info",children:[e.jsx("span",{children:_.phone||"-"}),e.jsx("span",{className:"email",children:_.email||"-"})]})}),e.jsx("td",{children:Q(v)}),e.jsx("td",{className:"balance",children:e.jsx("strong",{children:Q(J)})}),e.jsx("td",{children:e.jsxs("div",{className:"utilization-bar",children:[e.jsx("div",{className:`bar ${D.status}`,style:{width:`${M}%`}}),e.jsxs("span",{children:[M.toFixed(1),"%"]})]})}),e.jsx("td",{className:"aging-amount",children:Q(_.days_0_30)}),e.jsx("td",{className:`aging-amount ${_.days_31_60>0?"overdue":""}`,children:Q(_.days_31_60)}),e.jsx("td",{className:`aging-amount ${_.days_61_90>0?"overdue":""}`,children:Q(_.days_61_90)}),e.jsx("td",{className:`aging-amount ${_.days_over_90>0?"critical":""}`,children:Q(_.days_over_90)}),e.jsx("td",{children:e.jsxs("span",{className:`status-badge ${D.class}`,children:[e.jsx(D.icon,{size:14}),D.label]})})]},_.customer_id)})})]})]})]})}function qt({user:i,onClose:j,onSave:k,isCreate:w=!1}){const[c,U]=n.useState({name:"",email:"",phone:"",address:"",role:"customer"}),[u,R]=n.useState(!1),[N,G]=n.useState(""),[Z,_]=n.useState(""),[D,v]=n.useState({}),J=yt();n.useEffect(()=>{i&&!w&&U({name:i.name||"",email:i.email||"",phone:i.phone||"",address:i.address||"",role:i.role||"customer"})},[i,w]);const M=()=>{const se={};if(c.name.trim()?c.name.length<2&&(se.name="Name must be at least 2 characters"):se.name="Name is required",c.phone){const d=c.phone.replace(/\D/g,"");(d.length<10||d.length>11)&&(se.phone="Phone must be 10-11 digits")}return v(se),Object.keys(se).length===0},C=se=>{const{name:d,value:A}=se.target;U(W=>({...W,[d]:A})),D[d]&&v(W=>({...W,[d]:""}))},E=async se=>{if(se.preventDefault(),!!M()){R(!0),G("");try{w?(await He.create({...c,password:"123",role:"customer"}),_("Customer created successfully")):(await He.update(i.id,c),_("User updated successfully")),setTimeout(()=>{k(),j()},1e3)}catch(d){G(d.message||`Failed to ${w?"create":"update"} user`)}finally{R(!1)}}},ae=e.jsxs(e.Fragment,{children:[N&&e.jsx("div",{className:"error-message",children:N}),Z&&e.jsx("div",{className:"success-message",children:Z}),e.jsxs("form",{onSubmit:E,className:"user-edit-form",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"name",children:"Name"}),e.jsx("input",{type:"text",id:"name",name:"name",value:c.name,onChange:C,placeholder:"Enter customer name",autoComplete:"name",className:D.name?"error":"",disabled:!w&&(i==null?void 0:i.role)==="admin"}),D.name&&e.jsx("span",{className:"field-error",children:D.name})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"email",children:"Email"}),e.jsx("input",{type:"email",id:"email",name:"email",value:c.email,onChange:C,placeholder:"Enter email (optional)",autoComplete:"email",disabled:!w&&(i==null?void 0:i.role)==="admin"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"phone",children:"Phone"}),e.jsx("input",{type:"tel",id:"phone",name:"phone",value:c.phone,onChange:C,placeholder:"Enter phone number (e.g., 123-456-7890)",autoComplete:"tel",className:D.phone?"error":"",disabled:!w&&(i==null?void 0:i.role)==="admin"}),D.phone&&e.jsx("span",{className:"field-error",children:D.phone})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"address",children:"Address"}),e.jsx("input",{type:"text",id:"address",name:"address",value:c.address,onChange:C,placeholder:"Enter address",autoComplete:"street-address",disabled:!w&&(i==null?void 0:i.role)==="admin"})]}),!w&&e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"role",children:"Role"}),e.jsxs("select",{id:"role",name:"role",value:c.role,onChange:C,disabled:(i==null?void 0:i.role)==="admin",children:[e.jsx("option",{value:"customer",children:"Customer"}),e.jsx("option",{value:"admin",children:"Admin"})]}),(i==null?void 0:i.role)==="admin"&&e.jsx("span",{className:"info-text",children:"Admin users cannot be modified"})]}),e.jsxs("div",{className:"form-actions",children:[e.jsx("button",{type:"button",className:"cancel-btn",onClick:j,disabled:u,children:"Cancel"}),e.jsx("button",{type:"submit",className:"submit-btn",disabled:u||!w&&(i==null?void 0:i.role)==="admin",children:u?"Saving...":w?"Add Customer":"Update User"})]})]})]});return J?e.jsx(Nt,{open:!0,title:w?"Add New Customer":"Edit User",onClose:j,className:"user-edit-sheet",children:ae}):e.jsx("div",{className:"user-edit-overlay",children:e.jsxs("div",{className:"user-edit-modal fade-in-up",children:[e.jsxs("div",{className:"user-edit-header",children:[e.jsx("h2",{children:w?"Add New Customer":"Edit User"}),e.jsx("button",{className:"close-btn",onClick:j,children:e.jsx(we,{size:24})})]}),ae]})})}const Ys=()=>({id:Date.now()+Math.random(),name:"",price:0,qty:1,unit:"pcs",disc:0,discType:"fixed",amount:0}),en=()=>{const[i,j]=n.useState({name:"",email:"",phone:"",address:""}),[k,w]=n.useState([Ys()]),[c,U]=n.useState(!1),[u,R]=n.useState(null),[N,G]=n.useState(!1),[Z,_]=n.useState(0),[D,v]=n.useState(""),[J,M]=n.useState(""),[C,E]=n.useState(""),[ae,se]=n.useState([]),[d,A]=n.useState([]),W=n.useRef(null);n.useEffect(()=>{(async()=>{U(!0),R(null);try{const[S,F]=await Promise.all([ct.getAll(),be.getAll()]);se(S||[]),A(F||[])}catch(S){console.error("Error fetching initial data:",S),R("Failed to load data. Please refresh the page.")}finally{U(!1)}})()},[]),n.useEffect(()=>()=>{W.current&&clearTimeout(W.current)},[]);const V=n.useCallback((m,S,F,re)=>{const g=Number(m)||0,X=Math.max(1,Number(S)||1),ue=Number(F)||0,H=g*X;let xe=0;if(re==="percentage"){const Me=Math.min(100,Math.max(0,ue));xe=H*Me/100}else xe=Math.min(H,Math.max(0,ue));return{amount:Math.max(0,H-xe)}},[]),K=n.useCallback((m,S,F)=>{w(re=>{const g=[...re];if(S==="name"){const X=d.find(ue=>ue.name&&ue.name.toLowerCase()===F.trim().toLowerCase());if(X){const ue=Number(X.price)||0,H=Number(X.defaultDiscount)||0,xe=X.discountType||"fixed";g[m]={...g[m],name:X.name,productId:X.id,price:ue,qty:1,unit:X.uom||X.unit||"pcs",disc:H,discType:xe,amount:V(ue,1,H,xe).amount}}else g[m]={...g[m],name:F},g[m].amount=V(g[m].price,g[m].qty,g[m].disc,g[m].discType).amount}else if(S==="price")g[m].price=F,g[m].amount=V(F,g[m].qty,g[m].disc,g[m].discType).amount;else if(S==="qty"){const X=Math.max(1,Number(F)||1);g[m].qty=X,g[m].amount=V(g[m].price,X,g[m].disc,g[m].discType).amount}else if(S==="disc"){const X=Number(F)||0;g[m].disc=X,g[m].amount=V(g[m].price,g[m].qty,X,g[m].discType).amount}else S==="discType"?(g[m].discType=F,g[m].amount=V(g[m].price,g[m].qty,g[m].disc,F).amount):g[m][S]=F;return g})},[V,d]),y=()=>w(m=>[...m,Ys()]),ne=m=>{w(S=>S.length>1?S.filter((F,re)=>re!==m):S)},te=k.reduce((m,S)=>m+S.amount,0),Ne=Math.max(0,Math.min(Number(Z||0),Number(te||0))),p=Math.max(0,Number(te)-Ne),P=k.reduce((m,S)=>{const F=Number(S.price)||0,re=Math.max(1,Number(S.qty)||1),g=Number(S.disc)||0;if(S.discType==="percentage"){const X=Math.min(100,Math.max(0,g));return m+F*re*X/100}return m+Math.min(F*re,Math.max(0,g))},0),z=n.useCallback(async()=>{U(!0),R(null);try{const[m,S]=await Promise.all([ct.getAll(),be.getAll()]);se(m||[]),A(S||[])}catch(m){console.error("Error refreshing data:",m),R("Failed to refresh data. Please try again.")}finally{U(!1)}},[]),_e=n.useCallback(m=>{const{value:S}=m.target;W.current&&clearTimeout(W.current);const F=ae.find(re=>re.name&&re.name.toLowerCase()===S.toLowerCase());if(F){j({...F});return}j(re=>({...re,name:S})),S.length>=2&&(W.current=setTimeout(async()=>{try{const re=await ct.search(S);re&&re.length>0&&j({...re[0]})}catch(re){console.error("Error searching customers:",re)}},300))},[ae]),Ie=async()=>{var X,ue;if(!k.some(H=>H.name&&H.amount>0)){alert("Please add at least one item to the bill.");return}const S=Ne,F=H=>String(H||"").replace(/\D/g,""),re=(H,xe)=>String(H||"").trim().toLowerCase()===String(xe||"").trim().toLowerCase(),g={customer_id:i.id||null,customer_name:i.name,customer_email:i.email||null,customer_phone:i.phone||null,customer_address:i.address||null,discount_amount:Number(P.toFixed(2)),total_amount:Number(te.toFixed(2)),paid_amount:Number(S.toFixed(2)),credit_amount:Number(p.toFixed(2)),payment_method:"cash",payment_status:S<Number(te||0)?"pending":"paid",bill_type:"sales",items:k.filter(H=>H.name&&Number(H.amount)>0).map(H=>({product_id:H.productId||null,product_name:H.name,mrp:Number(H.price)||0,qty:Number(H.qty)||0,unit:H.unit||"pcs",discount:H.discType==="percentage"?(Number(H.price)||0)*(Number(H.qty)||0)*(Math.min(100,Math.max(0,Number(H.disc)||0))/100):Number(H.disc)||0,amount:Number(H.amount)||0}))};try{G(!0);let H=g.customer_id||null,xe=null;const Me=F(g.customer_phone);if(Me&&(xe=ae.find(O=>F(O.phone)===Me)||null,xe)){const O=re(xe.name,g.customer_name),ie=re(xe.email,g.customer_email);if(O&&ie)H=xe.id;else if(window.confirm(`A customer with this phone number already exists but name/email differ.
OK to update the existing customer with entered details, Cancel to use existing customer as-is.`)){const le=await He.update(xe.id,{name:g.customer_name,email:g.customer_email,phone:g.customer_phone,address:g.customer_address,role:"customer"}),oe=(le==null?void 0:le.user)||le||null;oe&&se(ns=>ns.map(Be=>Be.id===xe.id?oe:Be)),H=xe.id}else H=xe.id}if(!H){const O=String(g.customer_email||"").trim().toLowerCase(),ie=O?ae.find(me=>String(me.email||"").trim().toLowerCase()===O):null;if(ie)if(window.confirm(`A customer with this email already exists but phone number differs.
OK to update the existing customer phone to the entered phone, Cancel to create a new customer.`)){const le=await He.update(ie.id,{name:g.customer_name||ie.name,email:g.customer_email||ie.email,phone:g.customer_phone||ie.phone,address:g.customer_address||ie.address,role:"customer"}),oe=(le==null?void 0:le.user)||le||null;oe&&se(ns=>ns.map(Be=>Be.id===ie.id?oe:Be)),H=ie.id}else{const le=await He.create({name:g.customer_name,email:g.customer_email,phone:g.customer_phone,address:g.customer_address,role:"customer"});H=((X=le==null?void 0:le.user)==null?void 0:X.id)||null,le!=null&&le.user&&se(oe=>[...oe,le.user])}else{const me=await He.create({name:g.customer_name,email:g.customer_email,phone:g.customer_phone,address:g.customer_address,role:"customer"});H=((ue=me==null?void 0:me.user)==null?void 0:ue.id)||null,me!=null&&me.user&&se(le=>[...le,me.user])}}const he=[],Fe=g.items.map(O=>{let ie=null;if(O.product_id&&(ie=d.find(me=>me.id===O.product_id)||null),!ie){const me=String(O.product_name||"").trim().toLowerCase();ie=d.find(le=>String(le.name||"").trim().toLowerCase()===me)||null}return ie?(O.product_id=ie.id,(Number(ie.price||0)!==Number(O.mrp||0)||String(ie.uom||"").toLowerCase()!==String(O.unit||"").toLowerCase())&&he.push(be.update(ie.id,{name:ie.name,price:Number(O.mrp||0),mrp:Number(O.mrp||0),uom:O.unit||"pcs",category:ie.category||"Groceries"})),O):(he.push(be.create({name:O.product_name,price:Number(O.mrp||0),mrp:Number(O.mrp)||0,uom:O.unit||"pcs",category:"Groceries",stock:0}).then(me=>(me!=null&&me.id&&(O.product_id=me.id,A(le=>[...le,me])),O))),O)});he.length&&await Promise.all(he),g.customer_id=H,g.items=Fe;const fe=await Ut.createBill(g);g.customer_id&&p>0&&await xs.addTransaction(g.customer_id,{type:"given",amount:Number(p.toFixed(2)),description:`Bill credit | Paid: ${Q(Number(S))} | Credit: ${Q(Number(p))}`,reference:(fe==null?void 0:fe.bill_number)||null});let ts=Number(g.credit_amount||0);if(g.customer_id)try{const O=await xs.getBalance(g.customer_id);ts=Number((O==null?void 0:O.balance)||0)}catch{}const as=f({companyTitle:ha||"BARMAN STORE",bill_number:fe==null?void 0:fe.bill_number,created_at:new Date().toISOString(),items:g.items,total_amount:g.total_amount,paid_amount:g.paid_amount,credit_amount:g.credit_amount,current_total_credit:ts,payment_status:g.payment_status,thankYouLine:"Thank you for shopping with us."});v(as),M((fe==null?void 0:fe.bill_number)||""),E(g.customer_phone||""),alert("? Bill created successfully!"),j({name:"",email:"",phone:"",address:""}),w([Ys()]),_(0)}catch(H){console.error("Error creating bill:",H),alert(`Failed to create bill: ${H.message||"Unknown error"}`)}finally{G(!1)}},f=({companyTitle:m,thankYouLine:S,bill_number:F,created_at:re,items:g=[],total_amount:X=0,paid_amount:ue=0,credit_amount:H=0,current_total_credit:xe=0,payment_status:Me=""})=>{const he=[];return he.push(m),he.push(""),he.push(`Bill: ${F||""}`),he.push(`Date: ${new Date(re||Date.now()).toLocaleString()}`),he.push(""),he.push("Items:"),g.length?g.forEach(Fe=>{const fe=Fe.product_name||Fe.name||"Item",ts=Number(Fe.qty||Fe.quantity||0),as=Fe.unit||"",O=Number(Fe.amount||0);he.push(`- ${fe} ${ts}${as?` ${as}`:""} : Rs ${O}`)}):he.push("- None"),he.push(""),he.push(`Total: Rs ${Number(X||0)}`),he.push(`Paid: Rs ${Number(ue||0)}`),he.push(`Credit: Rs ${Number(H||0)}`),he.push(`Current Total Credit: Rs ${Number(xe||0)}`),he.push(`Status: ${Me||""}`),he.push(""),he.push(`Visit online: ${Mt}`),he.push(""),he.push(S),he.join(`
`)},$=async()=>{if(D)try{await navigator.clipboard.writeText(D),alert("Bill text copied.")}catch{alert("Failed to copy bill text.")}};return e.jsxs("div",{className:"billing-content",children:[e.jsx("h1",{children:"Billing Invoice"}),u&&e.jsxs("div",{className:"error-message",role:"alert",children:[u,e.jsx("button",{onClick:z,className:"retry-btn",children:"Retry"})]}),c&&e.jsx("div",{className:"loading-indicator",children:"Loading..."}),!c&&!u&&e.jsx("button",{onClick:z,className:"refresh-btn","aria-label":"Refresh customer and product data",children:"Refresh Data"}),e.jsxs("div",{className:"form-section",children:[e.jsxs("div",{className:"form-row",children:[e.jsx("label",{className:"form-label",htmlFor:"customerName",children:"Customer Name *"}),e.jsx("input",{id:"customerName",list:"customer-list",className:"form-input",value:i.name,onChange:_e,placeholder:"Type or select name...","aria-label":"Customer name","aria-autocomplete":"list",autoComplete:"name",required:!0}),e.jsx("datalist",{id:"customer-list",children:ae.map(m=>e.jsx("option",{value:m.name},m.id))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"form-label",htmlFor:"customerEmail",children:"Email"}),e.jsx("input",{id:"customerEmail",type:"email",className:"form-input",value:i.email,onChange:m=>j(S=>({...S,email:m.target.value})),"aria-label":"Customer email",placeholder:"email@example.com",autoComplete:"email"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"form-label",htmlFor:"customerPhone",children:"Phone *"}),e.jsx("input",{id:"customerPhone",type:"tel",className:"form-input",value:i.phone,onChange:m=>j(S=>({...S,phone:m.target.value})),"aria-label":"Customer phone",placeholder:"10-digit phone number",maxLength:"10",autoComplete:"tel"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"form-label",htmlFor:"customerAddress",children:"Address"}),e.jsx("input",{id:"customerAddress",type:"text",className:"form-input",value:i.address,onChange:m=>j(S=>({...S,address:m.target.value})),"aria-label":"Customer address",placeholder:"Full address",autoComplete:"street-address"})]})]}),e.jsx("div",{className:"table-container",children:e.jsxs("table",{className:"billing-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Product Name"}),e.jsx("th",{className:"w-24",children:"Price"}),e.jsx("th",{className:"w-20",children:"Qty"}),e.jsx("th",{className:"w-24",children:"Unit"}),e.jsx("th",{className:"w-28",children:"Disc"}),e.jsx("th",{className:"w-32",children:"Amount"}),e.jsx("th",{className:"w-12"})]})}),e.jsx("tbody",{children:k.map((m,S)=>e.jsxs("tr",{children:[e.jsxs("td",{"data-label":"Product Name",children:[e.jsx("input",{list:"product-list",value:m.name,onChange:F=>K(S,"name",F.target.value),"aria-label":"Product name",placeholder:"Type or select product...",autoComplete:"off"}),e.jsx("datalist",{id:"product-list",children:d.map(F=>e.jsx("option",{value:F.name},F.id))})]}),e.jsx("td",{"data-label":"Price",children:e.jsx("input",{type:"number",value:m.price,onChange:F=>K(S,"price",F.target.value),"aria-label":"Price per unit",min:"0",step:"0.01"})}),e.jsx("td",{"data-label":"Quantity",children:e.jsx("input",{type:"number",value:m.qty,onChange:F=>K(S,"qty",F.target.value),"aria-label":"Quantity",min:"1"})}),e.jsx("td",{"data-label":"Unit",children:e.jsx("input",{type:"text",value:m.unit,onChange:F=>K(S,"unit",F.target.value),"aria-label":"Unit of measurement",placeholder:"pcs, kg, etc."})}),e.jsx("td",{"data-label":"Discount",children:e.jsxs("div",{className:"discount-field",children:[e.jsx("input",{type:"number",value:m.disc,onChange:F=>K(S,"disc",F.target.value),"aria-label":"Discount value",min:"0",step:m.discType==="percentage"?"1":"0.01",className:"disc-input"}),e.jsxs("select",{value:m.discType,onChange:F=>K(S,"discType",F.target.value),"aria-label":"Discount type",className:"disc-type-select",children:[e.jsx("option",{value:"fixed",children:"Rs"}),e.jsx("option",{value:"percentage",children:"%"})]})]})}),e.jsx("td",{className:"amount-cell","data-label":"Amount",children:Q(m.amount)}),e.jsx("td",{className:"text-center","data-label":"Action",children:e.jsx("button",{onClick:()=>ne(S),disabled:k.length===1,className:"delete-btn","aria-label":"Remove item",children:e.jsx(ss,{size:18})})})]},m.id))})]})}),e.jsxs("div",{className:"actions",children:[e.jsxs("button",{onClick:y,className:"add-btn","aria-label":"Add new product",children:[e.jsx(Pe,{size:18})," Add Product"]}),e.jsxs("div",{className:"total-section",children:[e.jsx("p",{children:"Total Payable:"}),e.jsx("p",{children:Q(te)})]})]}),e.jsxs("div",{className:"form-section",children:[e.jsxs("div",{className:"form-row",children:[e.jsx("label",{className:"form-label",htmlFor:"paidAmount",children:"Paid Amount"}),e.jsx("input",{id:"paidAmount",type:"number",min:"0",step:"0.01",className:"form-input",value:Z,onChange:m=>_(m.target.value),placeholder:"0.00"})]}),e.jsxs("div",{className:"form-row",children:[e.jsx("label",{className:"form-label",children:"Credit "}),e.jsx("div",{className:"form-input","aria-live":"polite",children:Q(p)})]})]}),e.jsxs("div",{className:"billing-form-controls",children:[e.jsx("button",{className:"reset",onClick:()=>{j({name:"",email:"",phone:"",address:""}),w([Ys()]),_(0)},children:"Clear"}),e.jsx("button",{className:"submit",onClick:Ie,disabled:N,children:"? Create Bill"})]}),D&&e.jsxs("div",{className:"share-box",children:[e.jsx("div",{className:"share-header",children:e.jsxs("strong",{children:["Share Bill ",J?`#${J}`:""]})}),e.jsx("textarea",{className:"share-text",readOnly:!0,value:D}),e.jsxs("div",{className:"share-actions",children:[e.jsx("button",{className:"share-btn",onClick:$,children:"Copy"}),e.jsx("a",{className:"share-btn whatsapp",href:Ht({phone:C||(i==null?void 0:i.phone),text:D}),target:"_blank",rel:"noreferrer",children:"WhatsApp"})]})]})]})},Ve={name:"BARMAN STORE",gstNumber:"GST00000001",address:"COTTONROAD",phone:"0123456789",email:"barmanstore@store.com",logoPath:"/logo.png"},sn=()=>{const[i,j]=n.useState([]),[k,w]=n.useState(!0),[c,U]=n.useState(null),[u,R]=n.useState(""),[N,G]=n.useState(null);n.useEffect(()=>{Z()},[]);const Z=async()=>{try{w(!0),U(null);const d=await Ut.getAll();j(d||[])}catch(d){console.error("Error fetching bills:",d),U("Failed to load bills. Please try again.")}finally{w(!1)}},_=async d=>{if(window.confirm("Are you sure you want to delete this bill?"))try{if(!(await fetch(`/api/bills/${d}`,{method:"DELETE"})).ok)throw new Error("Failed to delete bill");j(i.filter(W=>W.id!==d)),G(null),alert("Bill deleted successfully")}catch(A){console.error("Error deleting bill:",A),alert("Error deleting bill: "+A.message)}},D=d=>{var ne;const A=ka(),W=[41,128,185],V=[52,73,94],K=(Array.isArray(d.items)?d.items:[]).map(te=>[String(te.product_name||te.name||"-"),Number(te.qty||te.quantity||0),String(te.unit||"-"),{content:`Rs ${Number(te.mrp||0).toFixed(2)}`,styles:{halign:"right"}},{content:`Rs ${Number(te.discount||0).toFixed(2)}`,styles:{halign:"right"}},{content:`Rs ${Number(te.amount||0).toFixed(2)}`,styles:{halign:"right"}}]);A.setFillColor(...W),A.rect(0,0,210,40,"F"),A.setTextColor(255,255,255),A.setFontSize(22),A.setFont("helvetica","bold"),A.text(Ve.name,105,15,{align:"center"}),A.setFontSize(10),A.setFont("helvetica","normal"),A.text(`${Ve.address} | ${Ve.phone}`,105,24,{align:"center"}),A.text(`GST: ${Ve.gstNumber}`,105,31,{align:"center"}),A.setTextColor(...V),A.setFontSize(15),A.setFont("helvetica","bold"),A.text("Bill Invoice",105,50,{align:"center"}),A.setFontSize(10),A.setFont("helvetica","normal"),A.text(`Bill #: ${d.bill_number||"-"}`,14,60),A.text(`Date: ${new Date(d.created_at||Date.now()).toLocaleString()}`,14,66),A.text(`Customer: ${d.customer_name||"-"}`,14,72),d.customer_phone&&A.text(`Phone: ${d.customer_phone}`,14,78),d.customer_email&&A.text(`Email: ${d.customer_email}`,14,84),d.customer_address&&A.text(`Address: ${d.customer_address}`,14,90),Da(A,{startY:96,head:[["Product","Qty","Unit","MRP","Discount","Amount"]],body:K,theme:"striped",headStyles:{fillColor:W,textColor:[255,255,255],fontStyle:"bold",fontSize:9},bodyStyles:{fontSize:8,cellPadding:3},columnStyles:{0:{cellWidth:"auto"},1:{cellWidth:14,halign:"right"},2:{cellWidth:16},3:{cellWidth:26,halign:"right"},4:{cellWidth:26,halign:"right"},5:{cellWidth:28,halign:"right"}},margin:{left:14,right:14}});const y=(((ne=A.lastAutoTable)==null?void 0:ne.finalY)||96)+8;A.setFontSize(10),A.setFont("helvetica","bold"),A.text(`Subtotal: Rs ${Number(d.subtotal||0).toFixed(2)}`,130,y),A.text(`Discount: Rs ${Number(d.discount_amount||0).toFixed(2)}`,130,y+7),A.text(`Total: Rs ${Number(d.total_amount||0).toFixed(2)}`,130,y+14),A.setFont("helvetica","normal"),A.text(`Payment: ${d.payment_method||"-"}`,14,y+7),A.text(`Status: ${d.payment_status||"-"}`,14,y+14),Aa(A,(te,Ne,p)=>{te.setFontSize(8),te.setTextColor(140,140,140),te.text(`Generated on ${new Date().toLocaleString("en-IN")} | Page ${Ne} of ${p}`,105,te.internal.pageSize.height-10,{align:"center"})}),Pa(A,`${Ta(d.bill_number||"Bill")}_Invoice`)},v=d=>{const A=Array.isArray(d.items)?d.items:[],W=[`BILL #${d.bill_number||""}`,`Date: ${new Date(d.created_at||Date.now()).toLocaleString()}`,`Customer: ${d.customer_name||""}`,d.customer_phone?`Phone: ${d.customer_phone}`:null,d.customer_email?`Email: ${d.customer_email}`:null,d.customer_address?`Address: ${d.customer_address}`:null,"","Items:"];return A.length===0?W.push("- None"):A.forEach(V=>{const K=V.product_name||V.name||"Item",y=Number(V.qty||V.quantity||0),ne=V.unit||"",te=Number(V.amount||0);W.push(`- ${K} ${y}${ne?" "+ne:""} : Rs ${te}`)}),W.push(""),W.push(`Total: Rs ${Number(d.total_amount||0)}`),W.push(`Paid: Rs ${Number(d.paid_amount||0)}`),W.push(`Credit: Rs ${Number(d.credit_amount||0)}`),W.push(`Status: ${d.payment_status||""}`),W.push(""),W.push(`Visit online: ${Mt}`),W.filter(Boolean).join(`
`)},J=d=>{const A=`BILL ${d.bill_number||""} Total Rs ${Number(d.total_amount||0)} Paid Rs ${Number(d.paid_amount||0)} Credit Rs ${Number(d.credit_amount||0)}. ${Ve.name}`;return A.length>160?A.slice(0,157)+"...":A},M=d=>{const W=(Array.isArray(d.items)?d.items:[]).map(V=>{const K=Ce(V.product_name||V.name||"Item"),y=Number(V.qty||V.quantity||0),ne=Ce(V.unit||""),te=Number(V.mrp||0),Ne=Number(V.discount||0),p=Number(V.amount||0);return`
        <tr>
          <td>${K}</td>
          <td>${y}${ne?" "+ne:""}</td>
          <td>Rs ${te.toFixed(2)}</td>
          <td>Rs ${Ne.toFixed(2)}</td>
          <td>Rs ${p.toFixed(2)}</td>
        </tr>
      `}).join("");return`
      <div class="invoice">
        <div class="invoice-header">
          <div class="invoice-brand">
            ${`<img src="${Ve.logoPath}" alt="Logo" />`}
            <div>
              <div class="company-name">${Ce(Ve.name)}</div>
              <div class="company-meta">GST: ${Ce(Ve.gstNumber)}</div>
              <div class="company-meta">${Ce(Ve.address)}</div>
              <div class="company-meta">${Ce(Ve.phone)} | ${Ce(Ve.email)}</div>
            </div>
          </div>
          <div class="invoice-info">
            <div><strong>Bill #</strong> ${Ce(d.bill_number||"")}</div>
            <div><strong>Date</strong> ${new Date(d.created_at||Date.now()).toLocaleString()}</div>
            <div><strong>Status</strong> ${Ce(d.payment_status||"")}</div>
          </div>
        </div>

        <div class="invoice-section">
          <div><strong>Customer</strong></div>
          <div>${Ce(d.customer_name||"")}</div>
          ${d.customer_phone?`<div>${Ce(d.customer_phone)}</div>`:""}
          ${d.customer_email?`<div>${Ce(d.customer_email)}</div>`:""}
          ${d.customer_address?`<div>${Ce(d.customer_address)}</div>`:""}
        </div>

        <table class="invoice-table">
          <thead>
            <tr>
              <th>Item</th>
              <th>Qty</th>
              <th>MRP</th>
              <th>Discount</th>
              <th>Amount</th>
            </tr>
          </thead>
          <tbody>
            ${W||'<tr><td colspan="5">No items</td></tr>'}
          </tbody>
        </table>

        <div class="invoice-summary">
          <div><span>Subtotal</span><span>Rs ${Number(d.subtotal||0).toFixed(2)}</span></div>
          <div><span>Discount</span><span>Rs ${Number(d.discount_amount||0).toFixed(2)}</span></div>
          <div><span>Total</span><span>Rs ${Number(d.total_amount||0).toFixed(2)}</span></div>
          <div><span>Paid</span><span>Rs ${Number(d.paid_amount||0).toFixed(2)}</span></div>
          <div><span>Credit</span><span>Rs ${Number(d.credit_amount||0).toFixed(2)}</span></div>
        </div>

        <div class="invoice-footer">
          <div>Thank you for your business.</div>
        </div>
      </div>
    `},C=d=>{const A=M(d);Bt({title:`Bill ${d.bill_number||""}`,bodyHtml:A,cssText:`
        .invoice { max-width: 800px; margin: 0 auto; }
        .invoice-header { display: flex; justify-content: space-between; gap: 16px; margin-bottom: 16px; }
        .invoice-brand { display: flex; gap: 12px; align-items: center; }
        .invoice-brand img { width: 60px; height: 60px; object-fit: contain; }
        .company-name { font-size: 18px; font-weight: 700; }
        .company-meta { font-size: 12px; color: #444; }
        .invoice-info { text-align: right; font-size: 12px; }
        .invoice-section { margin: 12px 0 16px; font-size: 12px; }
        .invoice-table { width: 100%; border-collapse: collapse; font-size: 12px; }
        .invoice-table th, .invoice-table td { border: 1px solid #ddd; padding: 6px; text-align: left; }
        .invoice-summary { margin-top: 12px; display: grid; gap: 6px; font-size: 12px; }
        .invoice-summary div { display: flex; justify-content: space-between; }
        .invoice-footer { margin-top: 16px; font-size: 12px; text-align: center; color: #444; }
      `,onError:W=>alert(W)})},E=async d=>{const A=v(d);try{await navigator.clipboard.writeText(A),alert("Bill text copied.")}catch{alert("Failed to copy bill text.")}},ae=async d=>{const A=J(d);try{await navigator.clipboard.writeText(A),alert("SMS text copied.")}catch{alert("Failed to copy SMS text.")}},se=i.filter(d=>{var A,W,V;return((A=d.bill_number)==null?void 0:A.toLowerCase().includes(u.toLowerCase()))||((W=d.customer_name)==null?void 0:W.toLowerCase().includes(u.toLowerCase()))||((V=d.customer_email)==null?void 0:V.toLowerCase().includes(u.toLowerCase()))});return k?e.jsx("div",{className:"bills-viewer-loading",children:"Loading bills..."}):e.jsxs("div",{className:"bills-viewer",children:[e.jsxs("div",{className:"bills-viewer-header",children:[e.jsx("h1",{children:"📋 Bills History"}),e.jsx("p",{children:"View and manage all created bills"})]}),c&&e.jsxs("div",{className:"bills-viewer-error",children:[c,e.jsx("button",{onClick:Z,children:"Retry"})]}),e.jsxs("div",{className:"bills-viewer-controls",children:[e.jsxs("div",{className:"search-box",children:[e.jsx(_t,{size:18}),e.jsx("input",{type:"text",placeholder:"Search by bill number, customer name, or email...",value:u,onChange:d=>R(d.target.value)})]}),e.jsx("button",{className:"refresh-btn",onClick:Z,children:"Refresh"})]}),se.length===0?e.jsx("div",{className:"bills-viewer-empty",children:e.jsx("p",{children:"No bills found"})}):e.jsxs("div",{className:"bills-viewer-content",children:[e.jsx("div",{className:"bills-list",children:se.map(d=>e.jsxs("div",{className:`bill-card ${(N==null?void 0:N.id)===d.id?"active":""}`,onClick:()=>G(d),children:[e.jsxs("div",{className:"bill-card-header",children:[e.jsx("span",{className:"bill-number",children:d.bill_number}),e.jsxs("span",{className:"bill-amount",children:["₹",d.total_amount]})]}),e.jsxs("div",{className:"bill-card-details",children:[e.jsx("p",{children:e.jsx("strong",{children:d.customer_name})}),e.jsx("p",{className:"bill-date",children:new Date(d.created_at).toLocaleDateString()})]}),e.jsx("div",{className:"bill-card-status",children:e.jsx("span",{className:`status-badge ${d.payment_status}`,children:d.payment_status})})]},d.id))}),N&&e.jsxs("div",{className:"bill-details",children:[e.jsxs("div",{className:"bill-details-header",children:[e.jsx("h2",{children:N.bill_number}),e.jsxs("div",{className:"bill-details-actions",children:[e.jsx("button",{className:"action-btn print-btn",onClick:()=>C(N),title:"Print / Save as PDF",children:"Print/PDF"}),e.jsxs("button",{className:"action-btn download-btn",onClick:()=>D(N),title:"Download PDF",children:[e.jsx(Gt,{size:18})," PDF"]}),e.jsx("button",{className:"action-btn share-btn",onClick:()=>E(N),title:"Copy bill text",children:"Copy"}),e.jsx("button",{className:"action-btn sms-btn",onClick:()=>ae(N),title:"Copy SMS text",children:"SMS"}),e.jsx("a",{className:"action-btn whatsapp-btn",href:Ht({phone:N==null?void 0:N.customer_phone,text:v(N)}),target:"_blank",rel:"noreferrer",title:"Share via WhatsApp",children:"WhatsApp"}),e.jsxs("button",{className:"action-btn delete-btn",onClick:()=>_(N.id),title:"Delete bill",children:[e.jsx(ss,{size:18})," Delete"]})]})]}),e.jsxs("div",{className:"bill-details-section",children:[e.jsx("h3",{children:"Customer Information"}),e.jsxs("div",{className:"detail-row",children:[e.jsx("label",{children:"Name:"}),e.jsx("span",{children:N.customer_name})]}),e.jsxs("div",{className:"detail-row",children:[e.jsx("label",{children:"Email:"}),e.jsx("span",{children:N.customer_email})]}),e.jsxs("div",{className:"detail-row",children:[e.jsx("label",{children:"Phone:"}),e.jsx("span",{children:N.customer_phone})]}),N.customer_address&&e.jsxs("div",{className:"detail-row",children:[e.jsx("label",{children:"Address:"}),e.jsx("span",{children:N.customer_address})]})]}),N.items&&N.items.length>0&&e.jsxs("div",{className:"bill-details-section",children:[e.jsx("h3",{children:"Bill Items"}),e.jsxs("table",{className:"bill-items-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Product"}),e.jsx("th",{children:"Qty"}),e.jsx("th",{children:"Unit"}),e.jsx("th",{children:"MRP"}),e.jsx("th",{children:"Discount"}),e.jsx("th",{children:"Amount"})]})}),e.jsx("tbody",{children:N.items.map((d,A)=>e.jsxs("tr",{children:[e.jsx("td",{children:d.product_name}),e.jsx("td",{children:d.qty}),e.jsx("td",{children:d.unit}),e.jsxs("td",{children:["₹",d.mrp]}),e.jsxs("td",{children:["₹",d.discount]}),e.jsxs("td",{children:["₹",d.amount]})]},A))})]})]}),e.jsxs("div",{className:"bill-details-section",children:[e.jsx("h3",{children:"Payment Summary"}),e.jsxs("div",{className:"summary-row",children:[e.jsx("span",{children:"Subtotal:"}),e.jsxs("span",{children:["₹",N.subtotal]})]}),e.jsxs("div",{className:"summary-row",children:[e.jsx("span",{children:"Discount:"}),e.jsxs("span",{children:["₹",N.discount_amount]})]}),e.jsxs("div",{className:"summary-row highlight",children:[e.jsx("span",{children:"Total:"}),e.jsxs("span",{children:["₹",N.total_amount]})]}),e.jsxs("div",{className:"summary-row",children:[e.jsx("span",{children:"Paid Amount:"}),e.jsxs("span",{children:["₹",N.paid_amount??0]})]}),e.jsxs("div",{className:"summary-row",children:[e.jsx("span",{children:"Credit Amount:"}),e.jsxs("span",{children:["₹",N.credit_amount??0]})]}),e.jsxs("div",{className:"summary-row",children:[e.jsx("span",{children:"Payment Method:"}),e.jsx("span",{children:N.payment_method})]}),e.jsxs("div",{className:"summary-row",children:[e.jsx("span",{children:"Payment Status:"}),e.jsx("span",{className:`status-badge ${N.payment_status}`,children:N.payment_status})]}),e.jsxs("div",{className:"summary-row",children:[e.jsx("span",{children:"Created:"}),e.jsx("span",{children:new Date(N.created_at).toLocaleString()})]})]})]})]})]})};function tn(){const[i,j]=n.useState([]),[k,w]=n.useState(!0),[c,U]=n.useState(""),[u,R]=n.useState({name:"",description:"",type:"percentage",value:0,status:"active"}),N=async()=>{try{w(!0),j(await ot.getAll())}catch{U("Failed to load offers")}finally{w(!1)}};n.useEffect(()=>{N()},[]);const G=async _=>{_.preventDefault(),U("");try{await ot.create(u),R({name:"",description:"",type:"percentage",value:0,status:"active"}),await N()}catch(D){U(D.message||"Failed to create offer")}},Z=async _=>{try{await ot.delete(_),j(D=>D.filter(v=>v.id!==_))}catch{U("Failed to delete offer")}};return k?e.jsx("div",{className:"billing-content",children:e.jsx("p",{children:"Loading offers..."})}):e.jsxs("div",{className:"billing-content",children:[e.jsx("h1",{children:"Offer Management"}),c&&e.jsx("div",{className:"error-message",children:c}),e.jsxs("form",{onSubmit:G,className:"form-section",children:[e.jsxs("div",{className:"form-row",children:[e.jsx("label",{className:"form-label",children:"Name"}),e.jsx("input",{className:"form-input",value:u.name,onChange:_=>R(D=>({...D,name:_.target.value})),required:!0})]}),e.jsxs("div",{className:"form-row",children:[e.jsx("label",{className:"form-label",children:"Description"}),e.jsx("input",{className:"form-input",value:u.description,onChange:_=>R(D=>({...D,description:_.target.value}))})]}),e.jsxs("div",{className:"form-row",children:[e.jsx("label",{className:"form-label",children:"Type"}),e.jsxs("select",{className:"form-input",value:u.type,onChange:_=>R(D=>({...D,type:_.target.value})),children:[e.jsx("option",{value:"percentage",children:"Percentage"}),e.jsx("option",{value:"bogo",children:"Buy One Get One"}),e.jsx("option",{value:"bundle",children:"Bundle"}),e.jsx("option",{value:"volume",children:"Volume"})]})]}),e.jsxs("div",{className:"form-row",children:[e.jsx("label",{className:"form-label",children:"Value"}),e.jsx("input",{type:"number",className:"form-input",value:u.value,onChange:_=>R(D=>({...D,value:Number(_.target.value||0)}))})]}),e.jsxs("button",{type:"submit",className:"add-btn",children:[e.jsx(Pe,{size:16})," Add Offer"]})]}),e.jsx("div",{className:"table-container",children:e.jsxs("table",{className:"billing-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Name"}),e.jsx("th",{children:"Type"}),e.jsx("th",{children:"Value"}),e.jsx("th",{children:"Status"}),e.jsx("th",{})]})}),e.jsx("tbody",{children:i.map(_=>e.jsxs("tr",{children:[e.jsx("td",{children:_.name}),e.jsx("td",{children:_.type}),e.jsx("td",{children:_.value}),e.jsx("td",{children:_.status}),e.jsx("td",{children:e.jsx("button",{className:"delete-btn",onClick:()=>Z(_.id),children:e.jsx(ss,{size:16})})})]},_.id))})]})})]})}function an(){const[i,j]=n.useState([]),[k,w]=n.useState(""),[c,U]=n.useState(!0),[u,R]=n.useState({}),[N,G]=n.useState(null),Z=async()=>{try{U(!0),j(await $s.getPasswordResetRequests())}catch{w("Failed to load password reset requests")}finally{U(!1)}};n.useEffect(()=>{Z()},[]);const _=async(v,J)=>{try{G(v),w("");const M=u[v]||{},C={status:J};M.admin_note&&(C.admin_note=M.admin_note),J==="approved"&&M.new_password&&(C.new_password=M.new_password),await $s.updatePasswordResetRequest(v,C),R(E=>{const ae={...E};return delete ae[v],ae}),await Z()}catch{w("Failed to update request")}finally{G(null)}},D=(v,J,M)=>{R(C=>({...C,[v]:{...C[v]||{},[J]:M}}))};return c?e.jsx("div",{className:"billing-content",children:e.jsx("p",{children:"Loading reset requests..."})}):e.jsxs("div",{className:"billing-content",children:[e.jsx("h1",{children:"Password Reset Requests"}),k&&e.jsx("div",{className:"error-message",children:k}),e.jsx("div",{className:"table-container",children:e.jsxs("table",{className:"billing-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"User"}),e.jsx("th",{children:"Email"}),e.jsx("th",{children:"Phone"}),e.jsx("th",{children:"Reason"}),e.jsx("th",{children:"Status"}),e.jsx("th",{children:"Actions"})]})}),e.jsx("tbody",{children:i.map(v=>e.jsxs("tr",{children:[e.jsx("td",{children:v.user_name||"-"}),e.jsx("td",{children:v.email||"-"}),e.jsx("td",{children:v.phone||"-"}),e.jsx("td",{children:v.reason||"-"}),e.jsx("td",{children:v.status}),e.jsx("td",{children:v.status==="pending"?e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:[e.jsx("input",{type:"password",placeholder:"Set new password (optional, defaults to '1234')",value:u[v.id]&&u[v.id].new_password||"",onChange:J=>D(v.id,"new_password",J.target.value),style:{padding:"6px 8px",borderRadius:6,border:"1px solid var(--color-border)"},disabled:N===v.id}),e.jsx("textarea",{placeholder:"Admin note (optional)",value:u[v.id]&&u[v.id].admin_note||"",onChange:J=>D(v.id,"admin_note",J.target.value),rows:2,style:{padding:"6px 8px",borderRadius:6,border:"1px solid var(--color-border)"},disabled:N===v.id}),e.jsxs("div",{style:{display:"flex",gap:"0.5rem"},children:[e.jsx("button",{className:"admin-btn",onClick:()=>_(v.id,"approved"),disabled:N===v.id,children:N===v.id?"Processing...":"Approve"}),e.jsx("button",{className:"admin-btn",onClick:()=>_(v.id,"rejected"),disabled:N===v.id,children:"Reject"})]})]}):e.jsx("span",{children:v.status})})]},v.id))})]})})]})}const Es=i=>Xt(i,["transaction_date","created_at","date"]),nn=i=>new Date(Es(i)).toLocaleDateString(),rn=i=>Number((i==null?void 0:i.edited)||0)===1||!!(i!=null&&i.edited_at),bt=()=>({user_id:"",type:"payment",amount:"",transactionDate:Ns(),reference:"",description:""});function ln({user:i}){const[j,k]=n.useState(!0),[w,c]=n.useState(!1),[U,u]=n.useState(""),[R,N]=n.useState([]),[G,Z]=n.useState([]),[_,D]=n.useState({user_id:""}),[v,J]=n.useState(!1),[M,C]=n.useState(bt()),[E,ae]=n.useState(null),se=n.useMemo(()=>{const p={};return R.forEach(P=>{p[String(P.id)]=P}),p},[R]),d=async()=>{const P=(await He.getAll()||[]).filter(z=>z.role!=="admin");return N(P),P},A=async(p,P=R)=>{c(!0),u("");try{let z=[];try{z=await xs.getLedger(p||"")}catch($){const m=String(($==null?void 0:$.message)||"").toLowerCase();if(!(m.includes("not found")||m.includes("cannot get")||m.includes("not available")))throw $;const F=p?P.filter(g=>String(g.id)===String(p)):P;z=(await Promise.all(F.map(async g=>(await xs.getHistory(g.id)||[]).map(ue=>({...ue,user_id:ue.user_id??g.id,customer_name:ue.customer_name||g.name}))))).flat()}const _e={},f=[...z||[]].sort(($,m)=>{const S=Es($)-Es(m);return S!==0?S:Number($.id||0)-Number(m.id||0)}).map($=>{const m=String($.user_id||"unknown"),F=(_e[m]||0)+Wt($);return _e[m]=F,{...$,computed_balance:F}});Z(f.sort(($,m)=>{const S=Es(m)-Es($);return S!==0?S:Number(m.id||0)-Number($.id||0)}))}catch(z){if((z==null?void 0:z.status)===401){localStorage.removeItem("user"),window.location.href="/login";return}u(z.message||"Failed to load credit khata ledger"),Z([])}finally{c(!1)}};n.useEffect(()=>{(async()=>{k(!0),u("");try{await d()}catch(P){if((P==null?void 0:P.status)===401){localStorage.removeItem("user"),window.location.href="/login";return}u(P.message||"Failed to load credit khata data")}finally{k(!1)}})()},[]),n.useEffect(()=>{j||A(_.user_id,R)},[_.user_id,j]);const W=p=>{D({user_id:p.target.value})},V=()=>{u(""),ae(null),C({...bt(),user_id:_.user_id||""}),J(!0)},K=p=>{u(""),ae(Number(p.id||0)),C({user_id:String(p.user_id||""),type:p.type==="payment"?"payment":"given",amount:String(L(p.amount||0)),transactionDate:String(p.transaction_date||"").slice(0,10)||Ns(),reference:p.reference||"",description:p.description||""}),J(!0)},y=()=>{J(!1),ae(null),C(bt())},ne=async p=>{p.preventDefault(),u("");const P=L(M.amount);if(!M.user_id){u("Please select a customer");return}if(P<=0){u("Please enter a valid amount");return}if(!M.description.trim()){u("Please enter a description");return}try{E?await xs.updateTransaction(M.user_id,E,{type:M.type,amount:Number(P.toFixed(2)),reference:M.reference,description:M.description,transactionDate:M.transactionDate,edited_by:i==null?void 0:i.id}):await xs.addTransaction(M.user_id,{type:M.type,amount:Number(P.toFixed(2)),reference:M.reference,description:M.description,transactionDate:M.transactionDate,created_by:i==null?void 0:i.id}),y(),await A(_.user_id,R)}catch(z){if((z==null?void 0:z.status)===401){localStorage.removeItem("user"),window.location.href="/login";return}u(z.message||(E?"Failed to edit ledger transaction":"Failed to add ledger transaction"))}},te=n.useMemo(()=>{const p={};for(const P of G){const z=String(P.user_id||"unknown");p[z]===void 0&&(p[z]=L(P.computed_balance??P.balance))}return _.user_id?{label:"Customer Balance",value:L(p[String(_.user_id)]||0)}:{label:"Total Balance (All Customers)",value:Object.values(p).reduce((P,z)=>P+L(z),0)}},[_.user_id,G]),Ne=n.useMemo(()=>{const p={};for(const P of G){const z=String(P.user_id||"");!z||p[z]||(p[z]=Number(P.id||0))}return p},[G]);return j?e.jsx("div",{className:"credit-khata",children:e.jsx("div",{className:"loading",children:"Loading credit khata..."})}):!i||i.role!=="admin"?e.jsx("div",{className:"credit-khata",children:e.jsx("div",{className:"error-message",children:"Only administrators can access Credit Khata."})}):e.jsxs("div",{className:"credit-khata purchase-management",children:[U&&e.jsx("div",{className:"error-message",children:U}),e.jsx("div",{className:"filters-bar",children:e.jsxs("div",{className:"filter-group",children:[e.jsx("label",{children:"Customer:"}),e.jsxs("select",{name:"user_id",value:_.user_id,onChange:W,children:[e.jsx("option",{value:"",children:"All Customers"}),R.map(p=>e.jsx("option",{value:p.id,children:p.name},p.id))]})]})}),e.jsxs("div",{className:"actions-bar ledger-header",children:[e.jsx("h2",{children:"Customer Credit / Payment Ledger"}),e.jsx("div",{className:"action-buttons",children:e.jsxs("button",{className:"admin-btn primary",onClick:V,children:[e.jsx(Pe,{size:18})," Payment / Credit Entry"]})})]}),e.jsxs("div",{className:"ledger-balance-summary",children:[e.jsx("span",{className:"ledger-balance-label",children:te.label}),e.jsx("strong",{className:`ledger-balance-value ${te.value>=0?"positive":"negative"}`,children:Q(te.value)})]}),e.jsx("div",{className:"data-table",children:e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Date"}),e.jsx("th",{children:"Customer"}),e.jsx("th",{children:"Type"}),e.jsx("th",{children:"Amount"}),e.jsx("th",{children:"Balance"}),e.jsx("th",{children:"Reference"}),e.jsx("th",{children:"Description"}),e.jsx("th",{children:"Status"}),e.jsx("th",{children:"Actions"})]})}),e.jsx("tbody",{children:w?e.jsx("tr",{children:e.jsx("td",{colSpan:"9",className:"empty-state",children:"Loading ledger records..."})}):G.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:"9",className:"empty-state",children:"No customer payment/credit records found"})}):G.map((p,P)=>{var Ie;const z=String(p.user_id||""),_e=Number(p.id||0)>0&&Number(p.id||0)===Number(Ne[z]||0);return e.jsxs("tr",{children:[e.jsx("td",{children:nn(p)}),e.jsx("td",{children:((Ie=se[z])==null?void 0:Ie.name)||p.customer_name||"-"}),e.jsx("td",{children:Jt(p)}),e.jsx("td",{children:Q(L(p.amount))}),e.jsx("td",{children:Q(L(p.computed_balance??p.balance))}),e.jsx("td",{children:p.reference||p.invoice_number||"-"}),e.jsx("td",{children:p.description||"-"}),e.jsx("td",{children:rn(p)?"EDITED":"-"}),e.jsx("td",{children:_e?e.jsx("button",{type:"button",className:"admin-btn",onClick:()=>K(p),title:"Only latest transaction for this customer can be edited",children:"Edit"}):"-"})]},p.id||P)})})]})}),v&&e.jsx("div",{className:"modal-overlay",onClick:y,children:e.jsxs("div",{className:"modal-content",onClick:p=>p.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h2",{children:E?"Edit Latest Customer Transaction":"Add Customer Payment / Credit"}),e.jsx("button",{className:"close-btn",onClick:y,children:e.jsx(we,{size:24})})]}),e.jsxs("form",{onSubmit:ne,children:[e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Customer *"}),e.jsxs("select",{value:M.user_id,onChange:p=>C(P=>({...P,user_id:p.target.value})),disabled:!!E,required:!0,children:[e.jsx("option",{value:"",children:"Select customer"}),R.map(p=>e.jsx("option",{value:p.id,children:p.name},p.id))]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Type *"}),e.jsxs("select",{value:M.type,onChange:p=>C(P=>({...P,type:p.target.value})),children:[e.jsx("option",{value:"payment",children:"Payment (Reduce due)"}),e.jsx("option",{value:"given",children:"Credit (Increase due)"})]})]})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Amount *"}),e.jsx("input",{type:"number",step:"0.01",min:"0.01",value:M.amount,onChange:p=>C(P=>({...P,amount:p.target.value})),placeholder:"Enter amount",required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Transaction Date"}),e.jsx("input",{type:"date",value:M.transactionDate,onChange:p=>C(P=>({...P,transactionDate:p.target.value}))})]})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Reference"}),e.jsx("input",{type:"text",value:M.reference,onChange:p=>C(P=>({...P,reference:p.target.value})),placeholder:"Bill / UPI / Bank ref"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Description *"}),e.jsx("input",{type:"text",value:M.description,onChange:p=>C(P=>({...P,description:p.target.value})),placeholder:"Enter description",required:!0})]})]}),e.jsxs("div",{className:"modal-actions",children:[e.jsx("button",{type:"button",className:"cancel-btn",onClick:y,children:"Cancel"}),e.jsx("button",{type:"submit",className:"submit-btn",children:E?"Update Entry":"Save Entry"})]})]})]})})]})}const Ps=i=>{const j=Q(Math.abs(i));return e.jsx("span",{className:va(i),children:j})},cn=i=>{const j=Number(i||0);return j<1024?`${j} B`:j<1024*1024?`${(j/1024).toFixed(1)} KB`:j<1024*1024*1024?`${(j/(1024*1024)).toFixed(1)} MB`:`${(j/(1024*1024*1024)).toFixed(1)} GB`},Ae=(i,j=0)=>{const k=Number(i);return Number.isFinite(k)?k:j};function Tn({user:i}){const j=pa(),[k,w]=xa(),[c,U]=n.useState(()=>{if(typeof window>"u")return"dashboard";const t=new URLSearchParams(window.location.search).get("tab");return new Set(["dashboard","orders","offers","credit-aging","products","categories","billing","view-bills","purchases","distributors","stock-ledger","users","credit-khata","password-resets","backup-restore"]).has(t)?t:"dashboard"}),[u,R]=n.useState({totalOrders:0,totalRevenue:0,pendingOrders:0}),[N,G]=n.useState([]),[Z,_]=n.useState([]),[D,v]=n.useState([]),[J,M]=n.useState(!0),[C,E]=n.useState(!1),[ae,se]=n.useState(null),[d,A]=n.useState(!1),[W,V]=n.useState(null),[K,y]=n.useState(!1),[ne,te]=n.useState(!1),[Ne,p]=n.useState(null),[P,z]=n.useState(!1),[_e,Ie]=n.useState(null),[f,$]=n.useState([]),[m,S]=n.useState(!1),[F,re]=n.useState([]),[g,X]=n.useState(!1),[ue,H]=n.useState(!1),[xe,Me]=n.useState(!1),[he,Fe]=n.useState({}),[fe,ts]=n.useState(()=>{if(typeof window>"u")return"table";const t=window.localStorage.getItem("admin-products-view");return t==="table"||t==="grid"?t:window.innerWidth<=768?"grid":"table"}),[as,O]=n.useState(!1),[ie,me]=n.useState(!1),[le,oe]=n.useState({name:"",category:"",price:"",stock:"",image:""}),[ns,Be]=n.useState(null),[$e,Re]=n.useState({name:"",category:"",price:"",stock:"",image:""}),[gs,Se]=n.useState(""),[ke,De]=n.useState("created_at"),[Oe,Qe]=n.useState("desc"),[Ke,Le]=n.useState(""),[Ee,Zs]=n.useState("all"),[We,Ls]=n.useState(!1),[cs,_s]=n.useState(null),[bs,Cs]=n.useState(!1),[ce,Is]=n.useState({name:"",description:"",brand:"",content:"",color:"",category:"",sku:"",barcode:"",price:"",mrp:"",uom:"pcs",stock:"",expiry_date:"",defaultDiscount:"",discountType:"fixed",is_active:!0,image:""}),[Ss,os]=n.useState(null),[et,Je]=n.useState(!1),[ws,ks]=n.useState("csv"),[pe,rs]=n.useState(null),[Os,Ds]=n.useState([]),[Ge,vs]=n.useState(!1),ds=n.useRef(null),us={dashboard:"general",orders:"general",offers:"general","credit-aging":"general",products:"products",categories:"products",billing:"billing","view-bills":"billing",purchases:"purchase",distributors:"purchase","stock-ledger":"purchase",users:"users","credit-khata":"users","password-resets":"users","backup-restore":"users"},[ze,zs]=n.useState({general:!0,products:!1,billing:!1,purchase:!1,users:!1}),Xe=async()=>{const[t,l,h,b]=await Promise.all([ut.orders(),be.getAll({include_inactive:!0}),Xs.getAll(),He.getAll()]);R(t),G(l),_(h),v(b)},qs=async t=>{try{S(!0);const l=await Xs.getById(t);Ie(l);const h=l.items||[],b=await Promise.all(h.map(async de=>{try{const ye=await be.getById(de.product_id);return{...de,stock:ye.stock}}catch{return{...de,stock:void 0}}}));$(b),z(!0)}catch(l){Y(l.message||"Failed to load order details","error")}finally{S(!1)}},Us=async()=>{if(_e)try{S(!0),await Xs.updateStatus(_e.id,"confirmed","Approved via admin modal",i.id),z(!1),await Xe(),Y("Order approved and stock applied","success"),await fetch(`/api/notify-order/${_e.id}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"approved"})}).catch(()=>{})}catch(t){Y(t.message||"Failed to approve order","error")}finally{S(!1)}},st=async(t,l)=>{if(window.confirm("Are you sure you want to cancel this order?"))try{await Xs.updateStatus(t,l,`Order ${l} via admin panel`,i.id),await Xe(),Y(`Order ${l} successfully`,"success")}catch(h){console.error("Failed to update order status",h),Y(h.message||"Failed to update order status","error")}};n.useEffect(()=>{if(i){if(i.role!=="admin"){j("/");return}tt()}},[i,j]),n.useEffect(()=>{const t=us[c];t&&zs(l=>({...l,[t]:!0}))},[c]),n.useEffect(()=>{const t=k.get("tab");t&&us[t]&&t!==c&&U(t)},[k]),n.useEffect(()=>{c==="backup-restore"&&ys()},[c]),n.useEffect(()=>{typeof window>"u"||window.localStorage.setItem("admin-products-view",fe)},[fe]);const ms=t=>{zs(l=>({...l,[t]:!l[t]}))},je=t=>{U(t);const l=new URLSearchParams(k);l.set("tab",t),w(l,{replace:!0}),window.innerWidth<=768&&Me(!1)},tt=async()=>{try{M(!0),await Xe()}catch(t){console.error("Error fetching data:",t),Y(t.message||"Failed to load admin dashboard data","error")}finally{M(!1)}},Ms=t=>{const l=String(t||"").trim();return l?l.split(" ").map(h=>h[0]).join("").slice(0,2).toUpperCase():"U"},fs=t=>{if(!t)return"-";const l=new Date(t);return Number.isNaN(l.getTime())?"-":l.toLocaleDateString()},ys=async()=>{try{X(!0);const t=await $s.listBackups();re(Array.isArray(t)?t:[])}catch(t){Y(t.message||"Failed to load backups","error")}finally{X(!1)}},at=async()=>{var t;try{H(!0);const l=await $s.createBackup(),h=((t=l==null?void 0:l.backup)==null?void 0:t.file_name)||"backup";Y(`Backup created: ${h}`,"success"),await ys()}catch(l){Y(l.message||"Failed to create backup","error")}finally{H(!1)}},nt=async t=>{if(!(!t||!window.confirm(`Restore backup "${t}"?

A pre-restore snapshot will be created automatically.`)))try{H(!0);const h=await $s.restoreBackup(t);Y(`Restore complete: ${(h==null?void 0:h.restored_file)||t}. Pre-restore backup: ${(h==null?void 0:h.pre_restore_backup)||"created"}`,"success"),await ys(),await Xe()}catch(h){Y(h.message||"Failed to restore backup","error")}finally{H(!1)}},Bs=async t=>{if(window.confirm("Mark this product as inactive?"))try{await be.delete(t);const l=await be.getAll({include_inactive:!0});G(l),Y("Product marked inactive","success");const h=await ut.orders();R(h)}catch{Y("Failed to delete product","error")}},Qs=async t=>{if(Number((t==null?void 0:t.is_active)??1)===1){Y("Deactivate product before permanent delete","error");return}const l=String((t==null?void 0:t.name)||"").trim();if(window.prompt(`Permanent delete "${l}"? This cannot be undone.
Type DELETE to confirm:`,"")==="DELETE")try{await be.deletePermanent(t.id);const b=await be.getAll({include_inactive:!0});G(b),Y("Product permanently deleted","success")}catch(b){Y(b.message||"Failed to permanently delete product","error")}},Gs=async t=>{if(window.confirm("Are you sure you want to delete this customer?"))try{await He.delete(t),v(l=>l.filter(h=>h.id!==t)),Y("Customer deleted successfully","success")}catch(l){Y(l.message||"Failed to delete customer","error")}},Vs=t=>{se(t),E(!0)},rt=()=>{se(null),E(!0)},hs=async(t={})=>{try{const l=await be.getAll({include_inactive:!0});G(l);const h=await ut.orders();R(h),(t==null?void 0:t.mode)==="create"&&Number(t==null?void 0:t.createdCount)>1?Y(`${t.createdCount} products added successfully`,"success"):(t==null?void 0:t.mode)==="edit"?Y("Product updated successfully","success"):(t==null?void 0:t.mode)==="create"?Y("Product added successfully","success"):Y(ae?"Product updated successfully":"Product added successfully","success")}catch{Y("Failed to refresh products","error")}},Y=(t,l)=>{p({message:t,type:l}),setTimeout(()=>p(null),3e3)},it=()=>{p(null)},Hs=Array.from(new Set(N.map(t=>String(t.category||"").trim()).filter(Boolean))).sort((t,l)=>t.localeCompare(l)),is=n.useMemo(()=>N.filter(t=>Number((t==null?void 0:t.is_active)??1)===1).length,[N]),As=Math.max(0,N.length-is),Ye=n.useMemo(()=>D.filter(t=>String((t==null?void 0:t.role)||"").toLowerCase()!=="admin"),[D]),ps=n.useMemo(()=>D.filter(t=>String((t==null?void 0:t.role)||"").toLowerCase()==="admin"),[D]),s=n.useMemo(()=>Z.filter(t=>String((t==null?void 0:t.status)||"").toLowerCase()==="pending"),[Z]),a=n.useMemo(()=>[...Z].sort((t,l)=>new Date((l==null?void 0:l.created_at)||0).getTime()-new Date((t==null?void 0:t.created_at)||0).getTime()).slice(0,3),[Z]),r=n.useMemo(()=>N.filter(t=>Number((t==null?void 0:t.is_active)??1)===1&&Ae(t==null?void 0:t.stock,0)<=10).sort((t,l)=>Ae(t==null?void 0:t.stock,0)-Ae(l==null?void 0:l.stock,0)).slice(0,3),[N]),o=n.useMemo(()=>[...Ye].sort((t,l)=>new Date((l==null?void 0:l.created_at)||0).getTime()-new Date((t==null?void 0:t.created_at)||0).getTime()).slice(0,3),[Ye]),x=n.useMemo(()=>{const t=String(gs||"").trim().toLowerCase();let l=Array.isArray(N)?[...N]:[];Ke&&(l=l.filter(b=>String(b.category||"").trim()===Ke)),Ee!=="all"&&(l=l.filter(b=>{const de=Number(b.is_active??1)===1;return Ee==="active"?de:!de})),We&&(l=l.filter(b=>Ae(b.stock,0)<=10)),t&&(l=l.filter(b=>[b.id,b.name,b.description,b.brand,b.content,b.color,b.category,b.sku,b.barcode,b.price,b.mrp,b.uom,b.stock,b.expiry_date,b.defaultDiscount,b.discountType,b.is_active].map(ye=>String(ye??"").toLowerCase()).join(" ").includes(t)));const h=b=>{switch(ke){case"id":return Ae(b.id,0);case"name":return String(b.name||"").toLowerCase();case"category":return String(b.category||"").toLowerCase();case"brand":return String(b.brand||"").toLowerCase();case"sku":return String(b.sku||"").toLowerCase();case"barcode":return String(b.barcode||"").toLowerCase();case"price":return Ae(b.price,0);case"mrp":return Ae(b.mrp,0);case"stock":return Ae(b.stock,0);case"defaultDiscount":return Ae(b.defaultDiscount,0);case"is_active":return Number(b.is_active??1);case"created_at":return new Date(b.created_at||0).getTime();case"src":return String(b.image||"").toLowerCase();default:return String(b[ke]??"").toLowerCase()}};return l.sort((b,de)=>{const ye=h(b),Ue=h(de);return ye<Ue?Oe==="asc"?-1:1:ye>Ue?Oe==="asc"?1:-1:0}),l},[N,gs,Ke,Ee,We,ke,Oe]),T=t=>{if(ke===t){Qe(l=>l==="asc"?"desc":"asc");return}De(t),Qe(t==="name"||t==="brand"||t==="category"||t==="sku"?"asc":"desc")},B=t=>ke!==t?"":Oe==="asc"?" ▲":" ▼",I=t=>{_s(t.id),Is({name:t.name||"",description:t.description||"",brand:t.brand||"",content:t.content||"",color:t.color||"",category:t.category||"",sku:t.sku||"",barcode:t.barcode||"",price:String(t.price??""),mrp:String(t.mrp??""),uom:t.uom||"pcs",stock:String(t.stock??0),expiry_date:t.expiry_date?String(t.expiry_date).slice(0,10):"",defaultDiscount:String(t.defaultDiscount??0),discountType:t.discountType||"fixed",is_active:Number(t.is_active??1)===1,image:t.image||""}),Be(null)},q=()=>{_s(null),Cs(!1)},ee=(t,l)=>{Is(h=>({...h,[t]:l}))},ge=async t=>{var h;const l={name:String(ce.name||"").trim(),description:String(ce.description||"").trim(),brand:String(ce.brand||"").trim(),content:String(ce.content||"").trim(),color:String(ce.color||"").trim(),category:String(ce.category||"").trim(),sku:String(ce.sku||"").trim(),barcode:String(ce.barcode||"").trim(),price:Ae(ce.price,0),mrp:Ae(ce.mrp,0),uom:String(ce.uom||"pcs").trim()||"pcs",stock:Ae(ce.stock,0),expiry_date:ce.expiry_date||null,defaultDiscount:Ae(ce.defaultDiscount,0),discountType:ce.discountType==="percentage"?"percentage":"fixed",image:String(ce.image||"").trim(),is_active:Number(t.is_active??1)===0||ce.is_active?1:0,base_unit:t.base_unit||"pcs",uom_type:t.uom_type||"selling",conversion_factor:Ae(t.conversion_factor,1)||1};if(!l.name){Y("Product name is required","error");return}if(!l.category){Y("Category is required","error");return}if(!(l.price>0)){Y("Price must be greater than 0","error");return}if(l.stock<0){Y("Stock must be 0 or more","error");return}try{Cs(!0);try{await be.update(t.id,l)}catch(b){const de=String(((h=b==null?void 0:b.payload)==null?void 0:h.conflict_type)||"");if(Number(b==null?void 0:b.status)===409&&de==="identical"){if(!window.confirm(`${b.message}

Continue anyway?`))return;await be.update(t.id,{...l,allow_identical:!0})}else throw b}await hs({mode:"edit",createdCount:0}),q()}catch(b){Y(b.message||"Failed to update product","error")}finally{Cs(!1)}},ve=()=>{oe({name:"",category:"",price:"",stock:"",image:""})},qe=(t,l={})=>{const h=String(t.name||"").trim(),b=String(t.category||"").trim(),de=String(l.description||"").trim()||`${h} product`,ye=Number(t.price||0),Ue=Number(t.stock||0);return{name:h,description:de,brand:l.brand||"",content:l.content||"",color:l.color||"",price:ye,mrp:Number(l.mrp||0)>0?Number(l.mrp):ye,uom:l.uom||"pcs",base_unit:l.base_unit||"pcs",uom_type:l.uom_type||"selling",conversion_factor:Number(l.conversion_factor||1)||1,barcode:l.barcode||"",sku:l.sku||"",image:String(t.image||"").trim(),stock:Ue,expiry_date:l.expiry_date||null,category:b,defaultDiscount:Number(l.defaultDiscount||0)||0,discountType:l.discountType||"fixed"}},Ze=t=>String(t.name||"").trim()?String(t.category||"").trim()?Number(t.price)>0?Number(t.stock)>=0?!0:(Y("Stock must be 0 or more","error"),!1):(Y("Price must be greater than 0","error"),!1):(Y("Category is required","error"),!1):(Y("Product name is required","error"),!1),Yt=async()=>{var t;if(Ze(le))try{me(!0);const l=qe(le);try{await be.create(l)}catch(h){const b=String(((t=h==null?void 0:h.payload)==null?void 0:t.conflict_type)||"");if(Number(h==null?void 0:h.status)===409&&b==="identical"){if(!window.confirm(`${h.message}

Continue anyway?`))return;await be.create({...l,allow_identical:!0})}else throw h}await hs({mode:"create",createdCount:1}),O(!1),ve()}catch(l){Y(l.message||"Failed to add product","error")}finally{me(!1)}},Zt=t=>{Be(t.id),Re({name:t.name||"",category:t.category||"",price:String(t.price??""),stock:String(t.stock??0),image:t.image||""})},Ct=()=>{Be(null),Re({name:"",category:"",price:"",stock:"",image:""})},ea=async t=>{var l;if(Ze($e))try{me(!0);const h=qe($e,t);try{await be.update(t.id,h)}catch(b){const de=String(((l=b==null?void 0:b.payload)==null?void 0:l.conflict_type)||"");if(Number(b==null?void 0:b.status)===409&&de==="identical"){if(!window.confirm(`${b.message}

Continue anyway?`))return;await be.update(t.id,{...h,allow_identical:!0})}else throw b}await hs({mode:"edit",createdCount:0}),Ct()}catch(h){Y(h.message||"Failed to update product","error")}finally{me(!1)}},sa=t=>new Promise((l,h)=>{const b=new FileReader;b.onload=()=>{const de=String(b.result||""),ye=de.includes(",")?de.split(",")[1]:de;l(ye)},b.onerror=h,b.readAsDataURL(t)}),ta=async(t,l)=>{var St;let h=(i==null?void 0:i.token)||null;if(!h)try{const Ks=localStorage.getItem("user")||"{}";h=((St=JSON.parse(Ks))==null?void 0:St.token)||null}catch{h=null}if(!h)throw new Error("Please login again. Missing auth token.");const b=await fetch(t,{headers:{Authorization:`Bearer ${h}`}});if(!b.ok){const Ks=await b.json().catch(()=>({}));throw new Error(Ks.error||"Download failed")}const de=await b.blob(),ye=URL.createObjectURL(de),Ue=document.createElement("a"),lt=String(b.headers.get("Content-Disposition")||"").match(/filename="?([^"]+)"?/i);Ue.href=ye,Ue.download=(lt==null?void 0:lt[1])||l,document.body.appendChild(Ue),Ue.click(),document.body.removeChild(Ue),URL.revokeObjectURL(ye)},aa=async()=>{const t=ws==="xlsx"?"xlsx":"csv";try{const l=be.getExportUrl(t,!0);await ta(l,`products-export.${t==="xlsx"?"xlsx":"csv"}`),Y("Products exported successfully","success"),Je(!1)}catch(l){Y(l.message||"Failed to export products","error")}},na=()=>{Ge||ds.current&&(ds.current.value="",ds.current.click())},ra=async t=>{var h;const l=((h=t.target.files)==null?void 0:h[0])||null;l&&(os(l),await ia(l))},ia=async(t=null)=>{const l=t||Ss;if(!l){Y("Select a CSV/XLSX file first","error");return}try{vs(!0);const h=await sa(l),b=await be.importPreview({file_name:l.name,file_content_base64:h,mode:"upsert",stock_mode:"replace"});rs(b),Ds([]),Y("Import preview generated. Review and confirm.","success")}catch(h){rs(null),Y(h.message||"Failed to preview import","error")}finally{vs(!1)}},la=async()=>{if(!(pe!=null&&pe.batch_id)||!(pe!=null&&pe.checksum)){Y("Generate preview before confirming import","error");return}try{vs(!0);const t=await be.importConfirm({batch_id:pe.batch_id,checksum:pe.checksum,allow_identical_rows:Os});await hs({mode:"create"}),rs(null),os(null),Ds([]),Y(`Import applied. Created: ${t.created}, Updated: ${t.updated}`,"success")}catch(t){Y(t.message||"Failed to confirm import","error")}finally{vs(!1)}},ca=t=>{V(t)},oa=async()=>{try{const t=await He.getAll();v(t),Y("User updated successfully","success")}catch{Y("Failed to refresh users","error")}},da=()=>{V(null),te(!0),y(!0)},ua=async()=>{try{const t=await He.getAll();v(t),Y("User created successfully","success")}catch{Y("Failed to refresh users","error")}};return!i||i.role!=="admin"?e.jsx("div",{className:"admin-page",children:e.jsxs("div",{className:"admin-container",children:[e.jsx("h1",{children:"Access Denied"}),e.jsx("p",{children:"You must be an admin to access this page."}),e.jsx(Js,{to:"/login",className:"admin-btn",children:"Go to Login"})]})}):J?e.jsx("div",{className:"admin-page",children:e.jsx("div",{className:"admin-content",children:e.jsxs("div",{className:"admin-loading-state",children:[e.jsx("h2",{children:"Loading admin dashboard..."}),e.jsx("p",{children:"Fetching orders, products, users and summary stats."})]})})}):e.jsxs("div",{className:"admin-page",children:[Ne&&e.jsxs("div",{className:`notification ${Ne.type}`,children:[e.jsx("span",{children:Ne.message}),e.jsx("button",{onClick:it,children:e.jsx(we,{size:16})})]}),e.jsxs("div",{className:"admin-mobile-topbar",children:[e.jsx("button",{type:"button",className:"admin-mobile-menu-btn",onClick:()=>Me(t=>!t),"aria-label":"Toggle admin menu",children:xe?e.jsx(we,{size:20}):e.jsx(ja,{size:20})}),e.jsx("h2",{children:"Admin Panel"})]}),xe&&e.jsx("button",{type:"button",className:"admin-sidebar-overlay","aria-label":"Close admin menu",onClick:()=>Me(!1)}),e.jsxs("div",{className:`admin-sidebar ${xe?"open":""}`,children:[e.jsx("h2",{children:"Admin Panel"}),e.jsxs("nav",{children:[e.jsxs("div",{className:"sidebar-group",children:[e.jsx("button",{type:"button",className:`sidebar-group-toggle ${ze.general?"expanded":""}`,"data-label":"General",onClick:()=>ms("general"),children:e.jsx(xt,{size:20})}),ze.general&&e.jsxs("div",{className:"sidebar-group-items",children:[e.jsxs("button",{className:c==="dashboard"?"active":"",onClick:()=>je("dashboard"),children:[e.jsx(xt,{size:20})," Dashboard"]}),e.jsxs("button",{className:c==="orders"?"active":"",onClick:()=>je("orders"),children:[e.jsx(kt,{size:20})," Orders"]}),e.jsxs("button",{className:c==="offers"?"active":"",onClick:()=>je("offers"),children:[e.jsx(Oa,{size:20})," Offers"]}),e.jsxs("button",{className:c==="credit-aging"?"active":"",onClick:()=>je("credit-aging"),children:[e.jsx(Ra,{size:20})," Credit Aging"]})]})]}),e.jsxs("div",{className:"sidebar-group",children:[e.jsx("button",{type:"button",className:`sidebar-group-toggle ${ze.products?"expanded":""}`,"data-label":"Products",onClick:()=>ms("products"),children:e.jsx(js,{size:20})}),ze.products&&e.jsxs("div",{className:"sidebar-group-items",children:[e.jsxs("button",{className:c==="products"?"active":"",onClick:()=>je("products"),children:[e.jsx(js,{size:20})," Products"]}),e.jsxs("button",{className:`${c==="categories"?"active":""} sub-item`,onClick:()=>je("categories"),children:[e.jsx(pt,{size:18})," Categories"]})]})]}),e.jsxs("div",{className:"sidebar-group",children:[e.jsx("button",{type:"button",className:`sidebar-group-toggle ${ze.billing?"expanded":""}`,"data-label":"Billing",onClick:()=>ms("billing"),children:e.jsx(Tt,{size:20})}),ze.billing&&e.jsxs("div",{className:"sidebar-group-items",children:[e.jsxs("button",{className:c==="billing"?"active":"",onClick:()=>je("billing"),children:[e.jsx(Tt,{size:20})," Billing"]}),e.jsxs("button",{className:`${c==="view-bills"?"active":""} sub-item`,onClick:()=>je("view-bills"),children:[e.jsx(Qt,{size:18})," Bills History"]})]})]}),e.jsxs("div",{className:"sidebar-group",children:[e.jsx("button",{type:"button",className:`sidebar-group-toggle ${ze.purchase?"expanded":""}`,"data-label":"Purchase",onClick:()=>ms("purchase"),children:e.jsx(Ft,{size:20})}),ze.purchase&&e.jsxs("div",{className:"sidebar-group-items",children:[e.jsxs("button",{className:c==="purchases"?"active":"",onClick:()=>je("purchases"),children:[e.jsx(Ft,{size:20})," Purchases"]}),e.jsxs("button",{className:`${c==="distributors"?"active":""} sub-item`,onClick:()=>je("distributors"),children:[e.jsx(Ea,{size:18})," Distributors"]}),e.jsxs("button",{className:`${c==="stock-ledger"?"active":""} sub-item`,onClick:()=>je("stock-ledger"),children:[e.jsx(Rt,{size:18})," Stock History"]})]})]}),e.jsxs("div",{className:"sidebar-group",children:[e.jsx("button",{type:"button",className:`sidebar-group-toggle ${ze.users?"expanded":""}`,"data-label":"Users",onClick:()=>ms("users"),children:e.jsx(jt,{size:20})}),ze.users&&e.jsxs("div",{className:"sidebar-group-items",children:[e.jsxs("button",{className:c==="users"?"active":"",onClick:()=>je("users"),children:[e.jsx(jt,{size:20})," Users"]}),e.jsxs("button",{className:`${c==="credit-khata"?"active":""} sub-item`,onClick:()=>je("credit-khata"),children:[e.jsx(dt,{size:18})," Credit Khata"]}),e.jsxs("button",{className:`${c==="password-resets"?"active":""} sub-item`,onClick:()=>je("password-resets"),children:[e.jsx(za,{size:18})," Password Resets"]}),e.jsxs("button",{className:`${c==="backup-restore"?"active":""} sub-item`,onClick:()=>je("backup-restore"),children:[e.jsx(Rt,{size:18})," Backup & Restore"]})]})]}),e.jsx(Js,{to:"/",className:"logout-link",children:e.jsx(ga,{size:20})})]})]}),e.jsxs("div",{className:"admin-content",children:[c==="dashboard"&&e.jsxs("div",{className:"dashboard",children:[e.jsx("h1",{children:"Dashboard"}),e.jsxs("div",{className:"stats-grid",children:[e.jsxs("div",{className:"stat-card",children:[e.jsx(kt,{size:40}),e.jsxs("div",{children:[e.jsx("h3",{children:u.totalOrders}),e.jsx("p",{children:"Total Orders"})]})]}),e.jsxs("div",{className:"stat-card",children:[e.jsx(xt,{size:40}),e.jsxs("div",{children:[e.jsx("h3",{children:Ps(u.totalRevenue)}),e.jsx("p",{children:"Total Revenue"})]})]}),e.jsxs("div",{className:"stat-card",children:[e.jsx(js,{size:40}),e.jsxs("div",{children:[e.jsx("h3",{children:is}),e.jsxs("p",{children:["Active Products (",As," inactive)"]})]})]}),e.jsxs("div",{className:"stat-card",children:[e.jsx(jt,{size:40}),e.jsxs("div",{children:[e.jsx("h3",{children:Ye.length}),e.jsx("p",{children:"Customers"})]})]}),e.jsxs("div",{className:"stat-card",children:[e.jsx(Vt,{size:40}),e.jsxs("div",{children:[e.jsx("h3",{children:s.length}),e.jsx("p",{children:"Pending Orders"})]})]})]}),e.jsxs("div",{className:"dashboard-panels",children:[e.jsxs("div",{className:"dashboard-panel",children:[e.jsx("div",{className:"dashboard-panel-head",children:e.jsx("h3",{children:"Quick Actions"})}),e.jsxs("div",{className:"dashboard-actions",children:[e.jsx("button",{className:"admin-btn",onClick:()=>je("orders"),children:"Manage Orders"}),e.jsx("button",{className:"admin-btn",onClick:()=>je("products"),children:"Manage Products"}),e.jsx("button",{className:"admin-btn",onClick:()=>je("billing"),children:"Create Bill"}),e.jsx("button",{className:"admin-btn",onClick:()=>je("credit-khata"),children:"Credit Khata"}),e.jsx("button",{className:"admin-btn",onClick:()=>je("purchases"),children:"Purchases"}),e.jsx("button",{className:"admin-btn",onClick:()=>je("backup-restore"),children:"Backup & Restore"})]})]}),e.jsxs("div",{className:"dashboard-panel",children:[e.jsxs("div",{className:"dashboard-panel-head",children:[e.jsx("h3",{children:"Low Stock (≤ 10)"}),e.jsx("button",{className:"admin-btn",onClick:()=>je("products"),children:"Open Products"})]}),r.length===0?e.jsx("p",{className:"dashboard-empty",children:"No low stock products."}):e.jsx("div",{className:"dashboard-list",children:r.map(t=>e.jsxs("div",{className:"dashboard-list-row",children:[e.jsx("span",{children:t.name}),e.jsx("strong",{children:Ae(t.stock,0)})]},t.id))})]}),e.jsxs("div",{className:"dashboard-panel",children:[e.jsxs("div",{className:"dashboard-panel-head",children:[e.jsx("h3",{children:"Recent Orders"}),e.jsx("button",{className:"admin-btn",onClick:()=>je("orders"),children:"View All"})]}),a.length===0?e.jsx("p",{className:"dashboard-empty",children:"No orders yet."}):e.jsx("div",{className:"dashboard-list",children:a.map(t=>e.jsxs("div",{className:"dashboard-list-row",children:[e.jsx("span",{children:t.order_number||`#${t.id}`}),e.jsx("span",{children:new Date(t.created_at||Date.now()).toLocaleDateString()}),e.jsx("span",{children:Q(t.total_amount||0)})]},t.id))})]}),e.jsxs("div",{className:"dashboard-panel",children:[e.jsxs("div",{className:"dashboard-panel-head",children:[e.jsx("h3",{children:"Recent Customers"}),e.jsx("button",{className:"admin-btn",onClick:()=>je("users"),children:"Open Users"})]}),o.length===0?e.jsx("p",{className:"dashboard-empty",children:"No customers found."}):e.jsx("div",{className:"dashboard-list",children:o.map(t=>e.jsxs("div",{className:"dashboard-list-row",children:[e.jsx("span",{children:t.name||"-"}),e.jsx("span",{children:t.phone||t.email||"-"}),e.jsx(Js,{className:"action-btn credit",to:`/admin/users/${t.id}/credit?returnTab=dashboard`,title:"Open credit history",children:e.jsx(dt,{size:14})})]},t.id))})]})]})]}),c==="products"&&e.jsxs("div",{className:"products-management",children:[e.jsxs("div",{className:"section-header",children:[e.jsx("h1",{children:"Products Management"}),e.jsxs("div",{className:"products-actions",children:[e.jsxs("div",{className:"view-toggle",children:[e.jsx("button",{className:`admin-btn ${fe==="table"?"primary":""}`,onClick:()=>ts("table"),children:"Table"}),e.jsx("button",{className:`admin-btn ${fe==="grid"?"primary":""}`,onClick:()=>ts("grid"),children:"Grid"})]}),e.jsxs("button",{className:"admin-btn primary",onClick:rt,children:[e.jsx(Pe,{size:20})," Add Product"]}),e.jsxs("div",{className:"products-io-icons",children:[e.jsx("button",{type:"button",className:"products-icon-btn",onClick:()=>Je(!0),disabled:Ge,title:"Export products","aria-label":"Export products",children:e.jsx(Gt,{size:16})}),e.jsx("button",{type:"button",className:"products-icon-btn",onClick:na,disabled:Ge,title:"Import products","aria-label":"Import products",children:e.jsx(Fa,{size:16})}),e.jsx("button",{type:"button",className:"products-icon-btn",onClick:la,disabled:Ge||!(pe!=null&&pe.batch_id),title:"Confirm import","aria-label":"Confirm import",children:e.jsx(La,{size:16})})]})]})]}),e.jsxs("div",{className:"products-import-export-card",children:[e.jsxs("div",{className:"products-import-controls",children:[e.jsx("input",{ref:ds,type:"file",accept:".csv,.xlsx,.xls",onChange:ra,disabled:Ge,style:{display:"none"}}),e.jsx("span",{children:Ss?`Selected: ${Ss.name}`:"No file selected"})]}),(pe==null?void 0:pe.summary)&&e.jsxs("div",{className:"products-import-preview-summary",children:[e.jsxs("span",{children:["Creates: ",pe.summary.creates]}),e.jsxs("span",{children:["Updates: ",pe.summary.updates]}),e.jsxs("span",{children:["Errors: ",pe.summary.errors]}),e.jsxs("span",{children:["Needs Choice: ",pe.summary.needs_confirmation||0]}),e.jsxs("span",{children:["Expires: ",new Date(pe.expires_at).toLocaleString()]})]}),Array.isArray(pe==null?void 0:pe.preview)&&pe.preview.length>0&&e.jsxs("div",{className:"products-import-preview-table-wrap",children:[e.jsxs("table",{className:"products-import-preview-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Row"}),e.jsx("th",{children:"Action"}),e.jsx("th",{children:"Status"}),e.jsx("th",{children:"Allow"}),e.jsx("th",{children:"Details"})]})}),e.jsx("tbody",{children:pe.preview.slice(0,25).map(t=>{var l,h;return e.jsxs("tr",{children:[e.jsx("td",{children:t.row}),e.jsx("td",{children:t.action}),e.jsx("td",{children:t.status}),e.jsx("td",{children:t.status==="needs_confirmation"?e.jsx("input",{type:"checkbox",checked:Os.includes(Number(t.row)),onChange:b=>{const de=Number(t.row);Ds(ye=>b.target.checked?Array.from(new Set([...ye,de])):ye.filter(Ue=>Ue!==de))}}):"-"}),e.jsx("td",{children:(l=t.errors)!=null&&l.length?t.errors.join("; "):(h=t.warnings)!=null&&h.length?t.warnings.join("; "):"Ready"})]},`preview-${t.row}`)})})]}),pe.preview.length>25&&e.jsxs("p",{className:"products-import-preview-note",children:["Showing first 25 rows of ",pe.preview.length,". Confirm applies full validated batch."]})]})]}),fe==="table"?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"products-table-toolbar",children:[e.jsx("input",{type:"text",className:"products-table-search",placeholder:"Search by name, SKU, barcode, category, brand...",value:gs,onChange:t=>Se(t.target.value)}),e.jsxs("select",{className:"products-table-filter",value:Ke,onChange:t=>Le(t.target.value),children:[e.jsx("option",{value:"",children:"All Categories"}),Hs.map(t=>e.jsx("option",{value:t,children:t},`filter-${t}`))]}),e.jsxs("select",{className:"products-table-filter",value:Ee,onChange:t=>Zs(t.target.value),children:[e.jsx("option",{value:"all",children:"All Status"}),e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"inactive",children:"Inactive"})]}),e.jsxs("label",{className:"products-table-filter products-table-checkbox",children:[e.jsx("input",{type:"checkbox",checked:We,onChange:t=>Ls(t.target.checked)}),"Low Stock"]}),e.jsxs("span",{className:"products-table-count",children:["Rows: ",x.length]})]}),e.jsx("div",{className:"products-table",children:e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsxs("th",{className:"sortable",onClick:()=>T("name"),children:["Name",B("name")]}),e.jsxs("th",{className:"sortable",onClick:()=>T("brand"),children:["Brand",B("brand")]}),e.jsxs("th",{className:"sortable",onClick:()=>T("category"),children:["Category",B("category")]}),e.jsxs("th",{className:"sortable",onClick:()=>T("price"),children:["Price",B("price")]}),e.jsxs("th",{className:"sortable",onClick:()=>T("mrp"),children:["MRP",B("mrp")]}),e.jsxs("th",{className:"sortable",onClick:()=>T("stock"),children:["Stock",B("stock")]}),e.jsxs("th",{className:"sortable",onClick:()=>T("sku"),children:["SKU",B("sku")]}),e.jsxs("th",{className:"sortable",onClick:()=>T("barcode"),children:["Barcode",B("barcode")]}),e.jsxs("th",{className:"sortable",onClick:()=>T("is_active"),children:["Status",B("is_active")]}),e.jsx("th",{children:"Description"}),e.jsx("th",{children:"Content"}),e.jsx("th",{children:"Color"}),e.jsx("th",{children:"UOM"}),e.jsx("th",{children:"Expiry"}),e.jsxs("th",{className:"sortable",onClick:()=>T("defaultDiscount"),children:["Discount",B("defaultDiscount")]}),e.jsx("th",{children:"Disc Type"}),e.jsxs("th",{className:"sortable",onClick:()=>T("id"),children:["ID",B("id")]}),e.jsxs("th",{className:"sortable",onClick:()=>T("created_at"),children:["Created",B("created_at")]}),e.jsxs("th",{className:"sortable",onClick:()=>T("src"),children:["Src",B("src")]}),e.jsx("th",{children:"Actions"})]})}),e.jsx("tbody",{children:x.map(t=>{const l=cs===t.id;return e.jsxs("tr",{children:[e.jsx("td",{children:l?e.jsx("input",{className:"table-edit-input",value:ce.name,onChange:h=>ee("name",h.target.value)}):t.name}),e.jsx("td",{children:l?e.jsx("input",{className:"table-edit-input",value:ce.brand,onChange:h=>ee("brand",h.target.value)}):t.brand||"-"}),e.jsx("td",{children:l?e.jsx("input",{className:"table-edit-input",list:"admin-product-category-list",value:ce.category,onChange:h=>ee("category",h.target.value)}):t.category}),e.jsx("td",{children:l?e.jsx("input",{className:"table-edit-input",type:"number",min:"0",step:"0.01",value:ce.price,onChange:h=>ee("price",h.target.value)}):Ps(t.price)}),e.jsx("td",{children:l?e.jsx("input",{className:"table-edit-input",type:"number",min:"0",step:"0.01",value:ce.mrp,onChange:h=>ee("mrp",h.target.value)}):Ps(t.mrp)}),e.jsx("td",{children:l?e.jsx("input",{className:"table-edit-input",type:"number",min:"0",step:"1",value:ce.stock,onChange:h=>ee("stock",h.target.value)}):e.jsx("span",{className:t.stock<10?"low-stock":"",children:t.stock})}),e.jsx("td",{children:l?e.jsx("input",{className:"table-edit-input",value:ce.sku,onChange:h=>ee("sku",h.target.value)}):t.sku||"-"}),e.jsx("td",{children:l?e.jsx("input",{className:"table-edit-input",value:ce.barcode,onChange:h=>ee("barcode",h.target.value)}):t.barcode||"-"}),e.jsx("td",{children:l?e.jsxs("select",{className:"table-edit-input",value:ce.is_active?"1":"0",onChange:h=>ee("is_active",h.target.value==="1"),children:[e.jsx("option",{value:"1",children:"Active"}),e.jsx("option",{value:"0",children:"Inactive"})]}):Number(t.is_active??1)===1?"Active":"Inactive"}),e.jsx("td",{children:l?e.jsx("input",{className:"table-edit-input",value:ce.description,onChange:h=>ee("description",h.target.value)}):e.jsx("span",{className:"description-snippet",title:t.description||"-",children:t.description||"-"})}),e.jsx("td",{children:l?e.jsx("input",{className:"table-edit-input",value:ce.content,onChange:h=>ee("content",h.target.value)}):t.content||"-"}),e.jsx("td",{children:l?e.jsx("input",{className:"table-edit-input",value:ce.color,onChange:h=>ee("color",h.target.value)}):t.color||"-"}),e.jsx("td",{children:l?e.jsx("input",{className:"table-edit-input",value:ce.uom,onChange:h=>ee("uom",h.target.value)}):t.uom||"-"}),e.jsx("td",{children:l?e.jsx("input",{className:"table-edit-input",type:"date",value:ce.expiry_date,onChange:h=>ee("expiry_date",h.target.value)}):t.expiry_date?new Date(t.expiry_date).toLocaleDateString():"-"}),e.jsx("td",{children:l?e.jsx("input",{className:"table-edit-input",type:"number",min:"0",step:"0.01",value:ce.defaultDiscount,onChange:h=>ee("defaultDiscount",h.target.value)}):Ae(t.defaultDiscount,0)}),e.jsx("td",{children:l?e.jsxs("select",{className:"table-edit-input",value:ce.discountType,onChange:h=>ee("discountType",h.target.value),children:[e.jsx("option",{value:"fixed",children:"fixed"}),e.jsx("option",{value:"percentage",children:"percentage"})]}):t.discountType||"fixed"}),e.jsx("td",{children:t.id}),e.jsx("td",{children:t.created_at?new Date(t.created_at).toLocaleDateString():"-"}),e.jsx("td",{children:l?e.jsx("input",{className:"table-edit-input",value:ce.image,onChange:h=>ee("image",h.target.value)}):e.jsx("span",{className:"src-cell",title:t.image||"-",children:t.image||"-"})}),e.jsx("td",{children:l?e.jsxs("div",{className:"table-edit-actions",children:[e.jsx("button",{className:"action-btn edit",onClick:()=>ge(t),disabled:bs,children:bs?"...":"Save"}),e.jsx("button",{className:"action-btn delete",onClick:q,disabled:bs,children:"Cancel"})]}):e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"action-btn edit",onClick:()=>I(t),title:"Inline edit",children:e.jsx(Rs,{size:16})}),e.jsx("button",{className:"action-btn edit",onClick:()=>Vs(t),title:"Advanced edit",children:e.jsx(pt,{size:16})}),e.jsx("button",{className:"action-btn delete",onClick:()=>Bs(t.id),children:e.jsx(ss,{size:16})}),Number(t.is_active??1)===0&&e.jsx("button",{className:"action-btn delete",title:"Permanent delete",onClick:()=>Qs(t),children:e.jsx(we,{size:16})})]})})]},t.id)})})]})})]}):e.jsxs("div",{className:"products-grid-admin",children:[e.jsx("div",{className:"product-admin-card add-product-card",children:as?e.jsxs("div",{className:"quick-form",children:[e.jsx("h3",{children:"Quick Add"}),e.jsx("input",{type:"text",placeholder:"Product name",value:le.name,onChange:t=>oe(l=>({...l,name:t.target.value}))}),e.jsx("input",{type:"text",list:"admin-product-category-list",placeholder:"Category",value:le.category,onChange:t=>oe(l=>({...l,category:t.target.value}))}),e.jsx("input",{type:"number",placeholder:"Price",min:"0",step:"0.01",value:le.price,onChange:t=>oe(l=>({...l,price:t.target.value}))}),e.jsx("input",{type:"number",placeholder:"Stock",min:"0",step:"1",value:le.stock,onChange:t=>oe(l=>({...l,stock:t.target.value}))}),e.jsx("input",{type:"text",placeholder:"Image URL (optional)",value:le.image,onChange:t=>oe(l=>({...l,image:t.target.value}))}),e.jsxs("div",{className:"quick-form-actions",children:[e.jsx("button",{className:"admin-btn",onClick:()=>{O(!1),ve()},disabled:ie,children:"Cancel"}),e.jsx("button",{className:"admin-btn primary",onClick:Yt,disabled:ie,children:ie?"Saving...":"Save"})]})]}):e.jsxs("button",{className:"quick-add-trigger",onClick:()=>O(!0),children:[e.jsx(Pe,{size:18})," Quick Add Product"]})}),x.map(t=>{const l=ns===t.id,h=l?{image:$e.image,name:$e.name||t.name,category:$e.category||t.category,brand:t.brand}:t;return e.jsxs("div",{className:"product-admin-card",children:[e.jsx("img",{src:ft(h),alt:t.name,className:"product-thumbnail-large",onError:b=>{b.currentTarget.onerror=null,b.currentTarget.src=ba(h)}}),l?e.jsxs("div",{className:"quick-form",children:[e.jsx("input",{type:"text",placeholder:"Product name",value:$e.name,onChange:b=>Re(de=>({...de,name:b.target.value}))}),e.jsx("input",{type:"text",list:"admin-product-category-list",placeholder:"Category",value:$e.category,onChange:b=>Re(de=>({...de,category:b.target.value}))}),e.jsx("input",{type:"number",placeholder:"Price",min:"0",step:"0.01",value:$e.price,onChange:b=>Re(de=>({...de,price:b.target.value}))}),e.jsx("input",{type:"number",placeholder:"Stock",min:"0",step:"1",value:$e.stock,onChange:b=>Re(de=>({...de,stock:b.target.value}))}),e.jsx("input",{type:"text",placeholder:"Image URL (optional)",value:$e.image,onChange:b=>Re(de=>({...de,image:b.target.value}))}),e.jsxs("div",{className:"quick-form-actions",children:[e.jsx("button",{className:"admin-btn",onClick:Ct,disabled:ie,children:"Cancel"}),e.jsx("button",{className:"admin-btn primary",onClick:()=>ea(t),disabled:ie,children:ie?"Saving...":"Update"})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("h3",{children:t.name}),e.jsx("p",{className:"product-meta",children:t.category}),e.jsx("p",{className:"product-meta",children:Ps(t.price)}),e.jsxs("p",{className:t.stock<10?"product-stock-label low-stock":"product-stock-label",children:["Stock: ",t.stock]}),e.jsxs("div",{className:"product-card-actions",children:[e.jsx("button",{className:"action-btn edit",onClick:()=>Zt(t),title:"Quick edit",children:e.jsx(Rs,{size:16})}),e.jsx("button",{className:"action-btn edit",onClick:()=>Vs(t),title:"Advanced edit",children:e.jsx(pt,{size:16})}),e.jsx("button",{className:"action-btn delete",onClick:()=>Bs(t.id),title:"Delete",children:e.jsx(ss,{size:16})})]})]})]},t.id)}),e.jsx("datalist",{id:"admin-product-category-list",children:Hs.map(t=>e.jsx("option",{value:t},t))})]})]}),c==="orders"&&e.jsxs("div",{className:"orders-management",children:[e.jsx("h1",{children:"Orders Management"}),e.jsx("div",{className:"orders-table",children:e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"ID"}),e.jsx("th",{children:"Customer"}),e.jsx("th",{children:"Email"}),e.jsx("th",{children:"Amount"}),e.jsx("th",{children:"Status"}),e.jsx("th",{children:"Actions"}),e.jsx("th",{children:"Date"})]})}),e.jsx("tbody",{children:Z.map(t=>e.jsxs("tr",{children:[e.jsx("td",{children:t.id}),e.jsx("td",{children:t.customer_name}),e.jsx("td",{children:t.customer_email}),e.jsx("td",{children:Ps(t.total_amount)}),e.jsx("td",{children:e.jsx("span",{className:`status ${t.status}`,children:t.status})}),e.jsx("td",{children:t.status==="pending"?e.jsxs("div",{style:{display:"flex",gap:"0.5rem"},children:[e.jsx("button",{className:"admin-btn",onClick:()=>qs(t.id),children:"Approve"}),e.jsx("button",{className:"admin-btn",onClick:()=>st(t.id,"cancelled"),children:"Cancel"})]}):e.jsx("span",{style:{opacity:.8},children:"—"})}),e.jsx("td",{children:new Date(t.created_at).toLocaleDateString()})]},t.id))})]})})]}),c==="categories"&&e.jsxs("div",{className:"categories-management",children:[e.jsxs("div",{className:"section-header",children:[e.jsx("h1",{children:"Categories Management"}),e.jsxs("button",{className:"admin-btn primary",onClick:()=>A(!0),children:[e.jsx(Pe,{size:20})," Manage Categories"]})]}),e.jsx("div",{className:"categories-info",children:e.jsx("p",{children:'Click "Manage Categories" to create, edit, or delete product categories.'})})]}),c==="users"&&e.jsxs("div",{className:"users-management",children:[e.jsxs("div",{className:"section-header",children:[e.jsx("h1",{children:"Users Management"}),e.jsxs("button",{className:"admin-btn primary",onClick:da,children:[e.jsx(Pe,{size:20})," Add Customer"]})]}),e.jsxs("div",{className:"users-group",children:[e.jsxs("h2",{children:["Admins (",ps.length,")"]}),e.jsx("div",{className:"users-table",children:e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"User"}),e.jsx("th",{children:"Email"}),e.jsx("th",{children:"Phone"})]})}),e.jsx("tbody",{children:ps.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:"3",children:"No admins found."})}):ps.map(t=>e.jsxs("tr",{children:[e.jsx("td",{children:e.jsxs("div",{className:"admin-user-cell",children:[e.jsxs("div",{className:"admin-user-name-cell",children:[t.profile_image&&!he[t.id]?e.jsx("img",{src:Dt(t.profile_image),alt:t.name||"User",className:"admin-user-avatar",onError:()=>Fe(l=>({...l,[t.id]:!0}))}):e.jsx("span",{className:"admin-user-avatar-fallback",children:Ms(t.name)}),e.jsx("span",{children:t.name||"-"})]}),e.jsxs("div",{className:"admin-user-meta-row",children:[e.jsxs("span",{className:"admin-user-joined",children:["Joined: ",fs(t.created_at)]}),e.jsx("div",{className:"admin-user-actions",children:e.jsx("span",{className:"admin-badge",children:"Admin"})})]})]})}),e.jsx("td",{children:t.email||"-"}),e.jsx("td",{children:t.phone||"-"})]},t.id))})]})})]}),e.jsxs("div",{className:"users-group",children:[e.jsxs("h2",{children:["Customers (",Ye.length,")"]}),e.jsx("div",{className:"users-table",children:e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"User"}),e.jsx("th",{children:"Email"}),e.jsx("th",{children:"Phone"})]})}),e.jsx("tbody",{children:Ye.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:"3",children:"No customers found."})}):Ye.map(t=>e.jsxs("tr",{children:[e.jsx("td",{children:e.jsxs("div",{className:"admin-user-cell",children:[e.jsxs("div",{className:"admin-user-name-cell",children:[t.profile_image&&!he[t.id]?e.jsx("img",{src:Dt(t.profile_image),alt:t.name||"User",className:"admin-user-avatar",onError:()=>Fe(l=>({...l,[t.id]:!0}))}):e.jsx("span",{className:"admin-user-avatar-fallback",children:Ms(t.name)}),e.jsx("span",{children:t.name||"-"})]}),e.jsxs("div",{className:"admin-user-meta-row",children:[e.jsxs("span",{className:"admin-user-joined",children:["Joined: ",fs(t.created_at)]}),e.jsxs("div",{className:"admin-user-actions",children:[e.jsx(Js,{to:`/admin/users/${t.id}/credit?returnTab=users`,className:"action-btn credit",title:"Credit History",children:e.jsx(dt,{size:16})}),e.jsx("button",{className:"action-btn edit",onClick:()=>ca(t),title:"Edit user",children:e.jsx(Rs,{size:16})}),e.jsx("button",{className:"action-btn delete",onClick:()=>Gs(t.id),title:"Delete user",children:e.jsx(ss,{size:16})})]})]})]})}),e.jsx("td",{children:t.email||"-"}),e.jsx("td",{children:t.phone||"-"})]},t.id))})]})})]})]}),c==="backup-restore"&&e.jsxs("div",{className:"users-management",children:[e.jsxs("div",{className:"section-header",children:[e.jsx("h1",{children:"Backup & Restore"}),e.jsxs("div",{style:{display:"flex",gap:"0.5rem"},children:[e.jsx("button",{className:"admin-btn",onClick:ys,disabled:g||ue,children:"Refresh"}),e.jsxs("button",{className:"admin-btn primary",onClick:at,disabled:ue,children:[e.jsx(Pe,{size:20})," Create Backup"]})]})]}),e.jsx("div",{className:"categories-info",children:e.jsx("p",{children:"Restoring data will replace the current database. A pre-restore backup is created automatically."})}),e.jsx("div",{className:"users-table",children:e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"File"}),e.jsx("th",{children:"Created"}),e.jsx("th",{children:"Size"}),e.jsx("th",{children:"Actions"})]})}),e.jsx("tbody",{children:g?e.jsx("tr",{children:e.jsx("td",{colSpan:"4",children:"Loading backups..."})}):F.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:"4",children:"No backups found"})}):F.map(t=>e.jsxs("tr",{children:[e.jsx("td",{children:t.file_name}),e.jsx("td",{children:t.created_at?new Date(t.created_at).toLocaleString():"-"}),e.jsx("td",{children:cn(t.size_bytes)}),e.jsx("td",{children:e.jsxs("div",{style:{display:"flex",gap:"0.5rem"},children:[e.jsx("a",{className:"admin-btn",href:`/api/admin/backup/download/${encodeURIComponent(t.file_name)}`,target:"_blank",rel:"noreferrer",children:"Download"}),e.jsx("button",{className:"admin-btn",onClick:()=>nt(t.file_name),disabled:ue,children:"Restore"})]})})]},t.file_name))})]})})]}),c==="billing"&&e.jsx(en,{}),c==="view-bills"&&e.jsx(sn,{}),c==="distributors"&&e.jsx(Ja,{user:i}),c==="purchases"&&e.jsx(Xa,{user:i}),c==="stock-ledger"&&e.jsx(Ya,{user:i}),c==="credit-aging"&&e.jsx(Za,{user:i}),c==="credit-khata"&&e.jsx(ln,{user:i}),c==="offers"&&e.jsx(tn,{}),c==="password-resets"&&e.jsx(an,{})]}),C&&e.jsx(Ka,{product:ae,onClose:()=>{E(!1),se(null)},onSave:hs}),P&&_e&&e.jsx("div",{className:"modal-backdrop",children:e.jsxs("div",{className:"modal-card",children:[e.jsxs("h2",{children:["Approve Order ",_e.order_number||`#${_e.id}`]}),m?e.jsx("p",{children:"Loading..."}):e.jsxs(e.Fragment,{children:[e.jsxs("p",{children:["Customer: ",_e.customer_name," (",_e.customer_email,")"]}),e.jsx("div",{style:{maxHeight:300,overflow:"auto",marginTop:8},children:e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Product"}),e.jsx("th",{children:"Qty"}),e.jsx("th",{children:"Stock"})]})}),e.jsx("tbody",{children:f.map(t=>e.jsxs("tr",{children:[e.jsx("td",{style:{padding:6},children:t.product_name||t.name}),e.jsx("td",{style:{padding:6},children:t.quantity}),e.jsx("td",{style:{padding:6},children:t.stock!==void 0?t.stock:"—"})]},t.id))})]})}),e.jsxs("div",{style:{display:"flex",gap:8,marginTop:12,justifyContent:"flex-end"},children:[e.jsx("button",{className:"admin-btn",onClick:()=>z(!1),disabled:m,children:"Close"}),e.jsx("button",{className:"admin-btn primary",onClick:Us,disabled:m,children:"Confirm Approve"})]})]})]})}),et&&e.jsx("div",{className:"modal-backdrop",children:e.jsxs("div",{className:"modal-card export-modal-card",children:[e.jsx("h2",{children:"Export Products"}),e.jsx("p",{children:"Select format, then confirm export."}),e.jsxs("div",{className:"export-format-toggle-group",children:[e.jsx("button",{className:`admin-btn ${ws==="csv"?"primary":""}`,onClick:()=>ks("csv"),disabled:Ge,children:"CSV (.csv)"}),e.jsx("button",{className:`admin-btn ${ws==="xlsx"?"primary":""}`,onClick:()=>ks("xlsx"),disabled:Ge,children:"Excel (.xlsx)"})]}),e.jsxs("div",{style:{display:"flex",gap:8,marginTop:12,justifyContent:"flex-end"},children:[e.jsx("button",{className:"admin-btn",onClick:()=>Je(!1),disabled:Ge,children:"Cancel"}),e.jsx("button",{className:"admin-btn primary",onClick:aa,disabled:Ge,children:"Confirm Export"})]})]})}),d&&e.jsx(Wa,{onClose:()=>A(!1)}),W&&e.jsx(qt,{user:W,onClose:()=>{V(null),y(!1),te(!1)},onSave:oa}),K&&ne&&e.jsx(qt,{isCreate:!0,onClose:()=>{y(!1),te(!1)},onSave:ua})]})}export{Tn as default};
