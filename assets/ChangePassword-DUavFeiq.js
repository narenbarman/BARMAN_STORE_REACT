import{r,h as z,e as J,j as e,L as R,g as $}from"./index-B15Jacgc.js";import{n as b,i as B,P as Z}from"./phone-CMmRihHV.js";/* empty css              */const S=a=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(a),D=a=>{const t=String(a||"");return t.length>=10&&/[a-z]/.test(t)&&/[A-Z]/.test(t)&&/[0-9]/.test(t)&&/[^A-Za-z0-9]/.test(t)};function Q(){const[a,t]=r.useState("email"),[w,c]=r.useState(""),[f,d]=r.useState(""),[h,u]=r.useState(!1),[N,q]=r.useState(""),[p,F]=r.useState(""),[x,O]=r.useState(""),[o,l]=r.useState(!1),[E,i]=r.useState(""),[C,L]=r.useState(""),_=z(),T=J();r.useEffect(()=>{let s=null;try{const y=localStorage.getItem("user");s=y?JSON.parse(y):null}catch{s=null}const n=new URLSearchParams(_.search),m=n.get("force")==="1",P=!!(s!=null&&s.must_change_password),g=m||P,v=String(n.get("email")||"").trim().toLowerCase(),I=b(n.get("phone")||""),j=String((s==null?void 0:s.email)||"").trim().toLowerCase(),k=b((s==null?void 0:s.phone)||"");if(v&&S(v)){t("email"),c(v),d(""),u(g);return}if(j&&S(j)){t("email"),c(j),d(""),u(g);return}if(I){t("phone"),d(I),c(""),u(g);return}if(k){t("phone"),d(k),c(""),u(g);return}u(!1)},[_.search]);const A=async s=>{if(s.preventDefault(),l(!0),i(""),L(""),a==="email"&&!S(w)){i("Please enter a valid email address"),l(!1);return}if(a==="phone"&&!B(f)){i(Z),l(!1);return}if(p!==x){i("New passwords do not match"),l(!1);return}if(!D(p)){i("Password must be at least 10 characters and include uppercase, lowercase, number, and special character"),l(!1);return}try{await $.changePassword(a==="email"?w:null,a==="phone"?b(f):null,N,p,x);try{const n=localStorage.getItem("user"),m=n?JSON.parse(n):null;if(m&&m.must_change_password){const P={...m,must_change_password:!1};localStorage.setItem("user",JSON.stringify(P)),window.dispatchEvent(new Event("user-updated"))}}catch{}L("Password changed successfully! This window will close."),setTimeout(()=>{try{window.open("","_self"),window.close()}catch{}setTimeout(()=>{T("/login")},250)},1e3)}catch(n){i(n.message)}finally{l(!1)}};return e.jsx("div",{className:"login-page",children:e.jsxs("div",{className:"login-container",children:[e.jsx("h1",{children:"Change Password"}),e.jsx("p",{className:"login-subtitle",children:"Enter your account details and a new password"}),E&&e.jsx("div",{className:"error-message",children:E}),C&&e.jsx("div",{className:"success-message",children:C}),e.jsxs("form",{onSubmit:A,children:[e.jsxs("div",{className:"login-method-toggle",children:[e.jsx("button",{type:"button",className:`toggle-btn ${a==="email"?"active":""}`,onClick:()=>t("email"),disabled:h||o,children:"Email"}),e.jsx("button",{type:"button",className:`toggle-btn ${a==="phone"?"active":""}`,onClick:()=>t("phone"),disabled:h||o,children:"Phone"})]}),a==="email"&&e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"email",children:"Email"}),e.jsx("input",{type:"email",id:"email",value:w,onChange:s=>c(s.target.value),placeholder:"Enter your email",required:a==="email",disabled:h||o})]}),a==="phone"&&e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"phone",children:"Phone Number"}),e.jsx("input",{type:"tel",id:"phone",value:f,onChange:s=>d(s.target.value),placeholder:"Enter your phone (e.g., 123-456-7890)",required:a==="phone",disabled:h||o}),e.jsx("small",{style:{color:"var(--color-text)",opacity:.7},children:"Enter your registered phone number (10 digits, optional +91 prefix)"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"currentPassword",children:"Current Password"}),e.jsx("input",{type:"password",id:"currentPassword",value:N,onChange:s=>q(s.target.value),placeholder:"Enter your current password",required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"newPassword",children:"New Password"}),e.jsx("input",{type:"password",id:"newPassword",value:p,onChange:s=>F(s.target.value),placeholder:"Enter your new password",required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"confirmPassword",children:"Confirm New Password"}),e.jsx("input",{type:"password",id:"confirmPassword",value:x,onChange:s=>O(s.target.value),placeholder:"Confirm your new password",required:!0})]}),e.jsx("button",{type:"submit",className:"login-btn",disabled:o,children:o?"Changing Password...":"Change Password"})]}),e.jsxs("p",{className:"login-link",children:["Remember your password? ",e.jsx(R,{to:"/login",children:"Back to Login"})]})]})})}export{Q as default};
