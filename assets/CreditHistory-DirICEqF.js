import{c as Ze,z as et,d as tt,A as nt,r as x,l as te,m as st,j as e,L as at,T as Y,S as rt,E as it,B as lt,O as ne}from"./index-DzGHLpa5.js";import{F as ot,o as se}from"./whatsapp-Bk8hIOWH.js";import{P as ae,p as ct,e as S}from"./printService-BaZtc1Jp.js";import{U as dt,c as pt,a as ht,b as ut,d as mt,s as xt}from"./pdfService-D2MVC0JI.js";import{f as h,g as gt}from"./formatters-C_RfwIqz.js";import{A as bt}from"./arrow-left-SKDE9rNF.js";import{P as ft}from"./plus-O5hZR1MK.js";import{E as be,D as yt}from"./eye-zEiioHd5.js";import{D as fe}from"./dollar-sign-pVbPXs6e.js";import{R as vt}from"./refresh-cw-CDEAC0yM.js";const ye=Ze("MessageCircle",[["path",{d:"m3 21 1.9-5.7a8.5 8.5 0 1 1 3.8 3.8z",key:"v2veuj"}]]),E=l=>{const g=Number(l||0),d=Math.abs(g),T=new Intl.NumberFormat("en-IN",{minimumFractionDigits:2,maximumFractionDigits:2}).format(d);return`${g<0?"-":""}Rs ${T}`},P={marginLeft:14,marginRight:14,fontSize:9.5,cellPadding:3.2,minCellHeight:8,columnWeight:{date:.11,type:.09,reference:.12,amount:.14,balance:.16,description:.38}},ve=l=>String(l).padStart(2,"0"),je=l=>!(l instanceof Date)||Number.isNaN(l.getTime())?"":`${l.getFullYear()}-${ve(l.getMonth()+1)}-${ve(l.getDate())}`,K=()=>je(new Date),H=l=>{const g=String((l==null?void 0:l.transaction_date)||"").trim();if(/^\d{4}-\d{2}-\d{2}$/.test(g))return g;const d=new Date((l==null?void 0:l.created_at)||"");return je(d)},w=l=>{const g=String((l==null?void 0:l.transaction_date)||"").trim();if(/^\d{4}-\d{2}-\d{2}$/.test(g))return new Date(`${g}T00:00:00`).getTime();const d=new Date((l==null?void 0:l.created_at)||"").getTime();return Number.isFinite(d)?d:0},I=(l,{long:g=!1}={})=>{const d=H(l);if(/^\d{4}-\d{2}-\d{2}$/.test(d)){const[T,j,u]=d.split("-").map(A=>Number(A)),z=new Date(T,j-1,u);return g?z.toLocaleDateString("en-IN",{year:"numeric",month:"long",day:"numeric"}):z.toLocaleDateString("en-IN")}return"-"},jt=l=>{var j,u;const d=(typeof((u=(j=l==null?void 0:l.internal)==null?void 0:j.pageSize)==null?void 0:u.getWidth)=="function"?l.internal.pageSize.getWidth():210)-P.marginLeft-P.marginRight,T=P.columnWeight;return{0:{cellWidth:d*T.date},1:{cellWidth:d*T.type},2:{cellWidth:d*T.reference},3:{cellWidth:d*T.amount,halign:"right"},4:{cellWidth:d*T.balance,halign:"right"},5:{cellWidth:d*T.description,overflow:"linebreak",valign:"top"}}},k=l=>{const g=h(Math.abs(l));return e.jsx("span",{className:gt(l),children:g})},Nt=5*24*60*60*1e3;function kt({user:l}){const{userId:g}=et(),d=tt(),T=nt(),j=(()=>{if(l)return l;try{return JSON.parse(localStorage.getItem("user")||"null")}catch{return null}})(),u=(j==null?void 0:j.role)==="admin",z=u?g:(j==null?void 0:j.id)||g,[A,Ne]=x.useState([]),[W,Ce]=x.useState(0),[r,Te]=x.useState(null),[Se,re]=x.useState(!0),[$e,G]=x.useState(!1),[N,De]=x.useState(null),[we,Q]=x.useState(!1),[ie,le]=x.useState(!1),[o,L]=x.useState({type:"given",amount:"",description:"",reference:"",transactionDate:K(),imagePath:""}),[oe,f]=x.useState(""),[ce,R]=x.useState(""),[U,Fe]=x.useState(()=>typeof window>"u"?!1:window.innerWidth<=768),de=x.useRef(null),[F,Pe]=x.useState(K()),[D,ze]=x.useState(K()),[O,Ae]=x.useState(""),[Ee,pe]=x.useState(!1),[M,J]=x.useState("");x.useEffect(()=>{if(!j){d("/login");return}if(!u&&g&&Number(g)!==Number(j.id)){d("/my-credit");return}z&&he(z)},[j,u,g,z,d]),x.useEffect(()=>{if(typeof window>"u")return;const t=()=>Fe(window.innerWidth<=768);return window.addEventListener("resize",t),()=>window.removeEventListener("resize",t)},[]);const he=async(t=z)=>{try{re(!0);const[s,a,i]=await Promise.all([te.getHistory(t),te.getBalance(t),st.getById(t)]);return Ne(s),Ce(a.balance),Te(i),{history:s,balance:Number((a==null?void 0:a.balance)||0),customer:i}}catch(s){return(s==null?void 0:s.status)===401?(localStorage.removeItem("user"),d("/login"),null):(f(s.message||"Failed to load credit history"),null)}finally{re(!1)}},ke=async t=>{const s=t.target.files[0];if(!s)return;le(!0);const a=new FormData;a.append("invoice",s);try{const c=await(await fetch("/api/upload/invoice",{method:"POST",body:a})).json();c.success?(L({...o,imagePath:c.imagePath}),R("Invoice uploaded successfully")):f(c.error||"Upload failed")}catch{f("Failed to upload file")}finally{le(!1)}},Re=async t=>{if(t.preventDefault(),f(""),R(""),!o.amount||parseFloat(o.amount)<=0){f("Please enter a valid amount");return}if(!o.transactionDate){f("Please select a transaction date");return}if(!o.description.trim()){f("Please enter a description");return}try{const s=Number(W||0),a={type:o.type,amount:parseFloat(o.amount),description:String(o.description||"").trim(),reference:String(o.reference||"").trim(),transactionDate:o.transactionDate||K()},i=await te.addTransaction(z,{...o,amount:parseFloat(o.amount),created_by:j==null?void 0:j.id});R("Transaction added successfully"),J(""),L({type:"given",amount:"",description:"",reference:"",transactionDate:K(),imagePath:""}),G(!1);const c=await he(z);let n=Number(c==null?void 0:c.balance);if(!Number.isFinite(n)){const m=a.type==="payment"?-a.amount:a.amount;n=Number(s+m)}const C=He({companyTitle:Y||"BARMAN STORE",entryType:a.type,amount:a.amount,description:a.description,reference:a.reference,entryDate:a.transactionDate,previousBalance:s,updatedBalance:n,thankYouLine:"Thank you for your payment and trust."});J(C)}catch(s){if((s==null?void 0:s.status)===401){localStorage.removeItem("user"),d("/login");return}f(s.message||"Failed to add transaction")}},ue=t=>{U||(De(t),Q(!0))},Be=t=>{const s=Number((t==null?void 0:t.amount)||0),a=Number((t==null?void 0:t.balance)||0),i=(t==null?void 0:t.type)==="payment"?a+s:a-s;return`
      <div class="credit-invoice">
        <div class="credit-invoice-header">
          <div>
            <h1>INVOICE</h1>
            <div class="meta">${S(Y)}</div>
          </div>
          <div class="meta-right">
            <div><strong>Invoice #:</strong> ${S((t==null?void 0:t.invoice_number)||"-")}</div>
            <div><strong>Date:</strong> ${S(I(t,{long:!0}))}</div>
          </div>
        </div>
        <div class="credit-party">
          <div><strong>Customer:</strong> ${S((r==null?void 0:r.name)||"-")}</div>
          <div>${S((r==null?void 0:r.email)||"")}</div>
          <div>${S((r==null?void 0:r.phone)||"")}</div>
        </div>
        <table class="credit-table">
          <thead>
            <tr>
              <th>Description</th>
              <th>Type</th>
              <th>Amount</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>${S((t==null?void 0:t.description)||"-")}</td>
              <td>${S(B((t==null?void 0:t.type)||"-"))}</td>
              <td>${S(h(s))}</td>
            </tr>
          </tbody>
        </table>
        <div class="credit-summary">
          <div><span>Previous Balance</span><strong>${S(h(i))}</strong></div>
          <div><span>Amount</span><strong>${S(h(s))}</strong></div>
          <div class="total"><span>Current Balance</span><strong>${S(h(a))}</strong></div>
        </div>
        ${t!=null&&t.reference?`<div class="credit-reference"><strong>Reference:</strong> ${S(t.reference)}</div>`:""}
      </div>
    `},Ie=()=>{N&&ct({title:`Invoice ${(N==null?void 0:N.invoice_number)||""}`,bodyHtml:Be(N),cssText:`
        .credit-invoice { max-width: 760px; margin: 0 auto; }
        .credit-invoice-header { display: flex; justify-content: space-between; gap: 16px; margin-bottom: 14px; }
        .credit-invoice-header h1 { margin: 0 0 4px; font-size: 24px; }
        .meta { color: #555; font-size: 12px; }
        .meta-right { text-align: right; font-size: 12px; line-height: 1.6; }
        .credit-party { margin: 12px 0; font-size: 12px; line-height: 1.6; }
        .credit-table { width: 100%; border-collapse: collapse; font-size: 12px; }
        .credit-table th, .credit-table td { border: 1px solid #d1d5db; padding: 7px; text-align: left; }
        .credit-table thead th { background: #f3f4f6; }
        .credit-summary { width: 320px; margin-top: 14px; margin-left: auto; }
        .credit-summary div { display: flex; justify-content: space-between; padding: 6px 0; border-bottom: 1px solid #e5e7eb; font-size: 12px; }
        .credit-summary .total { font-weight: 700; border-bottom: none; font-size: 14px; }
        .credit-reference { margin-top: 12px; font-size: 12px; }
      `,onError:t=>f(t)})},me=t=>{switch(t){case"given":return e.jsx(fe,{size:16,className:"type-icon given"});case"payment":return e.jsx(vt,{size:16,className:"type-icon payment"});default:return e.jsx(fe,{size:16})}},B=t=>{switch(t){case"given":return"Given";case"payment":return"Payment";default:return t}},Le=(t,s,a)=>{const i=A.filter(C=>{const m=H(C);return!!m&&m<=a}).sort((C,m)=>w(C)-w(m)),c=i.length>0?Number(i[i.length-1].balance||0):0,n=[];if(n.push(Y),n.push(""),n.push(`Credit Report for: ${(r==null?void 0:r.name)||"Customer"}`),n.push(`Date Range: ${s} to ${a}`),n.push(`Generated: ${new Date().toLocaleString()}`),n.push(""),!t||t.length===0)n.push("No transactions in this range."),n.push(`Period Ending Balance: ${h(c)}`),n.push(`Current Day Balance: ${h(parseFloat(W||0))}`);else{n.push("Transactions:");let C=0,m=0;t.forEach(b=>{const p=I(b),Z=B(b.type),y=Number(b.amount)||0;b.type==="given"?C+=y:b.type==="payment"&&(m+=y);const v=b.reference?`${b.description||""} (${b.reference})`.trim():b.description||"-";n.push(`- ${p} | ${Z} | ${h(y)} | Balance: ${h(Number(b.balance||0))}`),n.push(`  Desc: ${v}`)}),n.push(""),n.push(`Total Given: ${h(C)}`),n.push(`Total Payment: ${h(m)}`),n.push(`Net Change: ${h(C-m)}`),n.push(`Period Ending Balance: ${h(c)}`),n.push(`Current Day Balance: ${h(parseFloat(W||0))}`)}return n.push(""),n.push(`Visit online: ${ne}`),n.push(""),n.push("Thank you for shopping with us."),n.join(`
`)},_e=()=>{if(!F||!D){f("Please select both From and To dates for the report.");return}if(F>D){f("From date cannot be later than To date.");return}f(""),R("");const t=A.filter(a=>{const i=H(a);return!!i&&i>=F&&i<=D}).sort((a,i)=>w(a)-w(i)),s=Le(t,F,D);Ae(s),pe(!0)},We=async()=>{if(O)try{await navigator.clipboard.writeText(O),R("Report copied to clipboard")}catch{f("Failed to copy report")}},Me=()=>{O&&se({phone:r==null?void 0:r.phone,text:O})},He=({companyTitle:t,entryType:s,amount:a,description:i,reference:c,entryDate:n,previousBalance:C,updatedBalance:m,thankYouLine:b})=>{const p=[];return p.push(t),p.push(""),p.push("Credit Ledger Update"),p.push(`Date: ${new Date(n||Date.now()).toLocaleDateString("en-IN")}`),p.push(""),p.push(`New Entry: ${B(s)} | ${h(Number(a||0))}`),p.push(`Description: ${i||"No additional note"}`),c&&p.push(`Reference: ${c}`),p.push(""),p.push(`Previous Balance: ${h(Number(C||0))}`),p.push(`Updated Balance: ${h(Number(m||0))}`),p.push(`Current Total Credit: ${h(Number(m||0))}`),p.push(""),p.push(`Visit online: ${ne}`),p.push(""),p.push(b),p.join(`
`)},Ge=async()=>{if(M)try{await navigator.clipboard.writeText(M),R("Entry message copied to clipboard")}catch{f("Failed to copy entry message")}},Ue=()=>{M&&se({phone:r==null?void 0:r.phone,text:M})},X=t=>{const s=typeof t=="object"?w(t):new Date(t).getTime();if(!Number.isFinite(s))return!1;const a=Date.now();return a>=s&&a-s<=Nt},Oe=(()=>{const t=new Map;return A.forEach(s=>{const a=H(s)||"Unknown";t.has(a)||t.set(a,[]),t.get(a).push(s)}),Array.from(t.entries()).sort(([s],[a])=>a.localeCompare(s)).map(([s,a])=>({dateKey:s,dateLabel:/^\d{4}-\d{2}-\d{2}$/.test(s)?I({transaction_date:s},{long:!0}):s,transactions:[...a].sort((i,c)=>w(c)-w(i))}))})(),Ve=t=>{const s=Number((t==null?void 0:t.amount)||0),a=Number((t==null?void 0:t.balance)||0),i=[];return i.push(Y),i.push(""),i.push("Transaction Update"),i.push(`Date: ${I(t)}`),i.push(`Type: ${B(t==null?void 0:t.type)}`),i.push(`Amount: ${h(s)}`),i.push(`Description: ${(t==null?void 0:t.description)||"No additional note"}`),t!=null&&t.reference&&i.push(`Reference: ${t.reference}`),i.push(`Updated Balance: ${h(a)}`),i.push(`Current Total Credit: ${h(a)}`),i.push(""),i.push(`Visit online: ${ne}`),i.push(""),i.push("Thank you for shopping with us."),i.join(`
`)},xe=t=>{X(t)&&se({phone:r==null?void 0:r.phone,text:Ve(t)})},Ye=()=>{var t;if(!F||!D){f("Please select both From and To dates for the report.");return}if(F>D){f("From date cannot be later than To date.");return}f(""),R("");try{const s=A.filter(y=>{const v=H(y);return!!v&&v>=F&&v<=D}).sort((y,v)=>w(y)-w(v)),a=A.filter(y=>{const v=H(y);return!!v&&v<=D}).sort((y,v)=>w(y)-w(v)),i=a.length>0?Number(a[a.length-1].balance||0):0,c=Number(W||0),n=pt(),C=[41,128,185],m=[52,73,94],b=[39,174,96];n.setFillColor(...C),n.rect(0,0,210,45,"F"),n.setTextColor(255,255,255),n.setFontSize(24),n.setFont("helvetica","bold"),n.text(Y||"BARMAN STORE",105,18,{align:"center"}),n.setFontSize(10),n.setFont("helvetica","normal"),n.text(rt||"Quality Groceries & Everyday Essentials",105,28,{align:"center"}),n.setFontSize(9);const p=`${it||""} | ${lt||""}`;if(n.text(p,105,38,{align:"center"}),n.setTextColor(...m),n.setFontSize(16),n.setFont("helvetica","bold"),n.text("Credit Report",105,55,{align:"center"}),n.setDrawColor(200,200,200),n.setFillColor(248,249,250),n.roundedRect(14,62,182,28,3,3,"FD"),n.setFontSize(10),n.setFont("helvetica","bold"),n.setTextColor(...m),n.text("Customer Details",20,72),n.setFont("helvetica","normal"),n.setFontSize(9),n.text(`Name: ${(r==null?void 0:r.name)||"N/A"}`,20,80),n.text(`Phone: ${(r==null?void 0:r.phone)||"N/A"}`,100,80),n.text(`Email: ${(r==null?void 0:r.email)||"N/A"}`,20,86),n.setFontSize(9),n.setTextColor(100,100,100),n.text(`Period: ${F} to ${D}`,100,86),s.length>0){const y=s.map($=>[I($),B($.type),$.reference||"-",{content:E($.type==="payment"?-Number($.amount):Number($.amount)),styles:{halign:"right"}},{content:E(Number($.balance)),styles:{halign:"right"}},$.description||"-"]);ht(n,{startY:95,head:[["Date","Type","Reference","Amount","Balance","Description"]],body:y,theme:"plain",headStyles:{fillColor:[255,255,255],textColor:[45,45,45],fontStyle:"bold",fontSize:P.fontSize,cellPadding:P.cellPadding,lineWidth:0},bodyStyles:{fontSize:P.fontSize,textColor:[35,35,35],cellPadding:P.cellPadding,minCellHeight:P.minCellHeight,overflow:"linebreak",valign:"top",lineWidth:0},styles:{lineWidth:0},columnStyles:jt(n),margin:{left:P.marginLeft,right:P.marginRight}});const v=Number(((t=n==null?void 0:n.lastAutoTable)==null?void 0:t.finalY)||95)+10;let V=0,ee=0;s.forEach($=>{const ge=Number($.amount)||0;$.type==="given"?V+=ge:$.type==="payment"&&(ee+=ge)});const Qe=42,Je=14,Xe=n.internal.pageSize.height,q=v+Qe+Je>Xe?20:v;q!==v&&n.addPage(),n.setFillColor(248,249,250),n.roundedRect(14,q,182,42,3,3,"F"),n.setFontSize(11),n.setFont("helvetica","bold"),n.setTextColor(...m),n.text("Summary",20,q+10),n.setFontSize(9),n.setFont("helvetica","normal");const _=q+18;n.text(`Total Credit Given: ${E(V)}`,20,_),n.text(`Total Payments Received: ${E(ee)}`,20,_+7),n.text(`Net Change: ${E(V-ee)}`,20,_+14),n.setFont("helvetica","bold"),n.setFontSize(9),n.setTextColor(...m),n.text("Period Ending Balance:",118,_+2),n.setTextColor(i>=0?b[0]:231,i>=0?b[1]:76,i>=0?b[2]:60),n.text(E(i),118,_+8),n.setTextColor(...m),n.text("Current Day Balance:",118,_+14),n.setTextColor(c>=0?b[0]:231,c>=0?b[1]:76,c>=0?b[2]:60),n.text(E(c),118,_+20)}else n.setFontSize(11),n.setTextColor(100,100,100),n.text("No transactions found in the selected date range.",105,110,{align:"center"}),n.setFontSize(9),n.setTextColor(...m),n.text(`Period Ending Balance: ${E(i)}`,105,118,{align:"center"}),n.text(`Current Day Balance: ${E(c)}`,105,124,{align:"center"});ut(n,(y,v,V)=>{y.setFontSize(8),y.setTextColor(150,150,150),y.text(`Generated on ${new Date().toLocaleString("en-IN")} | Page ${v} of ${V}`,105,y.internal.pageSize.height-10,{align:"center"})});const Z=`Credit_Report_${mt((r==null?void 0:r.name)||"Customer")}_${F}_to_${D}`;xt(n,Z),R("PDF report downloaded successfully!")}catch(s){f((s==null?void 0:s.message)||"Failed to generate PDF report.")}};if(Se)return e.jsx("div",{className:"credit-history-page",children:e.jsx("div",{className:"loading",children:"Loading..."})});const Ke=u?(()=>{var a;const s=new URLSearchParams(T.search||"").get("returnTab")||((a=T.state)==null?void 0:a.returnTab);return s?`/admin?tab=${encodeURIComponent(s)}`:"/admin"})():"/profile",qe=u?"Back to Admin":"Back to Profile";return e.jsxs("div",{className:"credit-history-page",children:[e.jsxs("div",{className:"page-header",children:[e.jsxs(at,{to:Ke,className:"back-link",children:[e.jsx(bt,{size:20})," ",qe]}),e.jsxs("div",{className:"header-content",children:[e.jsx("h1",{children:u?"Credit History":"My Credit History"}),r&&e.jsx("p",{className:"customer-name",children:r.name})]}),e.jsxs("div",{className:"balance-card",children:[e.jsx("span",{className:"balance-label",children:"Current Balance"}),e.jsx("span",{className:`balance-amount ${W>=0?"positive":"negative"}`,children:k(W)})]})]}),oe&&e.jsx("div",{className:"error-message",children:oe}),ce&&e.jsx("div",{className:"success-message",children:ce}),u&&e.jsx("div",{className:"actions-bar",children:e.jsxs("button",{className:"admin-btn primary",onClick:()=>G(!0),children:[e.jsx(ft,{size:20})," Add Transaction"]})}),e.jsxs("div",{className:"credit-table-container",children:[A.length===0?e.jsxs("div",{className:"empty-state",children:[e.jsxs("p",{children:["No credit history found",u?" for this customer.":"."]}),u&&e.jsx("p",{children:'Click "Add Transaction" to record a transaction.'})]}):e.jsxs(e.Fragment,{children:[e.jsxs("table",{className:"credit-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Date"}),e.jsx("th",{children:"Invoice #"}),e.jsx("th",{children:"Type"}),e.jsx("th",{children:"Amount"}),e.jsx("th",{children:"Balance"}),e.jsx("th",{children:"Description"}),e.jsx("th",{children:"Actions"})]})}),e.jsx("tbody",{children:A.map(t=>{const s=t.reference?`${t.description||""} (${t.reference})`.trim():t.description||"-",a=u&&X(t);return e.jsxs("tr",{children:[e.jsx("td",{children:I(t,{long:!0})}),e.jsx("td",{className:"invoice-number",children:t.invoice_number||"-"}),e.jsxs("td",{children:[me(t.type),e.jsx("span",{children:B(t.type)})]}),e.jsx("td",{className:t.type==="payment"?"payment-amount":"given-amount",children:k(t.type==="payment"?-parseFloat(t.amount):parseFloat(t.amount))}),e.jsx("td",{children:k(parseFloat(t.balance))}),e.jsx("td",{children:s}),e.jsxs("td",{className:"actions-cell",children:[t.image_path&&e.jsx("a",{href:t.image_path,target:"_blank",rel:"noopener noreferrer",className:"action-icon view",title:"View Invoice",children:e.jsx(be,{size:16})}),e.jsx("button",{className:"action-icon print mobile-hide-print",onClick:()=>ue(t),title:"Print Invoice",disabled:U,"aria-disabled":U,children:e.jsx(ae,{size:16})}),a&&e.jsx("button",{className:"action-icon whatsapp",onClick:()=>xe(t),title:"Share on WhatsApp",children:e.jsx(ye,{size:16})})]})]},t.id)})})]}),e.jsx("div",{className:"credit-mobile-list",children:Oe.map(t=>e.jsxs("section",{className:"credit-day-group",children:[e.jsx("h3",{className:"credit-day-title",children:t.dateLabel}),e.jsx("div",{className:"credit-bubble-stack",children:t.transactions.map(s=>{const a=s.description||"-",i=s.reference||"-",c=s.type==="payment"?-parseFloat(s.amount):parseFloat(s.amount),n=u&&X(s);return e.jsxs("article",{className:`credit-transaction-bubble ${s.type==="payment"?"bubble-right payment":"bubble-left given"}`,children:[e.jsxs("header",{className:"bubble-head",children:[e.jsxs("span",{className:"bubble-type",children:[me(s.type),B(s.type)]}),e.jsx("span",{className:s.type==="payment"?"payment-amount":"given-amount",children:k(c)})]}),e.jsxs("div",{className:"bubble-detail",children:[e.jsx("strong",{children:"Desc:"})," ",a]}),e.jsxs("div",{className:"bubble-detail",children:[e.jsx("strong",{children:"Ref:"})," ",i]}),e.jsxs("div",{className:"bubble-detail",children:[e.jsx("strong",{children:"Invoice:"})," ",s.invoice_number||"-"]}),e.jsxs("div",{className:"bubble-detail",children:[e.jsx("strong",{children:"Date:"})," ",I(s,{long:!0})]}),e.jsxs("div",{className:"bubble-actions",children:[s.image_path&&e.jsx("a",{href:s.image_path,target:"_blank",rel:"noopener noreferrer",className:"action-icon view",title:"View Invoice",onClick:C=>C.stopPropagation(),children:e.jsx(be,{size:16})}),e.jsx("button",{className:"action-icon print mobile-hide-print",onClick:()=>ue(s),title:"Print Invoice",disabled:U,"aria-disabled":U,children:e.jsx(ae,{size:16})}),n&&e.jsx("button",{className:"action-icon whatsapp",onClick:()=>xe(s),title:"Share on WhatsApp",children:e.jsx(ye,{size:16})})]}),e.jsxs("footer",{className:"bubble-balance",children:[e.jsx("span",{children:"Balance"}),e.jsx("strong",{children:k(parseFloat(s.balance))})]})]},`mobile-${s.id}`)})})]},t.dateKey))})]}),u&&e.jsxs("div",{className:"report-controls",children:[e.jsxs("label",{children:[" From:",e.jsx("input",{type:"date",value:F,onChange:t=>Pe(t.target.value)})]}),e.jsxs("label",{children:[" To:",e.jsx("input",{type:"date",value:D,onChange:t=>ze(t.target.value)})]}),e.jsx("button",{className:"admin-btn",onClick:_e,title:"Generate credit report for date range",children:"Generate Report"})]})]}),u&&Ee&&e.jsxs("div",{className:"report-box",children:[e.jsx("div",{className:"report-header",children:e.jsxs("strong",{children:["Credit Report ",r!=null&&r.name?`- ${r.name}`:""]})}),e.jsx("textarea",{className:"report-text",readOnly:!0,value:O}),e.jsxs("div",{className:"report-actions",children:[e.jsx("button",{className:"report-btn",onClick:We,children:"Copy"}),e.jsx("button",{className:"report-btn whatsapp",onClick:Me,children:"WhatsApp"}),e.jsxs("button",{className:"report-btn pdf",onClick:Ye,children:[e.jsx(yt,{size:14})," PDF"]}),e.jsx("button",{className:"report-btn",onClick:()=>pe(!1),children:"Close"})]})]}),u&&M&&e.jsxs("div",{className:"report-box",children:[e.jsx("div",{className:"report-header",children:e.jsx("strong",{children:"Manual Entry Message"})}),e.jsx("textarea",{className:"report-text",readOnly:!0,value:M}),e.jsxs("div",{className:"report-actions",children:[e.jsx("button",{className:"report-btn",onClick:Ge,children:"Copy"}),e.jsx("button",{className:"report-btn whatsapp",onClick:Ue,children:"WhatsApp"}),e.jsx("button",{className:"report-btn",onClick:()=>J(""),children:"Close"})]})]}),u&&$e&&e.jsx("div",{className:"modal-overlay",onClick:()=>G(!1),children:e.jsxs("div",{className:"modal-content fade-in-up",onClick:t=>t.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h2",{children:"Add Payment Entry"}),e.jsx("button",{className:"close-btn",onClick:()=>G(!1),children:"×"})]}),e.jsxs("form",{onSubmit:Re,children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Transaction Type"}),e.jsxs("select",{value:o.type,onChange:t=>L({...o,type:t.target.value}),children:[e.jsx("option",{value:"given",children:"Given (Add to balance)"}),e.jsx("option",{value:"payment",children:"Payment (Reduce balance)"})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Amount (₹)"}),e.jsx("input",{type:"number",step:"0.01",min:"0.01",value:o.amount,onChange:t=>L({...o,amount:t.target.value}),placeholder:"Enter amount",required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Date"}),e.jsx("input",{type:"date",value:o.transactionDate,onChange:t=>L({...o,transactionDate:t.target.value}),required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Description *"}),e.jsx("input",{type:"text",value:o.description,onChange:t=>L({...o,description:t.target.value}),placeholder:"Enter description",required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Reference"}),e.jsx("input",{type:"text",value:o.reference,onChange:t=>L({...o,reference:t.target.value}),placeholder:"Reference number (optional)"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Upload Invoice/Bill"}),e.jsxs("div",{className:"file-upload-area",children:[e.jsx("input",{type:"file",ref:de,onChange:ke,accept:"image/*,.pdf",style:{display:"none"}}),e.jsxs("button",{type:"button",className:"upload-btn",onClick:()=>de.current.click(),disabled:ie,children:[e.jsx(dt,{size:16}),ie?"Uploading...":"Choose File"]}),o.imagePath&&e.jsxs("span",{className:"uploaded-file",children:[e.jsx(ot,{size:14})," Invoice uploaded"]})]})]}),e.jsxs("div",{className:"modal-actions",children:[e.jsx("button",{type:"button",className:"cancel-btn",onClick:()=>G(!1),children:"Cancel"}),e.jsx("button",{type:"submit",className:"submit-btn",children:"Add Transaction"})]})]})]})}),we&&N&&e.jsx("div",{className:"modal-overlay invoice-modal-overlay",onClick:()=>Q(!1),children:e.jsxs("div",{className:"invoice-template fade-in-up",onClick:t=>t.stopPropagation(),children:[e.jsxs("div",{className:"invoice-header",children:[e.jsx("h1",{children:"INVOICE"}),e.jsxs("div",{className:"company-details",children:[e.jsx("h3",{children:"Barman Store"}),e.jsx("p",{children:"Quality Groceries & Everyday Essentials"}),e.jsx("p",{children:"Email: info@barmanstore.com"})]})]}),e.jsxs("div",{className:"invoice-details",children:[e.jsxs("div",{className:"invoice-info",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Invoice #:"})," ",N.invoice_number]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Date:"})," ",I(N,{long:!0})]})]}),e.jsxs("div",{className:"customer-info",children:[e.jsx("h4",{children:"Bill To:"}),e.jsx("p",{children:e.jsx("strong",{children:r==null?void 0:r.name})}),e.jsx("p",{children:(r==null?void 0:r.email)||"No email"}),e.jsx("p",{children:(r==null?void 0:r.phone)||"No phone"}),(r==null?void 0:r.address)&&e.jsx("p",{children:r.address})]})]}),e.jsxs("table",{className:"invoice-items",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Description"}),e.jsx("th",{children:"Type"}),e.jsx("th",{children:"Amount"})]})}),e.jsx("tbody",{children:e.jsxs("tr",{children:[e.jsx("td",{children:N.description}),e.jsx("td",{children:B(N.type)}),e.jsx("td",{children:k(parseFloat(N.amount))})]})})]}),e.jsxs("div",{className:"invoice-summary",children:[e.jsxs("div",{className:"summary-row",children:[e.jsx("span",{children:"Previous Balance:"}),e.jsx("span",{children:k(parseFloat(N.balance)+parseFloat(N.amount))})]}),e.jsxs("div",{className:"summary-row",children:[e.jsx("span",{children:"Amount:"}),e.jsx("span",{children:k(parseFloat(N.amount))})]}),e.jsxs("div",{className:"summary-row total",children:[e.jsx("span",{children:"Current Balance:"}),e.jsx("span",{children:k(parseFloat(N.balance))})]})]}),N.reference&&e.jsx("div",{className:"invoice-footer",children:e.jsxs("p",{children:[e.jsx("strong",{children:"Reference:"})," ",N.reference]})}),e.jsxs("div",{className:"invoice-actions no-print",children:[e.jsxs("button",{className:"admin-btn",onClick:Ie,children:[e.jsx(ae,{size:16})," Print Invoice"]}),e.jsx("button",{className:"admin-btn secondary",onClick:()=>Q(!1),children:"Close"})]})]})})]})}export{kt as default};
