import{c as Ze,B as et,e as tt,h as nt,r as u,n as ee,q as at,j as e,L as st,X as it,T as U,S as rt,E as lt,F as ot,O as te}from"./index-B15Jacgc.js";import{M as xe,U as ct,F as dt,c as pt,a as mt,d as ht,f as ut,e as xt,s as gt,g as bt,h as ft,i as yt}from"./pdfService-Bbu4Qf5L.js";import{P as ne,R as vt,p as jt,e as N}from"./printService-DN5DPOVT.js";import{f as G,g as Nt}from"./formatters-C_RfwIqz.js";import{A as Ct}from"./arrow-left-B3UQ9Gym.js";import{P as Tt}from"./plus-DMW20Fof.js";import{E as ge,D as St}from"./eye-Da84VUM6.js";import"./phone-CMmRihHV.js";const be=Ze("DollarSign",[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]]),$=r=>{const x=Number(r||0),c=Math.abs(x),j=new Intl.NumberFormat("en-IN",{minimumFractionDigits:2,maximumFractionDigits:2}).format(c);return`${x<0?"-":""}Rs ${j}`},F={marginLeft:14,marginRight:14,fontSize:9.5,cellPadding:3.2,minCellHeight:8,columnWeight:{date:.11,type:.09,reference:.12,amount:.14,balance:.16,description:.38}},fe=r=>String(r).padStart(2,"0"),ye=r=>!(r instanceof Date)||Number.isNaN(r.getTime())?"":`${r.getFullYear()}-${fe(r.getMonth()+1)}-${fe(r.getDate())}`,Y=()=>ye(new Date),L=r=>{const x=String((r==null?void 0:r.transaction_date)||"").trim();if(/^\d{4}-\d{2}-\d{2}$/.test(x))return x;const c=new Date((r==null?void 0:r.created_at)||"");return ye(c)},S=r=>{const x=String((r==null?void 0:r.transaction_date)||"").trim();if(/^\d{4}-\d{2}-\d{2}$/.test(x))return new Date(`${x}T00:00:00`).getTime();const c=new Date((r==null?void 0:r.created_at)||"").getTime();return Number.isFinite(c)?c:0},R=(r,{long:x=!1}={})=>{const c=L(r);if(/^\d{4}-\d{2}-\d{2}$/.test(c)){const[j,g,m]=c.split("-").map(P=>Number(P)),D=new Date(j,g-1,m);return x?D.toLocaleDateString("en-IN",{year:"numeric",month:"long",day:"numeric"}):D.toLocaleDateString("en-IN")}return"-"},wt=r=>{var g,m;const c=(typeof((m=(g=r==null?void 0:r.internal)==null?void 0:g.pageSize)==null?void 0:m.getWidth)=="function"?r.internal.pageSize.getWidth():210)-F.marginLeft-F.marginRight,j=F.columnWeight;return{0:{cellWidth:c*j.date},1:{cellWidth:c*j.type},2:{cellWidth:c*j.reference},3:{cellWidth:c*j.amount,halign:"right"},4:{cellWidth:c*j.balance,halign:"right"},5:{cellWidth:c*j.description,overflow:"linebreak",valign:"top"}}},A=r=>{const x=G(Math.abs(r));return e.jsx("span",{className:Nt(r),children:x})},Ft=5*24*60*60*1e3;function Bt({user:r}){const{userId:x}=et(),c=tt(),j=nt(),g=(()=>{if(r)return r;try{return JSON.parse(localStorage.getItem("user")||"null")}catch{return null}})(),m=(g==null?void 0:g.role)==="admin",D=m?x:(g==null?void 0:g.id)||x,[P,ve]=u.useState([]),[_,je]=u.useState(0),[i,Ne]=u.useState(null),[Ce,ae]=u.useState(!0),[Te,W]=u.useState(!1),[b,Se]=u.useState(null),[we,V]=u.useState(!1),[se,ie]=u.useState(!1),[o,I]=u.useState({type:"given",amount:"",description:"",reference:"",transactionDate:Y(),imagePath:""}),[re,h]=u.useState(""),[le,k]=u.useState(""),[M,Fe]=u.useState(()=>typeof window>"u"?!1:window.innerWidth<=768),oe=u.useRef(null),[w,De]=u.useState(Y()),[T,Pe]=u.useState(Y()),[q,ke]=u.useState(""),[$e,ce]=u.useState(!1),[H,Q]=u.useState("");u.useEffect(()=>{if(!g){c("/login");return}if(!m&&x&&Number(x)!==Number(g.id)){c("/my-credit");return}D&&de(D)},[g,m,x,D,c]),u.useEffect(()=>{if(typeof window>"u")return;const t=()=>Fe(window.innerWidth<=768);return window.addEventListener("resize",t),()=>window.removeEventListener("resize",t)},[]);const de=async(t=D)=>{try{ae(!0);const[n,s,l]=await Promise.all([ee.getHistory(t),ee.getBalance(t),at.getById(t)]);return ve(n),je(s.balance),Ne(l),{history:n,balance:Number((s==null?void 0:s.balance)||0),customer:l}}catch(n){return(n==null?void 0:n.status)===401?(localStorage.removeItem("user"),c("/login"),null):(h(n.message||"Failed to load credit history"),null)}finally{ae(!1)}},Ae=async t=>{const n=t.target.files[0];if(!n)return;ie(!0);const s=new FormData;s.append("invoice",n);try{const d=await(await fetch("/api/upload/invoice",{method:"POST",body:s})).json();d.success?(I({...o,imagePath:d.imagePath}),k("Invoice uploaded successfully")):h(d.error||"Upload failed")}catch{h("Failed to upload file")}finally{ie(!1)}},ze=async t=>{if(t.preventDefault(),h(""),k(""),!o.amount||parseFloat(o.amount)<=0){h("Please enter a valid amount");return}if(!o.transactionDate){h("Please select a transaction date");return}if(!o.description.trim()){h("Please enter a description");return}try{const n=Number(_||0),s={type:o.type,amount:parseFloat(o.amount),description:String(o.description||"").trim(),reference:String(o.reference||"").trim(),transactionDate:o.transactionDate||Y()},l=await ee.addTransaction(D,{...o,amount:parseFloat(o.amount),created_by:g==null?void 0:g.id});k("Transaction added successfully"),Q(""),I({type:"given",amount:"",description:"",reference:"",transactionDate:Y(),imagePath:""}),W(!1);const d=await de(D);let a=Number(d==null?void 0:d.balance);if(!Number.isFinite(a)){const y=s.type==="payment"?-s.amount:s.amount;a=Number(n+y)}const p=We({companyTitle:U||"BARMAN STORE",entryType:s.type,amount:s.amount,description:s.description,reference:s.reference,entryDate:s.transactionDate,previousBalance:n,updatedBalance:a,thankYouLine:"Thank you for your payment and trust."});Q(p)}catch(n){if((n==null?void 0:n.status)===401){localStorage.removeItem("user"),c("/login");return}h(n.message||"Failed to add transaction")}},pe=t=>{M||(Se(t),V(!0))},Ee=t=>{const n=Number((t==null?void 0:t.amount)||0),s=Number((t==null?void 0:t.balance)||0),l=(t==null?void 0:t.type)==="payment"?s+n:s-n;return`
      <div class="credit-invoice">
        <div class="credit-invoice-header">
          <div>
            <h1>INVOICE</h1>
            <div class="meta">${N(U)}</div>
          </div>
          <div class="meta-right">
            <div><strong>Invoice #:</strong> ${N((t==null?void 0:t.invoice_number)||"-")}</div>
            <div><strong>Date:</strong> ${N(R(t,{long:!0}))}</div>
          </div>
        </div>
        <div class="credit-party">
          <div><strong>Customer:</strong> ${N((i==null?void 0:i.name)||"-")}</div>
          <div>${N((i==null?void 0:i.email)||"")}</div>
          <div>${N((i==null?void 0:i.phone)||"")}</div>
        </div>
        <table class="credit-table">
          <thead>
            <tr>
              <th>Description</th>
              <th>Type</th>
              <th>Amount</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>${N((t==null?void 0:t.description)||"-")}</td>
              <td>${N(z((t==null?void 0:t.type)||"-"))}</td>
              <td>${N(G(n))}</td>
            </tr>
          </tbody>
        </table>
        <div class="credit-summary">
          <div><span>Previous Balance</span><strong>${N(G(l))}</strong></div>
          <div><span>Amount</span><strong>${N(G(n))}</strong></div>
          <div class="total"><span>Current Balance</span><strong>${N(G(s))}</strong></div>
        </div>
        ${t!=null&&t.reference?`<div class="credit-reference"><strong>Reference:</strong> ${N(t.reference)}</div>`:""}
      </div>
    `},Re=()=>{b&&jt({title:`Invoice ${(b==null?void 0:b.invoice_number)||""}`,bodyHtml:Ee(b),cssText:`
        .credit-invoice { max-width: 760px; margin: 0 auto; }
        .credit-invoice-header { display: flex; justify-content: space-between; gap: 16px; margin-bottom: 14px; }
        .credit-invoice-header h1 { margin: 0 0 4px; font-size: 24px; }
        .meta { color: #555; font-size: 12px; }
        .meta-right { text-align: right; font-size: 12px; line-height: 1.6; }
        .credit-party { margin: 12px 0; font-size: 12px; line-height: 1.6; }
        .credit-table { width: 100%; border-collapse: collapse; font-size: 12px; }
        .credit-table th, .credit-table td { border: 1px solid #d1d5db; padding: 7px; text-align: left; }
        .credit-table thead th { background: #f3f4f6; }
        .credit-summary { width: 320px; margin-top: 14px; margin-left: auto; }
        .credit-summary div { display: flex; justify-content: space-between; padding: 6px 0; border-bottom: 1px solid #e5e7eb; font-size: 12px; }
        .credit-summary .total { font-weight: 700; border-bottom: none; font-size: 14px; }
        .credit-reference { margin-top: 12px; font-size: 12px; }
      `,onError:t=>h(t)})},me=t=>{switch(t){case"given":return e.jsx(be,{size:16,className:"type-icon given"});case"payment":return e.jsx(vt,{size:16,className:"type-icon payment"});default:return e.jsx(be,{size:16})}},z=t=>{switch(t){case"given":return"Given";case"payment":return"Payment";default:return t}},Ie=(t,n,s)=>{const l=P.filter(p=>{const y=L(p);return!!y&&y<=s}).sort((p,y)=>S(p)-S(y)),d=l.length>0?Number(l[l.length-1].balance||0):0,a=(t||[]).map(p=>({dateLabel:R(p),typeLabel:z(p.type),type:p.type,amount:Number(p.amount)||0,balance:Number(p.balance||0),description:p.reference?`${p.description||""} (${p.reference})`.trim():p.description||"-"}));return ft({companyTitle:U,customerName:(i==null?void 0:i.name)||"Customer",fromDate:n,toDate:s,generatedAt:Date.now(),transactions:a,periodEndingBalance:d,currentDayBalance:parseFloat(_||0),onlineStoreUrl:te,thankYouLine:"Thank you for shopping with us."})},Be=()=>{if(!w||!T){h("Please select both From and To dates for the report.");return}if(w>T){h("From date cannot be later than To date.");return}h(""),k("");const t=P.filter(s=>{const l=L(s);return!!l&&l>=w&&l<=T}).sort((s,l)=>S(s)-S(l)),n=Ie(t,w,T);ke(n),ce(!0)},Le=async()=>{if(q)try{await navigator.clipboard.writeText(q),k("Report copied to clipboard")}catch{h("Failed to copy report")}},J=async t=>{if(!t)return;const n=await gt({phone:i==null?void 0:i.phone,text:t});if(n.status==="missing_phone"){h("Customer phone is missing or invalid. Please update phone and try again.");return}if(n.status==="fallback_copy"){k("Message was long. Copied to clipboard; paste it in WhatsApp.");return}n.status==="fallback_no_copy"&&h("Message was long. Opened WhatsApp chat, please paste the message manually.")},_e=async()=>{await J(q)},We=({companyTitle:t,entryType:n,amount:s,description:l,reference:d,entryDate:a,previousBalance:p,updatedBalance:y,thankYouLine:E})=>yt({companyTitle:t,entryTypeLabel:z(n),amount:s,description:l,reference:d,entryDate:a,previousBalance:p,updatedBalance:y,onlineStoreUrl:te,thankYouLine:E}),Me=async()=>{if(H)try{await navigator.clipboard.writeText(H),k("Entry message copied to clipboard")}catch{h("Failed to copy entry message")}},He=async()=>{await J(H)},X=t=>{const n=typeof t=="object"?S(t):new Date(t).getTime();if(!Number.isFinite(n))return!1;const s=Date.now();return s>=n&&s-n<=Ft},Oe=(()=>{const t=new Map;return P.forEach(n=>{const s=L(n)||"Unknown";t.has(s)||t.set(s,[]),t.get(s).push(n)}),Array.from(t.entries()).sort(([n],[s])=>s.localeCompare(n)).map(([n,s])=>({dateKey:n,dateLabel:/^\d{4}-\d{2}-\d{2}$/.test(n)?R({transaction_date:n},{long:!0}):n,transactions:[...s].sort((l,d)=>S(d)-S(l))}))})(),Ue=t=>bt({companyTitle:U,dateLabel:R(t),typeLabel:z(t==null?void 0:t.type),amount:Number((t==null?void 0:t.amount)||0),description:(t==null?void 0:t.description)||"No additional note",reference:(t==null?void 0:t.reference)||"",updatedBalance:Number((t==null?void 0:t.balance)||0),onlineStoreUrl:te,thankYouLine:"Thank you for shopping with us."}),he=async t=>{X(t)&&await J(Ue(t))},Ye=()=>{var t;if(!w||!T){h("Please select both From and To dates for the report.");return}if(w>T){h("From date cannot be later than To date.");return}h(""),k("");try{const n=P.filter(v=>{const f=L(v);return!!f&&f>=w&&f<=T}).sort((v,f)=>S(v)-S(f)),s=P.filter(v=>{const f=L(v);return!!f&&f<=T}).sort((v,f)=>S(v)-S(f)),l=s.length>0?Number(s[s.length-1].balance||0):0,d=Number(_||0),a=pt(),p=[41,128,185],y=[52,73,94],E=[39,174,96];a.setFillColor(...p),a.rect(0,0,210,45,"F"),a.setTextColor(255,255,255),a.setFontSize(24),a.setFont("helvetica","bold"),a.text(U||"BARMAN STORE",105,18,{align:"center"}),a.setFontSize(10),a.setFont("helvetica","normal"),a.text(rt||"Quality Groceries & Everyday Essentials",105,28,{align:"center"}),a.setFontSize(9);const qe=`${lt||""} | ${ot||""}`;if(a.text(qe,105,38,{align:"center"}),a.setTextColor(...y),a.setFontSize(16),a.setFont("helvetica","bold"),a.text("Credit Report",105,55,{align:"center"}),a.setDrawColor(200,200,200),a.setFillColor(248,249,250),a.roundedRect(14,62,182,28,3,3,"FD"),a.setFontSize(10),a.setFont("helvetica","bold"),a.setTextColor(...y),a.text("Customer Details",20,72),a.setFont("helvetica","normal"),a.setFontSize(9),a.text(`Name: ${(i==null?void 0:i.name)||"N/A"}`,20,80),a.text(`Phone: ${(i==null?void 0:i.phone)||"N/A"}`,100,80),a.text(`Email: ${(i==null?void 0:i.email)||"N/A"}`,20,86),a.setFontSize(9),a.setTextColor(100,100,100),a.text(`Period: ${w} to ${T}`,100,86),n.length>0){const v=n.map(C=>[R(C),z(C.type),C.reference||"-",{content:$(C.type==="payment"?-Number(C.amount):Number(C.amount)),styles:{halign:"right"}},{content:$(Number(C.balance)),styles:{halign:"right"}},C.description||"-"]);mt(a,{startY:95,head:[["Date","Type","Reference","Amount","Balance","Description"]],body:v,theme:"plain",headStyles:{fillColor:[255,255,255],textColor:[45,45,45],fontStyle:"bold",fontSize:F.fontSize,cellPadding:F.cellPadding,lineWidth:0},bodyStyles:{fontSize:F.fontSize,textColor:[35,35,35],cellPadding:F.cellPadding,minCellHeight:F.minCellHeight,overflow:"linebreak",valign:"top",lineWidth:0},styles:{lineWidth:0},columnStyles:wt(a),margin:{left:F.marginLeft,right:F.marginRight}});const f=Number(((t=a==null?void 0:a.lastAutoTable)==null?void 0:t.finalY)||95)+10;let O=0,Z=0;n.forEach(C=>{const ue=Number(C.amount)||0;C.type==="given"?O+=ue:C.type==="payment"&&(Z+=ue)});const Qe=42,Je=14,Xe=a.internal.pageSize.height,K=f+Qe+Je>Xe?20:f;K!==f&&a.addPage(),a.setFillColor(248,249,250),a.roundedRect(14,K,182,42,3,3,"F"),a.setFontSize(11),a.setFont("helvetica","bold"),a.setTextColor(...y),a.text("Summary",20,K+10),a.setFontSize(9),a.setFont("helvetica","normal");const B=K+18;a.text(`Total Credit Given: ${$(O)}`,20,B),a.text(`Total Payments Received: ${$(Z)}`,20,B+7),a.text(`Net Change: ${$(O-Z)}`,20,B+14),a.setFont("helvetica","bold"),a.setFontSize(9),a.setTextColor(...y),a.text("Period Ending Balance:",118,B+2),a.setTextColor(l>=0?E[0]:231,l>=0?E[1]:76,l>=0?E[2]:60),a.text($(l),118,B+8),a.setTextColor(...y),a.text("Current Day Balance:",118,B+14),a.setTextColor(d>=0?E[0]:231,d>=0?E[1]:76,d>=0?E[2]:60),a.text($(d),118,B+20)}else a.setFontSize(11),a.setTextColor(100,100,100),a.text("No transactions found in the selected date range.",105,110,{align:"center"}),a.setFontSize(9),a.setTextColor(...y),a.text(`Period Ending Balance: ${$(l)}`,105,118,{align:"center"}),a.text(`Current Day Balance: ${$(d)}`,105,124,{align:"center"});ht(a,(v,f,O)=>{v.setFontSize(8),v.setTextColor(150,150,150),v.text(`Generated on ${new Date().toLocaleString("en-IN")} | Page ${f} of ${O}`,105,v.internal.pageSize.height-10,{align:"center"})});const Ke=`Credit_Report_${ut((i==null?void 0:i.name)||"Customer")}_${w}_to_${T}`;xt(a,Ke),k("PDF report downloaded successfully!")}catch(n){h((n==null?void 0:n.message)||"Failed to generate PDF report.")}};if(Ce)return e.jsx("div",{className:"credit-history-page",children:e.jsx("div",{className:"loading",children:"Loading..."})});const Ge=m?(()=>{var s;const n=new URLSearchParams(j.search||"").get("returnTab")||((s=j.state)==null?void 0:s.returnTab);return n?`/admin?tab=${encodeURIComponent(n)}`:"/admin"})():"/profile",Ve=m?"Back to Admin":"Back to Profile";return e.jsxs("div",{className:"credit-history-page",children:[e.jsxs("div",{className:"page-header",children:[e.jsxs(st,{to:Ge,className:"back-link",children:[e.jsx(Ct,{size:20})," ",Ve]}),e.jsxs("div",{className:"header-content",children:[e.jsx("h1",{children:m?"Credit History":"My Credit History"}),i&&e.jsx("p",{className:"customer-name",children:i.name})]}),e.jsxs("div",{className:"balance-card",children:[e.jsx("span",{className:"balance-label",children:"Current Balance"}),e.jsx("span",{className:`balance-amount ${_>=0?"positive":"negative"}`,children:A(_)})]})]}),re&&e.jsx("div",{className:"error-message",children:re}),le&&e.jsx("div",{className:"success-message",children:le}),m&&e.jsx("div",{className:"actions-bar",children:e.jsxs("button",{className:"admin-btn primary",onClick:()=>W(!0),children:[e.jsx(Tt,{size:20})," Add Transaction"]})}),e.jsxs("div",{className:"credit-table-container",children:[P.length===0?e.jsxs("div",{className:"empty-state",children:[e.jsxs("p",{children:["No credit history found",m?" for this customer.":"."]}),m&&e.jsx("p",{children:'Click "Add Transaction" to record a transaction.'})]}):e.jsxs(e.Fragment,{children:[e.jsxs("table",{className:"credit-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Date"}),e.jsx("th",{children:"Invoice #"}),e.jsx("th",{children:"Type"}),e.jsx("th",{children:"Amount"}),e.jsx("th",{children:"Balance"}),e.jsx("th",{children:"Description"}),e.jsx("th",{children:"Actions"})]})}),e.jsx("tbody",{children:P.map(t=>{const n=t.reference?`${t.description||""} (${t.reference})`.trim():t.description||"-",s=m&&X(t);return e.jsxs("tr",{children:[e.jsx("td",{children:R(t,{long:!0})}),e.jsx("td",{className:"invoice-number",children:t.invoice_number||"-"}),e.jsxs("td",{children:[me(t.type),e.jsx("span",{children:z(t.type)})]}),e.jsx("td",{className:t.type==="payment"?"payment-amount":"given-amount",children:A(t.type==="payment"?-parseFloat(t.amount):parseFloat(t.amount))}),e.jsx("td",{children:A(parseFloat(t.balance))}),e.jsx("td",{children:n}),e.jsxs("td",{className:"actions-cell",children:[t.image_path&&e.jsx("a",{href:t.image_path,target:"_blank",rel:"noopener noreferrer",className:"action-icon view",title:"View Invoice",children:e.jsx(ge,{size:16})}),e.jsx("button",{className:"action-icon print mobile-hide-print",onClick:()=>pe(t),title:"Print Invoice",disabled:M,"aria-disabled":M,children:e.jsx(ne,{size:16})}),s&&e.jsx("button",{className:"action-icon whatsapp",onClick:()=>he(t),title:"Share on WhatsApp",children:e.jsx(xe,{size:16})})]})]},t.id)})})]}),e.jsx("div",{className:"credit-mobile-list",children:Oe.map(t=>e.jsxs("section",{className:"credit-day-group",children:[e.jsx("h3",{className:"credit-day-title",children:t.dateLabel}),e.jsx("div",{className:"credit-bubble-stack",children:t.transactions.map(n=>{const s=n.description||"-",l=n.reference||"-",d=n.type==="payment"?-parseFloat(n.amount):parseFloat(n.amount),a=m&&X(n);return e.jsxs("article",{className:`credit-transaction-bubble ${n.type==="payment"?"bubble-right payment":"bubble-left given"}`,children:[e.jsxs("header",{className:"bubble-head",children:[e.jsxs("span",{className:"bubble-type",children:[me(n.type),z(n.type)]}),e.jsx("span",{className:n.type==="payment"?"payment-amount":"given-amount",children:A(d)})]}),e.jsxs("div",{className:"bubble-detail",children:[e.jsx("strong",{children:"Desc:"})," ",s]}),e.jsxs("div",{className:"bubble-detail",children:[e.jsx("strong",{children:"Ref:"})," ",l]}),e.jsxs("div",{className:"bubble-detail",children:[e.jsx("strong",{children:"Invoice:"})," ",n.invoice_number||"-"]}),e.jsxs("div",{className:"bubble-detail",children:[e.jsx("strong",{children:"Date:"})," ",R(n,{long:!0})]}),e.jsxs("div",{className:"bubble-actions",children:[n.image_path&&e.jsx("a",{href:n.image_path,target:"_blank",rel:"noopener noreferrer",className:"action-icon view",title:"View Invoice",onClick:p=>p.stopPropagation(),children:e.jsx(ge,{size:16})}),e.jsx("button",{className:"action-icon print mobile-hide-print",onClick:()=>pe(n),title:"Print Invoice",disabled:M,"aria-disabled":M,children:e.jsx(ne,{size:16})}),a&&e.jsx("button",{className:"action-icon whatsapp",onClick:()=>he(n),title:"Share on WhatsApp",children:e.jsx(xe,{size:16})})]}),e.jsxs("footer",{className:"bubble-balance",children:[e.jsx("span",{children:"Balance"}),e.jsx("strong",{children:A(parseFloat(n.balance))})]})]},`mobile-${n.id}`)})})]},t.dateKey))})]}),m&&e.jsxs("div",{className:"report-controls",children:[e.jsxs("label",{children:[" From:",e.jsx("input",{type:"date",value:w,onChange:t=>De(t.target.value)})]}),e.jsxs("label",{children:[" To:",e.jsx("input",{type:"date",value:T,onChange:t=>Pe(t.target.value)})]}),e.jsx("button",{className:"admin-btn",onClick:Be,title:"Generate credit report for date range",children:"Generate Report"})]})]}),m&&$e&&e.jsxs("div",{className:"report-box",children:[e.jsx("div",{className:"report-header",children:e.jsxs("strong",{children:["Credit Report ",i!=null&&i.name?`- ${i.name}`:""]})}),e.jsx("textarea",{className:"report-text",readOnly:!0,value:q}),e.jsxs("div",{className:"report-actions",children:[e.jsx("button",{className:"report-btn",onClick:Le,children:"Copy"}),e.jsx("button",{className:"report-btn whatsapp",onClick:_e,children:"WhatsApp"}),e.jsxs("button",{className:"report-btn pdf",onClick:Ye,children:[e.jsx(St,{size:14})," PDF"]}),e.jsx("button",{className:"report-btn",onClick:()=>ce(!1),children:"Close"})]})]}),m&&H&&e.jsxs("div",{className:"report-box",children:[e.jsx("div",{className:"report-header",children:e.jsx("strong",{children:"Manual Entry Message"})}),e.jsx("textarea",{className:"report-text",readOnly:!0,value:H}),e.jsxs("div",{className:"report-actions",children:[e.jsx("button",{className:"report-btn",onClick:Me,children:"Copy"}),e.jsx("button",{className:"report-btn whatsapp",onClick:He,children:"WhatsApp"}),e.jsx("button",{className:"report-btn",onClick:()=>Q(""),children:"Close"})]})]}),m&&Te&&e.jsx("div",{className:"modal-overlay",onClick:()=>W(!1),children:e.jsxs("div",{className:"modal-content fade-in-up",onClick:t=>t.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h2",{children:"Add Payment Entry"}),e.jsx("button",{className:"close-btn",onClick:()=>W(!1),children:"×"})]}),e.jsxs("form",{onSubmit:ze,children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Transaction Type"}),e.jsxs("select",{value:o.type,onChange:t=>I({...o,type:t.target.value}),children:[e.jsx("option",{value:"given",children:"Given (Add to balance)"}),e.jsx("option",{value:"payment",children:"Payment (Reduce balance)"})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Amount (₹)"}),e.jsx("input",{type:"number",step:"0.01",min:"0.01",value:o.amount,onChange:t=>I({...o,amount:t.target.value}),placeholder:"Enter amount",required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Date"}),e.jsx("input",{type:"date",value:o.transactionDate,onChange:t=>I({...o,transactionDate:t.target.value}),required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Description *"}),e.jsx("input",{type:"text",value:o.description,onChange:t=>I({...o,description:t.target.value}),placeholder:"Enter description",required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Reference"}),e.jsx("input",{type:"text",value:o.reference,onChange:t=>I({...o,reference:t.target.value}),placeholder:"Reference number (optional)"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Upload Invoice/Bill"}),e.jsxs("div",{className:"file-upload-area",children:[e.jsx("input",{type:"file",ref:oe,onChange:Ae,accept:"image/*,.pdf",style:{display:"none"}}),e.jsxs("button",{type:"button",className:"upload-btn",onClick:()=>oe.current.click(),disabled:se,children:[e.jsx(ct,{size:16}),se?"Uploading...":"Choose File"]}),o.imagePath&&e.jsxs("span",{className:"uploaded-file",children:[e.jsx(dt,{size:14})," Invoice uploaded"]})]})]}),e.jsxs("div",{className:"modal-actions",children:[e.jsx("button",{type:"button",className:"cancel-btn",onClick:()=>W(!1),children:"Cancel"}),e.jsx("button",{type:"submit",className:"submit-btn",children:"Add Transaction"})]})]})]})}),we&&b&&e.jsx("div",{className:"modal-overlay invoice-modal-overlay",onClick:()=>V(!1),children:e.jsxs("div",{className:"invoice-template fade-in-up",onClick:t=>t.stopPropagation(),children:[e.jsx("button",{type:"button",className:"invoice-close-btn",onClick:()=>V(!1),"aria-label":"Close invoice",children:e.jsx(it,{size:20})}),e.jsxs("div",{className:"invoice-header",children:[e.jsx("h1",{children:"INVOICE"}),e.jsxs("div",{className:"company-details",children:[e.jsx("h3",{children:"Barman Store"}),e.jsx("p",{children:"Quality Groceries & Everyday Essentials"}),e.jsx("p",{children:"Email: info@barmanstore.com"})]})]}),e.jsxs("div",{className:"invoice-details",children:[e.jsxs("div",{className:"invoice-info",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Invoice #:"})," ",b.invoice_number]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Date:"})," ",R(b,{long:!0})]})]}),e.jsxs("div",{className:"customer-info",children:[e.jsx("h4",{children:"Bill To:"}),e.jsx("p",{children:e.jsx("strong",{children:i==null?void 0:i.name})}),e.jsx("p",{children:(i==null?void 0:i.email)||"No email"}),e.jsx("p",{children:(i==null?void 0:i.phone)||"No phone"}),(i==null?void 0:i.address)&&e.jsx("p",{children:i.address})]})]}),e.jsxs("table",{className:"invoice-items",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Description"}),e.jsx("th",{children:"Type"}),e.jsx("th",{children:"Amount"})]})}),e.jsx("tbody",{children:e.jsxs("tr",{children:[e.jsx("td",{children:b.description}),e.jsx("td",{children:z(b.type)}),e.jsx("td",{children:A(parseFloat(b.amount))})]})})]}),e.jsxs("div",{className:"invoice-summary",children:[e.jsxs("div",{className:"summary-row",children:[e.jsx("span",{children:"Previous Balance:"}),e.jsx("span",{children:A(parseFloat(b.balance)+parseFloat(b.amount))})]}),e.jsxs("div",{className:"summary-row",children:[e.jsx("span",{children:"Amount:"}),e.jsx("span",{children:A(parseFloat(b.amount))})]}),e.jsxs("div",{className:"summary-row total",children:[e.jsx("span",{children:"Current Balance:"}),e.jsx("span",{children:A(parseFloat(b.balance))})]})]}),b.reference&&e.jsx("div",{className:"invoice-footer",children:e.jsxs("p",{children:[e.jsx("strong",{children:"Reference:"})," ",b.reference]})}),e.jsxs("div",{className:"invoice-actions no-print",children:[e.jsxs("button",{className:"admin-btn",onClick:Re,children:[e.jsx(ne,{size:16})," Print Invoice"]}),e.jsx("button",{className:"admin-btn secondary",onClick:()=>V(!1),children:"Close"})]})]})})]})}export{Bt as default};
